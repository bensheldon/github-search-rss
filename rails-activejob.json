{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails: Issues containing 'ActiveJob Job'",
    "home_page_url": "https://github.com/search?q=ActiveJob+Job+repo%3Arails%2Frails+is%3Aissue&type=Issues",
    "feed_url": "https://bensheldon.github.io/github-search-rss/rails-activejob.json",
    "description": "rails/rails: Issues containing 'ActiveJob Job' on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/99586?u=b4abd791d83e768c72cb832147b4a210caecf47d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Steps to reproduce</h3>\n<p dir=\"auto\">Run a job with retry attempt 1. The won't be retried.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class FooJob &lt; ApplicationJob\n  class FooError &lt; StandardError; end\n\n  retry_on FooError, attempts: 1\n\n  def perform\n    raise FooError\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">FooJob</span> &lt; <span class=\"pl-v\">ApplicationJob</span>\n  <span class=\"pl-k\">class</span> <span class=\"pl-v\">FooError</span> &lt; <span class=\"pl-v\">StandardError</span><span class=\"pl-kos\">;</span> <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-en\">retry_on</span> <span class=\"pl-v\">FooError</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">attempts</span>: <span class=\"pl-c1\">1</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span>\n    <span class=\"pl-en\">raise</span> <span class=\"pl-v\">FooError</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">ActiveJob should retry at most the number of times specified by the attempts option.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\"><code class=\"notranslate\">attempts: 0</code>: runs once, no retry<br>\n<code class=\"notranslate\">attempts: 1</code>: runs once, no retry<br>\n<code class=\"notranslate\">attempts: 2</code>: runs once, one retry<br>\n<code class=\"notranslate\">attempts: 3</code>: runs once, two retries</p>\n<p dir=\"auto\">The behavior is not consistent. We can either change the behavior to be consistent (won't happen?) or at least document it very clearly.</p>\n<p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"358130415\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/33816\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/33816/hovercard\" href=\"https://github.com/rails/rails/issues/33816\">#33816</a> also pointed out the problem.</p>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: Rails 7.0.4</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: ruby 3.1.1p18 (2022-02-18 revision 53f5fc4236) [x86_64-linux]</p>",
            "url": "https://github.com/rails/rails/issues/46419",
            "title": "ActiveJob's retry behavior is not consistent",
            "date_modified": "2022-11-08T14:13:31.000Z",
            "date_published": "2022-11-04T10:37:42.000Z",
            "author": {
                "name": "shouichi",
                "url": "https://github.com/shouichi"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/79303?u=99e3bc7887879138e88a4538ca623b0a3d7538cb&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Summary</h3>\n<p dir=\"auto\">Like many folks, I set this in my <code class=\"notranslate\">config/environments/test.rb</code> file:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"config.active_job.queue_adapter = :inline  \"><pre class=\"notranslate\"><span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">:inline</span>  </pre></div>\n<p dir=\"auto\">The reason I do this is to have easy-to-test, deterministic behavior of any potentially async delayed jobs triggered by the application. Under Rails 5, all of my tests (children of <code class=\"notranslate\">ActiveSupport::TestCase</code> and <code class=\"notranslate\">ActionDispatch::SystemTestCase</code> alike) would respect this queue adapter. However, under Rails 6, any built-in Rails test case that includes <code class=\"notranslate\">ActiveJob::TestHelper</code> will also override this setting for all descendants of <code class=\"notranslate\">ActiveJob::Base</code> (<a href=\"https://github.com/rails/rails/blob/master/activejob/lib/active_job/test_helper.rb#L39-L41\">relevant source</a>).</p>\n<p dir=\"auto\">The net effect of this is that my <code class=\"notranslate\">perform_later</code> and <code class=\"notranslate\">deliver_later</code> calls to jobs aren't being fired synchronously (or, in fact, at all) during my system tests, which is leading to test failures upon upgrading to Rails 6.</p>\n<h3 dir=\"auto\">Steps to reproduce</h3>\n<p dir=\"auto\">Here are two tests that demonstrates the problem:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"require &quot;test_helper&quot;\n\nclass JobTest &lt; ActiveSupport::TestCase\n  class SomeJob &lt; ActiveJob::Base\n    cattr_accessor :job_ran\n\n    def perform\n      @@job_ran = true\n    end\n  end\n\n  def test_some_job\n    assert_equal :inline, Rails.application.config.active_job.queue_adapter\n    assert_equal ActiveJob::QueueAdapters::InlineAdapter, SomeJob.queue_adapter.class\n\n    SomeJob.perform_later\n\n    assert_equal true, SomeJob.job_ran\n  end\nend\n\nclass JobSystemTest &lt; ActionDispatch::SystemTestCase\n  class OtherJob &lt; ActiveJob::Base\n    cattr_accessor :job_ran\n\n    def perform\n      @@job_ran = true\n    end\n  end\n\n  def test_other_job\n    assert_equal :inline, Rails.application.config.active_job.queue_adapter\n    assert_equal ActiveJob::QueueAdapters::InlineAdapter, OtherJob.queue_adapter.class\n\n    OtherJob.perform_later\n\n    assert_equal true, OtherJob.job_ran\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">require</span> <span class=\"pl-s\">\"test_helper\"</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">JobTest</span> &lt; <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">TestCase</span>\n  <span class=\"pl-k\">class</span> <span class=\"pl-v\">SomeJob</span> &lt; <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Base</span>\n    <span class=\"pl-en\">cattr_accessor</span> <span class=\"pl-pds\">:job_ran</span>\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span>\n      <span class=\"pl-c1\">@@job_ran</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">true</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_some_job</span>\n    <span class=\"pl-en\">assert_equal</span> <span class=\"pl-pds\">:inline</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span>\n    <span class=\"pl-en\">assert_equal</span> <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">QueueAdapters</span>::<span class=\"pl-v\">InlineAdapter</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">SomeJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">class</span>\n\n    <span class=\"pl-v\">SomeJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">perform_later</span>\n\n    <span class=\"pl-en\">assert_equal</span> <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">SomeJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">job_ran</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">JobSystemTest</span> &lt; <span class=\"pl-v\">ActionDispatch</span>::<span class=\"pl-v\">SystemTestCase</span>\n  <span class=\"pl-k\">class</span> <span class=\"pl-v\">OtherJob</span> &lt; <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Base</span>\n    <span class=\"pl-en\">cattr_accessor</span> <span class=\"pl-pds\">:job_ran</span>\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span>\n      <span class=\"pl-c1\">@@job_ran</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">true</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_other_job</span>\n    <span class=\"pl-en\">assert_equal</span> <span class=\"pl-pds\">:inline</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span>\n    <span class=\"pl-en\">assert_equal</span> <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">QueueAdapters</span>::<span class=\"pl-v\">InlineAdapter</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">OtherJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">class</span>\n\n    <span class=\"pl-v\">OtherJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">perform_later</span>\n\n    <span class=\"pl-en\">assert_equal</span> <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">OtherJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">job_ran</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">I would expect the behavior to have remained as it did under Rails 5, where the <code class=\"notranslate\">active_job.queue_adapter</code> setting would be respected for all of Rails' test types.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\">The first test, which descends from <code class=\"notranslate\">ActiveSupport::TestCase</code> will pass and behave as it did under Rails 5. However, the second test, descending from from <code class=\"notranslate\">ActionDispatch::SystemTestCase</code> will now fail under Rails 6, because <code class=\"notranslate\">OtherJob</code>'s <code class=\"notranslate\">queue_adapter</code> will have been reset by <code class=\"notranslate\">ActiveJob::TestHelper</code> to be an instance of <code class=\"notranslate\">TestAdapter</code></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"JobSystemTest#test_other_job [/Users/justin/code/testdouble/present/test/lib/job_test.rb:33]:\n--- expected\n+++ actual\n@@ -1 +1 @@\n-ActiveJob::QueueAdapters::InlineAdapter\n+ActiveJob::QueueAdapters::TestAdapter\"><pre class=\"notranslate\"><code class=\"notranslate\">JobSystemTest#test_other_job [/Users/justin/code/testdouble/present/test/lib/job_test.rb:33]:\n--- expected\n+++ actual\n@@ -1 +1 @@\n-ActiveJob::QueueAdapters::InlineAdapter\n+ActiveJob::QueueAdapters::TestAdapter\n</code></pre></div>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: 6.0.0 as well as <a href=\"https://github.com/rails/rails/tree/2bc6a948a2f46f8cf2d44506af1be235691c84b5\">6-0-stable</a>, as of today.</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: ruby 2.6.3p62 (2019-04-16 revision 67580) [x86_64-darwin18]</p>",
            "url": "https://github.com/rails/rails/issues/37270",
            "title": "Rails 6 inconsistently overrides ActiveJob queue_adapter setting with TestAdapter",
            "date_modified": "2022-11-17T08:07:16.000Z",
            "date_published": "2019-09-23T05:29:13.000Z",
            "author": {
                "name": "searls",
                "url": "https://github.com/searls"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/3263575?u=92ee5d4a6a643b31856ac542ba409309c5389493&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">I am trying to handle the case where the last step of a direct upload fails (the <code class=\"notranslate\">PATCH</code> call to my model), and I have noticed an odd behaviour. Here goes:</p>\n<h3 dir=\"auto\">Steps to reproduce</h3>\n<ul dir=\"auto\">\n<li>Set up the <code class=\"notranslate\">Profile</code> model with <code class=\"notranslate\">has_one_attached :document</code>.</li>\n<li>Create an instance of <code class=\"notranslate\">Profile</code> (referred to as <code class=\"notranslate\">profile</code>)</li>\n<li>Use a direct upload form to attach a document to <code class=\"notranslate\">profile</code> (controller and view code below)</li>\n<li>Everything works fine so far, I can see the image and its filename.</li>\n<li>Force a failure in the <code class=\"notranslate\">PATCH</code> call to <code class=\"notranslate\">/profile/document</code>: intentionally modify a validation in the Profile model so that any call to Profile#update fails</li>\n<li>Upload another document for the same Profile, and watch the <code class=\"notranslate\">PATCH</code> fail.</li>\n</ul>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">When this last step fails, I'd expect the whole state of my app to go back to its state from before the beginning of the upload process (the <code class=\"notranslate\">POST</code> call to <code class=\"notranslate\">rails/active_storage/direct_uploads</code>).</p>\n<p dir=\"auto\">I'd also expect the former file to still be there on the storage, and the new one to not be there.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\">The Attachment record for my Profile is still the same, but the original Blob was destroyed, and replaced by a new one (created by the first <code class=\"notranslate\">POST</code> to <code class=\"notranslate\">rails/active_storage/direct_uploads</code>). The Attachment points to the destroyed Blob.</p>\n<p dir=\"auto\"><code class=\"notranslate\">profile.document.attached?</code> returns <code class=\"notranslate\">true</code>, but other methods, e.g. <code class=\"notranslate\">filename</code> or <code class=\"notranslate\">service_url</code> are undefined. This breaks my views: the if passes, the statements inside break.</p>\n<p dir=\"auto\">S3/Disk contains the new file, and does not contain the former one.</p>\n<p dir=\"auto\">The logs tell me that the first call from the client to <code class=\"notranslate\">/rails/active_storage/direct_uploads</code> creates a Blob. Then, after the upload to S3 is done, the <code class=\"notranslate\">PATCH</code> call to <code class=\"notranslate\">/profile/document</code> destroys the former Attachment and creates a new one, but this is all rolled back when my validation fails. However, it also enqueues a job that purges the former Blob, instead of purging the newly created one.</p>\n<p dir=\"auto\">From my understanding, what this job does should depend upon the success of the <code class=\"notranslate\">PATCH</code> call. Is this an actual bug, or am I supposed to handle this manually? Or maybe there's just another way to write things and make it work automagically?</p>\n<p dir=\"auto\">One workaround I found is to call purge or detach on the document when the update fails. From a user's point of view it removes the former document, which isn't so nice, but at least my views don't break. The Attachment is destroyed, the Blob remains, the former file is destroyed, the new one is stored. This fix is commented out in the code sample.</p>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\">I get the bug on my local environment, both with S3 and Disk as targets.</p>\n<p dir=\"auto\"><strong>Rails version</strong>:<br>\nRails 5.2.0.rc1</p>\n<p dir=\"auto\"><strong>Ruby version</strong>:<br>\nruby 2.5.0p0 (2017-12-25 revision 61468) [x86_64-darwin17]</p>\n<h3 dir=\"auto\">Code samples</h3>\n<p dir=\"auto\">Adapted for better readability.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"class ProfilesController &lt; ApplicationController\n  def update\n    if current_user.profile.update(document_params)\n      flash[:notice] = &quot;Your document was successfully uploaded&quot;\n    else\n      # current_profile.reload.identity_document.purge # The fix\n      flash[:alert] = &quot;Something went wrong.&quot;\n    end\n    redirect_to my_form_url\n  end\n\n  private\n\n  def document_params\n    params.require(:profile).permit(:document)\n  end\nend\"><pre class=\"notranslate\"><code class=\"notranslate\">class ProfilesController &lt; ApplicationController\n  def update\n    if current_user.profile.update(document_params)\n      flash[:notice] = \"Your document was successfully uploaded\"\n    else\n      # current_profile.reload.identity_document.purge # The fix\n      flash[:alert] = \"Something went wrong.\"\n    end\n    redirect_to my_form_url\n  end\n\n  private\n\n  def document_params\n    params.require(:profile).permit(:document)\n  end\nend\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&lt;% if @profile.document.attached? %&gt;\n    &lt;%= @profile.document.filename %&gt;\n    &lt;%= image_tag @profile.document %&gt;\n&lt;% else %&gt;\n    No document yet\n&lt;% end %&gt;\n\n&lt;%= form_for @profile do |f| %&gt;\n    &lt;%= f.file_field :document, direct_upload: true %&gt;\n    &lt;%= f.submit %&gt;\n&lt;% end %&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">&lt;% if @profile.document.attached? %&gt;\n    &lt;%= @profile.document.filename %&gt;\n    &lt;%= image_tag @profile.document %&gt;\n&lt;% else %&gt;\n    No document yet\n&lt;% end %&gt;\n\n&lt;%= form_for @profile do |f| %&gt;\n    &lt;%= f.file_field :document, direct_upload: true %&gt;\n    &lt;%= f.submit %&gt;\n&lt;% end %&gt;\n</code></pre></div>\n<p dir=\"auto\">Thanks in advance for your help!</p>",
            "url": "https://github.com/rails/rails/issues/31985",
            "title": "ActiveStorage: invalid Attachment when last step of direct upload fails",
            "date_modified": "2022-10-29T18:10:15.000Z",
            "date_published": "2018-02-13T17:56:05.000Z",
            "author": {
                "name": "SimonFrr",
                "url": "https://github.com/SimonFrr"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2741?u=387c085565dc648f11d835558ad1b6d524ddc91d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This is a common source of job errors:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Project &lt; ApplicationRecord\n  after_create -&gt; { NotifyProjectParticipants.perform_later self }\nend\n\nclass NotifyProjectParticipants &lt; ApplicationJob\n  def perform(project)\n    # This will explode with a ActiveJob::DeserializationError,\n    #  if the job runs before the INSERT transaction for the new project completes.\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Project</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">after_create</span> <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-v\">NotifyProjectParticipants</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">perform_later</span> <span class=\"pl-smi\">self</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">NotifyProjectParticipants</span> &lt; <span class=\"pl-v\">ApplicationJob</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">project</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-c\"># This will explode with a ActiveJob::DeserializationError,</span>\n    <span class=\"pl-c\">#  if the job runs before the INSERT transaction for the new project completes.</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">It's insidious too. Because it'll often work in development, then fail in production, when your job queue is really fast, and your database might be bogged down.</p>\n<p dir=\"auto\">The proper way is of course:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Project &lt; ApplicationRecord\n  after_create_commit -&gt; { NotifyProjectParticipants.perform_later self }\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Project</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">after_create_commit</span> <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-v\">NotifyProjectParticipants</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">perform_later</span> <span class=\"pl-smi\">self</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">But that's easy to forget. So I suggest that we create a new default that disallow jobs from being scheduled within transactions. You should be able to turn that off, but it would be a better default, since it would catch this class for errors for more people before they deploy to production.</p>",
            "url": "https://github.com/rails/rails/issues/26045",
            "title": "Prevent jobs from being scheduled within transactions",
            "date_modified": "2021-03-09T23:05:04.000Z",
            "date_published": "2016-08-03T17:21:16.000Z",
            "author": {
                "name": "dhh",
                "url": "https://github.com/dhh"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/453584?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Enqueueing lots of jobs from a running job causes memory to bloat. This seems to be caused by the <code class=\"notranslate\">ActiveJob::LogSubscriber</code>, which keeps a stack of all events (e.g. <code class=\"notranslate\">enqueue.active_job</code>) that happen during another event (<code class=\"notranslate\">perform.active_job</code>).</p>\n<h3 dir=\"auto\">Steps to reproduce</h3>\n<p dir=\"auto\">This job is written to show the bloat:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class TestJob &lt; ApplicationJob\n  queue_as :test\n  \n  def perform\n    10.times do\n      SecondTestJob.perform_later\n\n      subscriber = ObjectSpace.each_object(ActiveJob::LogSubscriber).first\n      dangling_event = subscriber&amp;.send(:event_stack)&amp;.first\n      if dangling_event\n        puts &quot;Found a dangling event with #{dangling_event.children.size} children.&quot;\n      else\n        puts 'There are no dangling events.'\n      end\n    end\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">TestJob</span> &lt; <span class=\"pl-v\">ApplicationJob</span>\n  <span class=\"pl-en\">queue_as</span> <span class=\"pl-pds\">:test</span>\n  \n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span>\n    <span class=\"pl-c1\">10</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">times</span> <span class=\"pl-k\">do</span>\n      <span class=\"pl-v\">SecondTestJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">perform_later</span>\n\n      <span class=\"pl-s1\">subscriber</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ObjectSpace</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each_object</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">LogSubscriber</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span>\n      <span class=\"pl-s1\">dangling_event</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">subscriber</span>&amp;.<span class=\"pl-en\">send</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:event_stack</span><span class=\"pl-kos\">)</span>&amp;.<span class=\"pl-en\">first</span>\n      <span class=\"pl-k\">if</span> <span class=\"pl-s1\">dangling_event</span>\n        <span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Found a dangling event with <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">dangling_event</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">children</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">size</span><span class=\"pl-kos\">}</span></span> children.\"</span>\n      <span class=\"pl-k\">else</span>\n        <span class=\"pl-en\">puts</span> <span class=\"pl-s\">'There are no dangling events.'</span>\n      <span class=\"pl-k\">end</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">It will print <code class=\"notranslate\">Found a dangling event with X children.</code>, where <code class=\"notranslate\">X</code> is growing with the number of jobs that have been enqueued. This means each time a new job is enqueued, we will store an additional event and not release it until <code class=\"notranslate\">TestJob</code> finished performing.</p>\n<p dir=\"auto\">If the code is not excuted as active job (e.g. <code class=\"notranslate\">TestJob.new.perform</code>), the output is <code class=\"notranslate\">There are no dangling events.</code>, which means no events are accumulated and memory remains stable.</p>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">I can enqueue an infinite amount of jobs from a job, without running out of memory.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\">Enqueuing jobs from a job is memory constrained, because events will pile up. This is especially a problem, if enqueueing jobs with large parameters, since the parameters will be referenced in memory as well. Example:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class TestLargeObjectJob &lt; ApplicationJob\n  queue_as :test\n  \n  def perform\n    10.times do\n      # large_object  should be garbage collectible after every iteration, but the dangling event will keep a reference to it, so large_object will never be collected\n      large_object = 'A' * 1_000_000\n      SecondTestJob.perform_later(large_object)\n    end\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">TestLargeObjectJob</span> &lt; <span class=\"pl-v\">ApplicationJob</span>\n  <span class=\"pl-en\">queue_as</span> <span class=\"pl-pds\">:test</span>\n  \n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span>\n    <span class=\"pl-c1\">10</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">times</span> <span class=\"pl-k\">do</span>\n      <span class=\"pl-c\"># large_object  should be garbage collectible after every iteration, but the dangling event will keep a reference to it, so large_object will never be collected</span>\n      <span class=\"pl-s1\">large_object</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'A'</span> * <span class=\"pl-c1\">1_000_000</span>\n      <span class=\"pl-v\">SecondTestJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">perform_later</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">large_object</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: 7.0.4</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: 3.0.0</p>",
            "url": "https://github.com/rails/rails/issues/46185",
            "title": "Memory bloat in ActiveJob::LogSubscriber",
            "date_modified": "2022-10-10T09:28:15.000Z",
            "date_published": "2022-10-04T07:07:48.000Z",
            "author": {
                "name": "NobodysNightmare",
                "url": "https://github.com/NobodysNightmare"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/619324?u=d70bb67108fff36394d8534f91610daf31ea17fe&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Steps to reproduce</h3>\n<ol dir=\"auto\">\n<li>\n<p dir=\"auto\">Generate a new application:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"rails new AsyncDestroyTestApp --skip-action-mailer --skip-action-mailbox --skip-action-text --skip-active-storage --skip-action-cable --skip-sprockets --skip-spring --skip-listen --skip-javascript --skip-turbolinks --skip-jbuilder --skip-test --skip-system-test --skip-bootsnap\"><pre class=\"notranslate\"><code class=\"notranslate\">rails new AsyncDestroyTestApp --skip-action-mailer --skip-action-mailbox --skip-action-text --skip-active-storage --skip-action-cable --skip-sprockets --skip-spring --skip-listen --skip-javascript --skip-turbolinks --skip-jbuilder --skip-test --skip-system-test --skip-bootsnap\n</code></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Apply the following diff (add models):</p>\n<div class=\"highlight highlight-source-diff notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"diff --git a/app/models/book.rb b/app/models/book.rb\nnew file mode 100644\nindex 0000000..f1e2a65\n--- /dev/null\n+++ b/app/models/book.rb\n@@ -0,0 +1,3 @@\n+class Book &lt; ApplicationRecord\n+  has_many :tags, dependent: :destroy_async\n+end\ndiff --git a/app/models/tag.rb b/app/models/tag.rb\nnew file mode 100644\nindex 0000000..7b23605\n--- /dev/null\n+++ b/app/models/tag.rb\n@@ -0,0 +1,2 @@\n+class Tag &lt; ApplicationRecord\n+end\ndiff --git a/db/migrate/20210609112034_add_books_and_tags.rb b/db/migrate/20210609112034_add_books_and_tags.rb\nnew file mode 100644\nindex 0000000..baed2c0\n--- /dev/null\n+++ b/db/migrate/20210609112034_add_books_and_tags.rb\n@@ -0,0 +1,8 @@\n+class AddBooksAndTags &lt; ActiveRecord::Migration[6.1]\n+  def change\n+    create_table :books\n+    create_table :tags do |t|\n+      t.references :book, foreign_key: true, null: true\n+    end\n+  end\n+end\ndiff --git a/db/schema.rb b/db/schema.rb\nnew file mode 100644\nindex 0000000..fca4c69\n--- /dev/null\n+++ b/db/schema.rb\n@@ -0,0 +1,24 @@\n+# This file is auto-generated from the current state of the database. Instead\n+# of editing this file, please use the migrations feature of Active Record to\n+# incrementally modify your database, and then regenerate this schema definition.\n+#\n+# This file is the source Rails uses to define your schema when running `bin/rails\n+# db:schema:load`. When creating a new database, `bin/rails db:schema:load` tends to\n+# be faster and is potentially less error prone than running all of your\n+# migrations from scratch. Old migrations may fail to apply correctly if those\n+# migrations use external dependencies or application code.\n+#\n+# It's strongly recommended that you check this file into your version control system.\n+\n+ActiveRecord::Schema.define(version: 2021_06_09_112034) do\n+\n+  create_table &quot;books&quot;, force: :cascade do |t|\n+  end\n+\n+  create_table &quot;tags&quot;, force: :cascade do |t|\n+    t.integer &quot;book_id&quot;\n+    t.index [&quot;book_id&quot;], name: &quot;index_tags_on_book_id&quot;\n+  end\n+\n+  add_foreign_key &quot;tags&quot;, &quot;books&quot;\n+end\"><pre class=\"notranslate\"><span class=\"pl-c1\">diff --git a/app/models/book.rb b/app/models/book.rb</span>\nnew file mode 100644\nindex 0000000..f1e2a65\n<span class=\"pl-md\">--- /dev/null</span>\n<span class=\"pl-mi1\">+++ b/app/models/book.rb</span>\n<span class=\"pl-mdr\">@@ -0,0 +1,3 @@</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>class Book &lt; ApplicationRecord</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  has_many :tags, dependent: :destroy_async</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>end</span>\n<span class=\"pl-c1\">diff --git a/app/models/tag.rb b/app/models/tag.rb</span>\nnew file mode 100644\nindex 0000000..7b23605\n<span class=\"pl-md\">--- /dev/null</span>\n<span class=\"pl-mi1\">+++ b/app/models/tag.rb</span>\n<span class=\"pl-mdr\">@@ -0,0 +1,2 @@</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>class Tag &lt; ApplicationRecord</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>end</span>\n<span class=\"pl-c1\">diff --git a/db/migrate/20210609112034_add_books_and_tags.rb b/db/migrate/20210609112034_add_books_and_tags.rb</span>\nnew file mode 100644\nindex 0000000..baed2c0\n<span class=\"pl-md\">--- /dev/null</span>\n<span class=\"pl-mi1\">+++ b/db/migrate/20210609112034_add_books_and_tags.rb</span>\n<span class=\"pl-mdr\">@@ -0,0 +1,8 @@</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>class AddBooksAndTags &lt; ActiveRecord::Migration[6.1]</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  def change</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>    create_table :books</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>    create_table :tags do |t|</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      t.references :book, foreign_key: true, null: true</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>    end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>end</span>\n<span class=\"pl-c1\">diff --git a/db/schema.rb b/db/schema.rb</span>\nnew file mode 100644\nindex 0000000..fca4c69\n<span class=\"pl-md\">--- /dev/null</span>\n<span class=\"pl-mi1\">+++ b/db/schema.rb</span>\n<span class=\"pl-mdr\">@@ -0,0 +1,24 @@</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span># This file is auto-generated from the current state of the database. Instead</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span># of editing this file, please use the migrations feature of Active Record to</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span># incrementally modify your database, and then regenerate this schema definition.</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>#</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span># This file is the source Rails uses to define your schema when running `bin/rails</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span># db:schema:load`. When creating a new database, `bin/rails db:schema:load` tends to</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span># be faster and is potentially less error prone than running all of your</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span># migrations from scratch. Old migrations may fail to apply correctly if those</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span># migrations use external dependencies or application code.</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>#</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span># It's strongly recommended that you check this file into your version control system.</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>ActiveRecord::Schema.define(version: 2021_06_09_112034) do</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  create_table \"books\", force: :cascade do |t|</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  create_table \"tags\", force: :cascade do |t|</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>    t.integer \"book_id\"</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>    t.index [\"book_id\"], name: \"index_tags_on_book_id\"</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  add_foreign_key \"tags\", \"books\"</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>end</span></pre></div>\n</li>\n</ol>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">Consistent behavior when removing records asynchronously via passing a new list to the <code class=\"notranslate\">has_many</code> association (replacing). When you delete an object using <code class=\"notranslate\">parent.has_many_attr.first.destroy!</code>, Active Record will update the child's foreign key to <code class=\"notranslate\">nil</code> and schedule a job to delete an associated record from the database. However, when you will replace the \"has many\" association and delete the child (using <code class=\"notranslate\">parent.update!(has_many_attr: [])</code>) it will only update the foreign key. It won't actually cleanup them from the database:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"irb(main):001:0&gt; book = Book.create!(tags: [Tag.new, Tag.new])\n   (2.4ms)  SELECT sqlite_version(*)\n  TRANSACTION (0.1ms)  begin transaction\n  Book Create (1.4ms)  INSERT INTO &quot;books&quot; DEFAULT VALUES\n  Tag Create (1.2ms)  INSERT INTO &quot;tags&quot; (&quot;book_id&quot;) VALUES (?)  [[&quot;book_id&quot;, 1]]\n  Tag Create (0.2ms)  INSERT INTO &quot;tags&quot; (&quot;book_id&quot;) VALUES (?)  [[&quot;book_id&quot;, 1]]\n  TRANSACTION (2.1ms)  commit transaction\n=&gt; #&lt;Book:0x00007fcfa24c0c60 id: 1&gt;\nirb(main):002:0&gt; Tag.all\n  Tag Load (0.3ms)  SELECT &quot;tags&quot;.* FROM &quot;tags&quot;\n=&gt; [#&lt;Tag:0x00007fcfa258a420 id: 1, book_id: 1&gt;, #&lt;Tag:0x00007fcfa258a2b8 id: 2, book_id: 1&gt;]\nirb(main):003:0&gt; book.tags.last.destroy!\n  TRANSACTION (0.1ms)  begin transaction\n  Tag Destroy (0.8ms)  DELETE FROM &quot;tags&quot; WHERE &quot;tags&quot;.&quot;id&quot; = ?  [[&quot;id&quot;, 2]]\n  TRANSACTION (1.5ms)  commit transaction\n=&gt; #&lt;Tag:0x00007fcfa24c31b8 id: 2, book_id: 1&gt;\nirb(main):004:0&gt; Tag.all\n  Tag Load (0.2ms)  SELECT &quot;tags&quot;.* FROM &quot;tags&quot;\n=&gt; [#&lt;Tag:0x00007fcfa26c37b0 id: 1, book_id: 1&gt;]\nirb(main):005:0&gt; book.update!(tags: [])\n  TRANSACTION (0.1ms)  begin transaction\n  Tag Update All (1.0ms)  UPDATE &quot;tags&quot; SET &quot;book_id&quot; = ? WHERE &quot;tags&quot;.&quot;book_id&quot; = ? AND &quot;tags&quot;.&quot;id&quot; IN (?, ?)  [[&quot;book_id&quot;, nil], [&quot;book_id&quot;, 1], [nil, 1], [nil, 2]]\n  TRANSACTION (1.5ms)  commit transaction\n=&gt; true\nirb(main):006:0&gt; Tag.all\n  Tag Load (0.2ms)  SELECT &quot;tags&quot;.* FROM &quot;tags&quot;\n=&gt; [#&lt;Tag:0x00007fcfa25288b0 id: 1, book_id: nil&gt;]\nirb(main):007:0&gt; book.update!(tags: [Tag.new])\n  TRANSACTION (0.1ms)  begin transaction\n  Tag Create (1.2ms)  INSERT INTO &quot;tags&quot; (&quot;book_id&quot;) VALUES (?)  [[&quot;book_id&quot;, 1]]\n  TRANSACTION (9.4ms)  commit transaction\n=&gt; true\nirb(main):008:0&gt; Tag.all\n  Tag Load (0.3ms)  SELECT &quot;tags&quot;.* FROM &quot;tags&quot;\n=&gt; [#&lt;Tag:0x00007fcfa2e5b3d8 id: 1, book_id: nil&gt;, #&lt;Tag:0x00007fcfa2e5b310 id: 3, book_id: 1&gt;]\"><pre class=\"notranslate\"><span class=\"pl-en\">irb</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">main</span><span class=\"pl-kos\">)</span>:<span class=\"pl-c1\">001</span><span class=\"pl-pds\">:0</span>&gt; <span class=\"pl-s1\">book</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Book</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create!</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">tags</span>: <span class=\"pl-kos\">[</span><span class=\"pl-v\">Tag</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Tag</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span>\n   <span class=\"pl-kos\">(</span><span class=\"pl-c1\">2.4</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\"></span>  <span class=\"pl-en\">SELECT</span> <span class=\"pl-en\">sqlite_version</span><span class=\"pl-kos\">(</span>*<span class=\"pl-kos\">)</span>\n  <span class=\"pl-c1\">TRANSACTION</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">0.1</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-k\">begin</span> <span class=\"pl-en\">transaction</span>\n  <span class=\"pl-en\">Book</span> <span class=\"pl-en\">Create</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1.4</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-en\">INSERT</span> <span class=\"pl-en\">INTO</span> <span class=\"pl-s\">\"books\"</span> <span class=\"pl-en\">DEFAULT</span> <span class=\"pl-c1\">VALUES</span>\n  <span class=\"pl-v\">Tag</span> <span class=\"pl-v\">Create</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1.2</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-c1\">INSERT</span> <span class=\"pl-c1\">INTO</span> <span class=\"pl-s\">\"tags\"</span> <span class=\"pl-kos\">(</span><span class=\"pl-s\">\"book_id\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-en\">VALUES</span> <span class=\"pl-kos\">(</span>?)  <span class=\"pl-kos\">[</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"book_id\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">]</span>\n  <span class=\"pl-en\">Tag</span> <span class=\"pl-en\">Create</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">0.2</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-en\">INSERT</span> <span class=\"pl-en\">INTO</span> <span class=\"pl-s\">\"tags\"</span> <span class=\"pl-kos\">(</span><span class=\"pl-s\">\"book_id\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">VALUES</span> <span class=\"pl-kos\">(</span>?)  <span class=\"pl-kos\">[</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"book_id\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">]</span>\n  <span class=\"pl-en\">TRANSACTION</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">2.1</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-en\">commit</span> <span class=\"pl-en\">transaction</span>\n<span class=\"pl-c1\">=&gt;</span> <span class=\"pl-c\">#&lt;Book:0x00007fcfa24c0c60 id: 1&gt;</span>\n<span class=\"pl-en\">irb</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">main</span><span class=\"pl-kos\">)</span>:<span class=\"pl-c1\">002</span><span class=\"pl-pds\">:0</span>&gt; <span class=\"pl-v\">Tag</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">all</span>\n  <span class=\"pl-en\">Tag</span> <span class=\"pl-en\">Load</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">0.3</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-en\">SELECT</span> <span class=\"pl-s\">\"tags\"</span><span class=\"pl-kos\">.</span>* <span class=\"pl-en\">FROM</span> <span class=\"pl-s\">\"tags\"</span>\n<span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">[</span><span class=\"pl-c\">#&lt;Tag:0x00007fcfa258a420 id: 1, book_id: 1&gt;, #&lt;Tag:0x00007fcfa258a2b8 id: 2, book_id: 1&gt;]</span>\n<span class=\"pl-en\">irb</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">main</span><span class=\"pl-kos\">)</span>:<span class=\"pl-c1\">003</span><span class=\"pl-pds\">:0</span>&gt; <span class=\"pl-s1\">book</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">tags</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">last</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">destroy!</span>\n  <span class=\"pl-c1\">TRANSACTION</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">0.1</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-k\">begin</span> <span class=\"pl-en\">transaction</span>\n  <span class=\"pl-v\">Tag</span> <span class=\"pl-v\">Destroy</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">0.8</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-c1\">DELETE</span> <span class=\"pl-c1\">FROM</span> <span class=\"pl-s\">\"tags\"</span> <span class=\"pl-c1\">WHERE</span> <span class=\"pl-s\">\"tags\"</span><span class=\"pl-kos\">.</span>\"<span class=\"pl-en\">id</span><span class=\"pl-s\">\" = ?  [[\"</span><span class=\"pl-en\">id</span><span class=\"pl-s\">\", 2]]</span>\n<span class=\"pl-s\">  TRANSACTION (1.5ms)  commit transaction</span>\n<span class=\"pl-s\">=&gt; #&lt;Tag:0x00007fcfa24c31b8 id: 2, book_id: 1&gt;</span>\n<span class=\"pl-s\">irb(main):004:0&gt; Tag.all</span>\n<span class=\"pl-s\">  Tag Load (0.2ms)  SELECT \"</span><span class=\"pl-en\">tags</span><span class=\"pl-s\">\".* FROM \"</span><span class=\"pl-en\">tags</span><span class=\"pl-s\">\"</span>\n<span class=\"pl-s\">=&gt; [#&lt;Tag:0x00007fcfa26c37b0 id: 1, book_id: 1&gt;]</span>\n<span class=\"pl-s\">irb(main):005:0&gt; book.update!(tags: [])</span>\n<span class=\"pl-s\">  TRANSACTION (0.1ms)  begin transaction</span>\n<span class=\"pl-s\">  Tag Update All (1.0ms)  UPDATE \"</span><span class=\"pl-en\">tags</span><span class=\"pl-s\">\" SET \"</span><span class=\"pl-en\">book_id</span><span class=\"pl-s\">\" = ? WHERE \"</span><span class=\"pl-en\">tags</span><span class=\"pl-s\">\".\"</span><span class=\"pl-en\">book_id</span><span class=\"pl-s\">\" = ? AND \"</span><span class=\"pl-en\">tags</span><span class=\"pl-s\">\".\"</span><span class=\"pl-en\">id</span><span class=\"pl-s\">\" IN (?, ?)  [[\"</span><span class=\"pl-en\">book_id</span><span class=\"pl-s\">\", nil], [\"</span><span class=\"pl-en\">book_id</span><span class=\"pl-s\">\", 1], [nil, 1], [nil, 2]]</span>\n<span class=\"pl-s\">  TRANSACTION (1.5ms)  commit transaction</span>\n<span class=\"pl-s\">=&gt; true</span>\n<span class=\"pl-s\">irb(main):006:0&gt; Tag.all</span>\n<span class=\"pl-s\">  Tag Load (0.2ms)  SELECT \"</span><span class=\"pl-en\">tags</span><span class=\"pl-s\">\".* FROM \"</span><span class=\"pl-en\">tags</span><span class=\"pl-s\">\"</span>\n<span class=\"pl-s\">=&gt; [#&lt;Tag:0x00007fcfa25288b0 id: 1, book_id: nil&gt;]</span>\n<span class=\"pl-s\">irb(main):007:0&gt; book.update!(tags: [Tag.new])</span>\n<span class=\"pl-s\">  TRANSACTION (0.1ms)  begin transaction</span>\n<span class=\"pl-s\">  Tag Create (1.2ms)  INSERT INTO \"</span><span class=\"pl-en\">tags</span><span class=\"pl-s\">\" (\"</span><span class=\"pl-en\">book_id</span><span class=\"pl-s\">\") VALUES (?)  [[\"</span><span class=\"pl-en\">book_id</span><span class=\"pl-s\">\", 1]]</span>\n<span class=\"pl-s\">  TRANSACTION (9.4ms)  commit transaction</span>\n<span class=\"pl-s\">=&gt; true</span>\n<span class=\"pl-s\">irb(main):008:0&gt; Tag.all</span>\n<span class=\"pl-s\">  Tag Load (0.3ms)  SELECT \"</span><span class=\"pl-en\">tags</span><span class=\"pl-s\">\".* FROM \"</span><span class=\"pl-en\">tags</span>\"\n<span class=\"pl-c1\">=</span>&gt; <span class=\"pl-kos\">[</span><span class=\"pl-c\">#&lt;Tag:0x00007fcfa2e5b3d8 id: 1, book_id: nil&gt;, #&lt;Tag:0x00007fcfa2e5b310 id: 3, book_id: 1&gt;]</span></pre></div>\n<p dir=\"auto\">Note that the tag with id = 1 is still there while Active Record should clean it up after calling <code class=\"notranslate\">book.update!(tags: [])</code>.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\">Inconsistent behavior when replacing \"has many\" association (deleting some records asynchronously). Associated records are updated with the <code class=\"notranslate\">null</code> value for the foreign key when replacing the association as the whole, but there are no delete jobs scheduled.</p>\n<p dir=\"auto\">Note that using <code class=\"notranslate\">dependant: :destroy</code> works as expected:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"irb(main):001:0&gt; book = Book.create!(tags: [Tag.new, Tag.new])\n   (1.2ms)  SELECT sqlite_version(*)\n  TRANSACTION (0.1ms)  begin transaction\n  Book Create (1.3ms)  INSERT INTO &quot;books&quot; DEFAULT VALUES\n  Tag Create (0.4ms)  INSERT INTO &quot;tags&quot; (&quot;book_id&quot;) VALUES (?)  [[&quot;book_id&quot;, 1]]\n  Tag Create (0.3ms)  INSERT INTO &quot;tags&quot; (&quot;book_id&quot;) VALUES (?)  [[&quot;book_id&quot;, 1]]\n  TRANSACTION (1.6ms)  commit transaction\n=&gt; #&lt;Book:0x00007fd0d6be2e78 id: 1&gt;\nirb(main):002:0&gt; book.update!(tags: [])\n  TRANSACTION (0.1ms)  begin transaction\n  Tag Destroy (1.3ms)  DELETE FROM &quot;tags&quot; WHERE &quot;tags&quot;.&quot;id&quot; = ?  [[&quot;id&quot;, 1]]\n  Tag Destroy (0.4ms)  DELETE FROM &quot;tags&quot; WHERE &quot;tags&quot;.&quot;id&quot; = ?  [[&quot;id&quot;, 2]]\n  TRANSACTION (10.0ms)  commit transaction\n=&gt; true\nirb(main):003:0&gt; Tag.all\n  Tag Load (0.3ms)  SELECT &quot;tags&quot;.* FROM &quot;tags&quot;\n=&gt; []\nirb(main):004:0&gt;\"><pre class=\"notranslate\"><span class=\"pl-en\">irb</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">main</span><span class=\"pl-kos\">)</span>:<span class=\"pl-c1\">001</span><span class=\"pl-pds\">:0</span>&gt; <span class=\"pl-s1\">book</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Book</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create!</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">tags</span>: <span class=\"pl-kos\">[</span><span class=\"pl-v\">Tag</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Tag</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span>\n   <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1.2</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\"></span>  <span class=\"pl-en\">SELECT</span> <span class=\"pl-en\">sqlite_version</span><span class=\"pl-kos\">(</span>*<span class=\"pl-kos\">)</span>\n  <span class=\"pl-c1\">TRANSACTION</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">0.1</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-k\">begin</span> <span class=\"pl-en\">transaction</span>\n  <span class=\"pl-en\">Book</span> <span class=\"pl-en\">Create</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1.3</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-en\">INSERT</span> <span class=\"pl-en\">INTO</span> <span class=\"pl-s\">\"books\"</span> <span class=\"pl-en\">DEFAULT</span> <span class=\"pl-c1\">VALUES</span>\n  <span class=\"pl-v\">Tag</span> <span class=\"pl-v\">Create</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">0.4</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-c1\">INSERT</span> <span class=\"pl-c1\">INTO</span> <span class=\"pl-s\">\"tags\"</span> <span class=\"pl-kos\">(</span><span class=\"pl-s\">\"book_id\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-en\">VALUES</span> <span class=\"pl-kos\">(</span>?)  <span class=\"pl-kos\">[</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"book_id\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">]</span>\n  <span class=\"pl-en\">Tag</span> <span class=\"pl-en\">Create</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">0.3</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-en\">INSERT</span> <span class=\"pl-en\">INTO</span> <span class=\"pl-s\">\"tags\"</span> <span class=\"pl-kos\">(</span><span class=\"pl-s\">\"book_id\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">VALUES</span> <span class=\"pl-kos\">(</span>?)  <span class=\"pl-kos\">[</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"book_id\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">]</span>\n  <span class=\"pl-en\">TRANSACTION</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1.6</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-en\">commit</span> <span class=\"pl-en\">transaction</span>\n<span class=\"pl-c1\">=&gt;</span> <span class=\"pl-c\">#&lt;Book:0x00007fd0d6be2e78 id: 1&gt;</span>\n<span class=\"pl-en\">irb</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">main</span><span class=\"pl-kos\">)</span>:<span class=\"pl-c1\">002</span><span class=\"pl-pds\">:0</span>&gt; <span class=\"pl-s1\">book</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">update!</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">tags</span>: <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-c1\">TRANSACTION</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">0.1</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-k\">begin</span> <span class=\"pl-en\">transaction</span>\n  <span class=\"pl-en\">Tag</span> <span class=\"pl-en\">Destroy</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1.3</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-en\">DELETE</span> <span class=\"pl-en\">FROM</span> <span class=\"pl-s\">\"tags\"</span> <span class=\"pl-c1\">WHERE</span> <span class=\"pl-s\">\"tags\"</span><span class=\"pl-kos\">.</span>\"<span class=\"pl-en\">id</span><span class=\"pl-s\">\" = ?  [[\"</span><span class=\"pl-en\">id</span><span class=\"pl-s\">\", 1]]</span>\n<span class=\"pl-s\">  Tag Destroy (0.4ms)  DELETE FROM \"</span><span class=\"pl-en\">tags</span><span class=\"pl-s\">\" WHERE \"</span><span class=\"pl-en\">tags</span><span class=\"pl-s\">\".\"</span><span class=\"pl-en\">id</span><span class=\"pl-s\">\" = ?  [[\"</span><span class=\"pl-en\">id</span><span class=\"pl-s\">\", 2]]</span>\n<span class=\"pl-s\">  TRANSACTION (10.0ms)  commit transaction</span>\n<span class=\"pl-s\">=&gt; true</span>\n<span class=\"pl-s\">irb(main):003:0&gt; Tag.all</span>\n<span class=\"pl-s\">  Tag Load (0.3ms)  SELECT \"</span><span class=\"pl-en\">tags</span><span class=\"pl-s\">\".* FROM \"</span><span class=\"pl-en\">tags</span>\"\n<span class=\"pl-c1\">=</span>&gt; <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span>\n<span class=\"pl-en\">irb</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">main</span><span class=\"pl-kos\">)</span>:<span class=\"pl-c1\">004</span><span class=\"pl-pds\">:0</span>&gt;</pre></div>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: 6.1.3.2</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: 3.0.1</p>",
            "url": "https://github.com/rails/rails/issues/42430",
            "title": "Inconsistent behavior of `dependent: :destroy_async` for  the`has_many` association",
            "date_modified": "2022-03-08T15:26:38.000Z",
            "date_published": "2021-06-09T11:33:37.000Z",
            "author": {
                "name": "smt116",
                "url": "https://github.com/smt116"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/30030?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">With the following code in a Rails configuration file:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Rails.logger = Logger.new(STDERR)\"><pre class=\"notranslate\"><span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDERR</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\">Causes duplicate log statements when running the app with <code class=\"notranslate\">rails s</code>. It's caused by the following:</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/346ae79d5a11152f508df8d5506f8a0682ddb74b/railties/lib/rails/commands/server/server_command.rb#L75-L85\">rails/railties/lib/rails/commands/server/server_command.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 75 to 85\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/346ae79d5a11152f508df8d5506f8a0682ddb74b\">346ae79</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L75\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"75\"></td>\n          <td id=\"LC75\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">log_to_stdout</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L76\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"76\"></td>\n          <td id=\"LC76\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">wrapped_app</span> <span class=\"pl-c\"># touch the app so the logger is set up</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L77\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"77\"></td>\n          <td id=\"LC77\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L78\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"78\"></td>\n          <td id=\"LC78\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">console</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L79\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"79\"></td>\n          <td id=\"LC79\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">formatter</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">formatter</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L80\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"80\"></td>\n          <td id=\"LC80\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">level</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">level</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L81\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"81\"></td>\n          <td id=\"LC81\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L82\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"82\"></td>\n          <td id=\"LC82\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">unless</span> <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger_outputs_to?</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L83\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"83\"></td>\n          <td id=\"LC83\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">extend</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">broadcast</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">console</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L84\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"84\"></td>\n          <td id=\"LC84\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">end</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L85\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"85\"></td>\n          <td id=\"LC85\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">The implementation of <code class=\"notranslate\">logger_outputs_to?</code> uses private details of the logger instance to determine whether it's logging to <code class=\"notranslate\">STDOUT</code>. In this specific case, adding <code class=\"notranslate\">STDERR</code> as part of the check might also work. However, not all logger objects have the same private details causing this check to fail in those cases too.</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/346ae79d5a11152f508df8d5506f8a0682ddb74b/activesupport/lib/active_support/logger.rb#L16-L20\">rails/activesupport/lib/active_support/logger.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 16 to 20\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/346ae79d5a11152f508df8d5506f8a0682ddb74b\">346ae79</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L16\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"16\"></td>\n          <td id=\"LC16\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger_outputs_to?</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">logger</span><span class=\"pl-kos\">,</span> *<span class=\"pl-s1\">sources</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L17\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"17\"></td>\n          <td id=\"LC17\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">logdev</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">instance_variable_get</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:@logdev</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L18\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"18\"></td>\n          <td id=\"LC18\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">logger_source</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">logdev</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dev</span> <span class=\"pl-k\">if</span> <span class=\"pl-s1\">logdev</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">respond_to?</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:dev</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L19\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"19\"></td>\n          <td id=\"LC19\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">sources</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">any?</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">source</span>| <span class=\"pl-s1\">source</span> == <span class=\"pl-s1\">logger_source</span> <span class=\"pl-kos\">}</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L20\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"20\"></td>\n          <td id=\"LC20\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">I don't think we should be inspecting private object details and I believe that the implementation creates too many edge cases which are better handled by explicit configuration.</p>\n<p dir=\"auto\">My advice would be:</p>\n<ul dir=\"auto\">\n<li>Default to <code class=\"notranslate\">Rails.logger = Logger.new(STDERR)</code> (&amp; don't log to log files).</li>\n<li>Don't use <code class=\"notranslate\">instance_variable_get</code> and consider removing <code class=\"notranslate\">logger_outputs_to?</code>.</li>\n<li>Remove monkey patching (and private implementation introspection) of <code class=\"notranslate\">Rails.logger</code>.</li>\n<li>Educate users on how to get previous behaviour if it's desired.</li>\n</ul>\n<p dir=\"auto\">If we want to support output to multiple targets, this should be a feature of the log library not the interface for logging. I suggest some kind of tee logger should be appropriate, but I think it's better if we keep this simple in Rails and let <code class=\"notranslate\">logger</code> gem solve this problem.</p>",
            "url": "https://github.com/rails/rails/issues/44800",
            "title": "Too much magic in `Rails.logger` and logging to `STDERR` causes duplicate output.",
            "date_modified": "2022-10-24T09:20:46.000Z",
            "date_published": "2022-03-30T01:35:55.000Z",
            "author": {
                "name": "ioquatix",
                "url": "https://github.com/ioquatix"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/73684?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Steps to reproduce</h3>\n<p dir=\"auto\">Active Job CI has been failing since que 2.2.0 is installed. <a href=\"https://buildkite.com/rails/rails/builds/89068#0182e6b9-7c84-4b85-a651-8d640f5eb076\" rel=\"nofollow\">https://buildkite.com/rails/rails/builds/89068#0182e6b9-7c84-4b85-a651-8d640f5eb076</a></p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"git clone https://github.com/rails/rails\ncd rails/activejob\nbundle update que\nAJ_ADAPTER=que bin/test test/cases/queuing_test.rb:13\"><pre class=\"notranslate\"><span class=\"pl-en\">git</span> <span class=\"pl-en\">clone</span> <span class=\"pl-pds\">https</span>:<span class=\"pl-pds\">//github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>\n<span class=\"pl-en\">cd</span> <span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activejob</span>\n<span class=\"pl-en\">bundle</span> <span class=\"pl-en\">update</span> <span class=\"pl-en\">que</span>\n<span class=\"pl-c1\">AJ_ADAPTER</span><span class=\"pl-c1\">=</span><span class=\"pl-en\">que</span> <span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">cases</span>/<span class=\"pl-en\">queuing_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">13</span></pre></div>\n<p dir=\"auto\">Although there are 3 failures and 75 errors. This script just runs a single test because it looks the root cause is the same.</p>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">It should pass.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\">It raises <code class=\"notranslate\">ArgumentError: wrong number of arguments (given 2, expected 1)</code>.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ AJ_ADAPTER=que bin/test test/cases/queuing_test.rb:13\nUsing que\nRun options: --seed 62302\n\n# Running:\n\nE\n\nError:\nQueuingTest#test_run_queued_job:\nArgumentError: wrong number of arguments (given 2, expected 1)\n    /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/que-2.2.0/lib/que/active_job/extensions.rb:78:in `run'\n    /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/que-2.2.0/lib/que/job_methods.rb:51:in `_run'\n    /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/que-2.2.0/lib/que/job.rb:248:in `block (2 levels) in _run_attrs'\n    (eval):9:in `run_job_middleware'\n    /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/que-2.2.0/lib/que/job.rb:247:in `block in _run_attrs'\n    &lt;internal:kernel&gt;:90:in `tap'\n    /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/que-2.2.0/lib/que/job.rb:246:in `_run_attrs'\n    /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/que-2.2.0/lib/que/job.rb:223:in `run'\n    /home/yahonda/src/github.com/rails/rails/activejob/test/support/que/inline.rb:15:in `enqueue'\n    /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/que-2.2.0/lib/que/active_job/extensions.rb:66:in `enqueue'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/queue_adapters/que_adapter.rb:27:in `enqueue'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/enqueuing.rb:67:in `block in enqueue'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:118:in `block in run_callbacks'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/instrumentation.rb:28:in `block in instrument'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/notifications.rb:206:in `block in instrument'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/notifications/instrumenter.rb:58:in `instrument'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/notifications.rb:206:in `instrument'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/instrumentation.rb:27:in `instrument'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/instrumentation.rb:9:in `block (2 levels) in &lt;module:Instrumentation&gt;'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:127:in `instance_exec'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:127:in `block in run_callbacks'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/logging.rb:27:in `tag_logger'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/logging.rb:14:in `block (2 levels) in &lt;module:Logging&gt;'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:127:in `instance_exec'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:127:in `block in run_callbacks'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:138:in `run_callbacks'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/enqueuing.rb:63:in `enqueue'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/enqueuing.rb:30:in `perform_later'\n    /home/yahonda/src/github.com/rails/rails/activejob/test/cases/queuing_test.rb:14:in `block in &lt;class:QueuingTest&gt;'\n\n\nbin/test test/cases/queuing_test.rb:13\n\n\n\nFinished in 0.008930s, 111.9768 runs/s, 0.0000 assertions/s.\n1 runs, 0 assertions, 0 failures, 1 errors, 0 skips\n$\"><pre class=\"notranslate\">$ <span class=\"pl-c1\">AJ_ADAPTER</span><span class=\"pl-c1\">=</span><span class=\"pl-en\">que</span> <span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">cases</span>/<span class=\"pl-en\">queuing_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">13</span>\n<span class=\"pl-en\">Using</span> <span class=\"pl-en\">que</span>\n<span class=\"pl-en\">Run</span> <span class=\"pl-pds\">options</span>: --<span class=\"pl-en\">seed</span> <span class=\"pl-c1\">62302</span>\n\n<span class=\"pl-c\"># Running:</span>\n\n<span class=\"pl-c1\">E</span>\n\n<span class=\"pl-v\">Error</span>:\n<span class=\"pl-v\">QueuingTest</span><span class=\"pl-c\">#test_run_queued_job:</span>\n<span class=\"pl-en\">ArgumentError</span>: <span class=\"pl-en\">wrong</span> <span class=\"pl-en\">number</span> <span class=\"pl-en\">of</span> <span class=\"pl-en\">arguments</span> <span class=\"pl-kos\">(</span><span class=\"pl-en\">given</span> <span class=\"pl-c1\">2</span><span class=\"pl-kos\">,</span> <span class=\"pl-en\">expected</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-kos\">.</span><span class=\"pl-en\">rbenv</span>/<span class=\"pl-en\">versions</span>/<span class=\"pl-c1\">3.1</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">2</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">ruby</span>/<span class=\"pl-en\">gems</span>/<span class=\"pl-c1\">3.1</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">0</span>/<span class=\"pl-en\">gems</span>/<span class=\"pl-en\">que</span>-<span class=\"pl-c1\">2.2</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">0</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">que</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">extensions</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">78</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">run</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/que-2.2.0/lib/que/job_methods.rb:51:in `_run'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-kos\">.</span><span class=\"pl-en\">rbenv</span>/<span class=\"pl-en\">versions</span>/<span class=\"pl-c1\">3.1</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">2</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">ruby</span>/<span class=\"pl-en\">gems</span>/<span class=\"pl-c1\">3.1</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">0</span>/<span class=\"pl-en\">gems</span>/<span class=\"pl-en\">que</span>-<span class=\"pl-c1\">2.2</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">0</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">que</span>/<span class=\"pl-en\">job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">248</span><span class=\"pl-pds\">:in</span> <span class=\"pl-s\">`block (2 levels) in _run_attrs'</span>\n<span class=\"pl-s\">    (eval):9:in `</span><span class=\"pl-en\">run_job_middleware</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/que-2.2.0/lib/que/job.rb:247:in `block in _run_attrs'</span><span class=\"pl-en\"></span>\n    &lt;<span class=\"pl-en\">internal</span>:<span class=\"pl-en\">kernel</span>&gt;<span class=\"pl-pds\">:90</span>:<span class=\"pl-k\">in</span> `<span class=\"pl-en\">tap</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/que-2.2.0/lib/que/job.rb:246:in `_run_attrs'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-kos\">.</span><span class=\"pl-en\">rbenv</span>/<span class=\"pl-en\">versions</span>/<span class=\"pl-c1\">3.1</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">2</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">ruby</span>/<span class=\"pl-en\">gems</span>/<span class=\"pl-c1\">3.1</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">0</span>/<span class=\"pl-en\">gems</span>/<span class=\"pl-en\">que</span>-<span class=\"pl-c1\">2.2</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">0</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">que</span>/<span class=\"pl-en\">job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">223</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">run</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activejob/test/support/que/inline.rb:15:in `enqueue'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-kos\">.</span><span class=\"pl-en\">rbenv</span>/<span class=\"pl-en\">versions</span>/<span class=\"pl-c1\">3.1</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">2</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">ruby</span>/<span class=\"pl-en\">gems</span>/<span class=\"pl-c1\">3.1</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">0</span>/<span class=\"pl-en\">gems</span>/<span class=\"pl-en\">que</span>-<span class=\"pl-c1\">2.2</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">0</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">que</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">extensions</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">66</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">enqueue</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/queue_adapters/que_adapter.rb:27:in `enqueue'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activejob</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">enqueuing</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">67</span><span class=\"pl-pds\">:in</span> <span class=\"pl-s\">`block in enqueue'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:118:in `</span><span class=\"pl-kos\"></span><span class=\"pl-en\">block</span> <span class=\"pl-en\">in</span> <span class=\"pl-en\">run_callbacks</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/instrumentation.rb:28:in `block in instrument'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activesupport</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_support</span>/<span class=\"pl-en\">notifications</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">206</span><span class=\"pl-pds\">:in</span> <span class=\"pl-s\">`block in instrument'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/notifications/instrumenter.rb:58:in `</span><span class=\"pl-en\">instrument</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/notifications.rb:206:in `instrument'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activejob</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">instrumentation</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">27</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">instrument</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/instrumentation.rb:9:in `block (2 levels) in &lt;module:Instrumentation&gt;'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activesupport</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_support</span>/<span class=\"pl-en\">callbacks</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">127</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">instance_exec</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:127:in `block in run_callbacks'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activejob</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">logging</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">27</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">tag_logger</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/logging.rb:14:in `block (2 levels) in &lt;module:Logging&gt;'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activesupport</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_support</span>/<span class=\"pl-en\">callbacks</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">127</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">instance_exec</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:127:in `block in run_callbacks'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activesupport</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_support</span>/<span class=\"pl-en\">callbacks</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">138</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">run_callbacks</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/enqueuing.rb:63:in `enqueue'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activejob</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">enqueuing</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">30</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">perform_later</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activejob/test/cases/queuing_test.rb:14:in `block in &lt;class:QueuingTest&gt;'</span>\n\n\n<span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">cases</span>/<span class=\"pl-en\">queuing_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">13</span>\n\n\n\n<span class=\"pl-en\">Finished</span> <span class=\"pl-en\">in</span> <span class=\"pl-c1\">0.008930</span><span class=\"pl-en\">s</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">111.9768</span> <span class=\"pl-en\">runs</span>/<span class=\"pl-en\">s</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0.0000</span> <span class=\"pl-en\">assertions</span>/<span class=\"pl-en\">s</span><span class=\"pl-kos\">.</span>\n<span class=\"pl-c1\">1</span> <span class=\"pl-en\">runs</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0</span> <span class=\"pl-en\">assertions</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0</span> <span class=\"pl-en\">failures</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">1</span> <span class=\"pl-en\">errors</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0</span> <span class=\"pl-en\">skips</span>\n$</pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">require_job_options_kwarg?</code> always returns <code class=\"notranslate\">false</code> because <code class=\"notranslate\">JobWrapper.method(:enqueue).parameters</code> does not have any <code class=\"notranslate\">[:key, :job_options]</code><br>\nwhere it looks expected to return <code class=\"notranslate\">true</code>.</li>\n</ul>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ AJ_ADAPTER=que bin/test test/cases/queuing_test.rb:13\nUsing que\nRun options: --seed 32774\n\n# Running:\n\n[46, 55] in ~/src/github.com/rails/rails/activejob/lib/active_job/queue_adapters/que_adapter.rb\n    46|       end\n    47|\n    48|       private\n    49|         def require_job_options_kwarg?\n    50|           require 'debug'\n=&gt;  51|           binding.break\n    52|           @require_job_options_kwarg ||=\n    53|             JobWrapper.method(:enqueue).parameters.any? { |ptype, pname| ptype == :key &amp;&amp; pname == :job_options }\n    54|         end\n    55|\n=&gt;#0\tActiveJob::QueueAdapters::QueAdapter#require_job_options_kwarg? at ~/src/github.com/rails/rails/activejob/lib/active_job/queue_adapters/que_adapter.rb:51\n  #1\tActiveJob::QueueAdapters::QueAdapter#enqueue(job=#&lt;HelloJob:0x00007fc861807740 @arguments...) at ~/src/github.com/rails/rails/activejob/lib/active_job/queue_adapters/que_adapter.rb:24\n  # and 40 frames (use `bt' command for all frames)\n(rdbg) JobWrapper.method(:enqueue).parameters.any? { |ptype, pname| ptype == :key &amp;&amp; pname == :job_options }    # ruby\nfalse\n(rdbg) JobWrapper.method(:enqueue).parameters    # ruby\n[[:req, :args], [:keyreq, :priority], [:keyreq, :queue], [:key, :run_at]]\n(rdbg) quit    # command\nReally quit? [Y/n] Y\"><pre class=\"notranslate\">$ <span class=\"pl-c1\">AJ_ADAPTER</span><span class=\"pl-c1\">=</span><span class=\"pl-en\">que</span> <span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">cases</span>/<span class=\"pl-en\">queuing_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">13</span>\n<span class=\"pl-en\">Using</span> <span class=\"pl-en\">que</span>\n<span class=\"pl-en\">Run</span> <span class=\"pl-pds\">options</span>: --<span class=\"pl-en\">seed</span> <span class=\"pl-c1\">32774</span>\n\n<span class=\"pl-c\"># Running:</span>\n\n<span class=\"pl-kos\">[</span><span class=\"pl-c1\">46</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">55</span><span class=\"pl-kos\">]</span> <span class=\"pl-k\">in</span> ~/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activejob</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">queue_adapters</span>/<span class=\"pl-en\">que_adapter</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>\n    <span class=\"pl-c1\">46</span>|       <span class=\"pl-en\">end</span>\n    <span class=\"pl-c1\">47</span>|\n    <span class=\"pl-c1\">48</span>|       <span class=\"pl-k\">private</span>\n    <span class=\"pl-c1\">49</span>|         <span class=\"pl-k\">def</span> <span class=\"pl-en\">require_job_options_kwarg?</span>\n    <span class=\"pl-c1\">50</span>|           <span class=\"pl-en\">require</span> <span class=\"pl-s\">'debug'</span>\n<span class=\"pl-c1\">=&gt;</span>  <span class=\"pl-c1\">51</span>|           <span class=\"pl-en\">binding</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">break</span>\n    <span class=\"pl-c1\">52</span>|           <span class=\"pl-c1\">@require_job_options_kwarg</span> ||=\n    <span class=\"pl-c1\">53</span>|             <span class=\"pl-v\">JobWrapper</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">method</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:enqueue</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">parameters</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">any?</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">ptype</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">pname</span>| <span class=\"pl-s1\">ptype</span> == <span class=\"pl-pds\">:key</span> &amp;&amp; <span class=\"pl-s1\">pname</span> == <span class=\"pl-pds\">:job_options</span> <span class=\"pl-kos\">}</span>\n    <span class=\"pl-c1\">54</span>|         <span class=\"pl-en\">end</span>\n    <span class=\"pl-c1\">55</span>|\n<span class=\"pl-c1\">=&gt;</span><span class=\"pl-c\">#0\tActiveJob::QueueAdapters::QueAdapter#require_job_options_kwarg? at ~/src/github.com/rails/rails/activejob/lib/active_job/queue_adapters/que_adapter.rb:51</span>\n  <span class=\"pl-c\">#1\tActiveJob::QueueAdapters::QueAdapter#enqueue(job=#&lt;HelloJob:0x00007fc861807740 @arguments...) at ~/src/github.com/rails/rails/activejob/lib/active_job/queue_adapters/que_adapter.rb:24</span>\n  <span class=\"pl-c\"># and 40 frames (use `bt' command for all frames)</span>\n<span class=\"pl-kos\">(</span><span class=\"pl-en\">rdbg</span><span class=\"pl-kos\">)</span> <span class=\"pl-v\">JobWrapper</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">method</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:enqueue</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">parameters</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">any?</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">ptype</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">pname</span>| <span class=\"pl-s1\">ptype</span> == <span class=\"pl-pds\">:key</span> &amp;&amp; <span class=\"pl-s1\">pname</span> == <span class=\"pl-pds\">:job_options</span> <span class=\"pl-kos\">}</span>    <span class=\"pl-c\"># ruby</span>\n<span class=\"pl-c1\">false</span>\n<span class=\"pl-kos\">(</span><span class=\"pl-en\">rdbg</span><span class=\"pl-kos\">)</span> <span class=\"pl-v\">JobWrapper</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">method</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:enqueue</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">parameters</span>    <span class=\"pl-c\"># ruby</span>\n<span class=\"pl-kos\">[</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:req</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:args</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">[</span><span class=\"pl-pds\">:keyreq</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:priority</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">[</span><span class=\"pl-pds\">:keyreq</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:queue</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">[</span><span class=\"pl-pds\">:key</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:run_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">]</span>\n<span class=\"pl-kos\">(</span><span class=\"pl-en\">rdbg</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\"></span> <span class=\"pl-en\">quit</span>    <span class=\"pl-c\"># command</span>\n<span class=\"pl-v\">Really</span> <span class=\"pl-en\">quit?</span> <span class=\"pl-kos\">[</span><span class=\"pl-c1\">Y</span>/<span class=\"pl-en\">n</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">Y</span></pre></div>\n<ul dir=\"auto\">\n<li>By changing <code class=\"notranslate\">require_job_options_kwarg?</code> always returns <code class=\"notranslate\">true</code>, it raises <code class=\"notranslate\">ArgumentError: missing keywords: :priority, :queue</code></li>\n</ul>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ git diff\ndiff --git a/activejob/lib/active_job/queue_adapters/que_adapter.rb b/activejob/lib/active_job/queue_adapters/que_adapter.rb\nindex 41b3633a07..54e8cbc39b 100644\n--- a/activejob/lib/active_job/queue_adapters/que_adapter.rb\n+++ b/activejob/lib/active_job/queue_adapters/que_adapter.rb\n@@ -47,6 +47,7 @@ def enqueue_at(job, timestamp) # :nodoc:\n\n       private\n         def require_job_options_kwarg?\n+          return true\n           @require_job_options_kwarg ||=\n             JobWrapper.method(:enqueue).parameters.any? { |ptype, pname| ptype == :key &amp;&amp; pname == :job_options }\n         end\n$\"><pre class=\"notranslate\">$ <span class=\"pl-en\">git</span> <span class=\"pl-en\">diff</span>\n<span class=\"pl-en\">diff</span> --<span class=\"pl-en\">git</span> <span class=\"pl-en\">a</span>/<span class=\"pl-en\">activejob</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">queue_adapters</span>/<span class=\"pl-en\">que_adapter</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span> <span class=\"pl-en\">b</span>/<span class=\"pl-en\">activejob</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">queue_adapters</span>/<span class=\"pl-en\">que_adapter</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>\n<span class=\"pl-en\">index</span> <span class=\"pl-c1\">41</span><span class=\"pl-en\">b3633a07</span>..<span class=\"pl-c1\">54e8</span><span class=\"pl-en\">cbc39b</span> <span class=\"pl-c1\">100644</span>\n--- <span class=\"pl-en\">a</span>/<span class=\"pl-en\">activejob</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">queue_adapters</span>/<span class=\"pl-en\">que_adapter</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>\n+++ <span class=\"pl-en\">b</span>/<span class=\"pl-en\">activejob</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">queue_adapters</span>/<span class=\"pl-en\">que_adapter</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>\n@@ -<span class=\"pl-c1\">47</span><span class=\"pl-kos\">,</span><span class=\"pl-c1\">6</span> +<span class=\"pl-c1\">47</span><span class=\"pl-kos\">,</span><span class=\"pl-c1\">7</span> @@ <span class=\"pl-k\">def</span> <span class=\"pl-en\">enqueue_at</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">job</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">timestamp</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\"># :nodoc:</span>\n\n       <span class=\"pl-k\">private</span>\n         <span class=\"pl-k\">def</span> <span class=\"pl-en\">require_job_options_kwarg?</span>\n+          <span class=\"pl-k\">return</span> <span class=\"pl-c1\">true</span>\n           <span class=\"pl-c1\">@require_job_options_kwarg</span> ||=\n             <span class=\"pl-v\">JobWrapper</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">method</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:enqueue</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">parameters</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">any?</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">ptype</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">pname</span>| <span class=\"pl-s1\">ptype</span> == <span class=\"pl-pds\">:key</span> &amp;&amp; <span class=\"pl-s1\">pname</span> == <span class=\"pl-pds\">:job_options</span> <span class=\"pl-kos\">}</span>\n         <span class=\"pl-k\">end</span>\n$</pre></div>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ AJ_ADAPTER=que bin/test test/cases/queuing_test.rb:13\nUsing que\nRun options: --seed 21508\n\n# Running:\n\nE\n\nError:\nQueuingTest#test_run_queued_job:\nArgumentError: missing keywords: :priority, :queue\n    /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/que-2.2.0/lib/que/active_job/extensions.rb:65:in `enqueue'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/queue_adapters/que_adapter.rb:25:in `enqueue'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/enqueuing.rb:67:in `block in enqueue'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:118:in `block in run_callbacks'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/instrumentation.rb:28:in `block in instrument'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/notifications.rb:206:in `block in instrument'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/notifications/instrumenter.rb:58:in `instrument'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/notifications.rb:206:in `instrument'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/instrumentation.rb:27:in `instrument'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/instrumentation.rb:9:in `block (2 levels) in &lt;module:Instrumentation&gt;'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:127:in `instance_exec'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:127:in `block in run_callbacks'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/logging.rb:27:in `tag_logger'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/logging.rb:14:in `block (2 levels) in &lt;module:Logging&gt;'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:127:in `instance_exec'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:127:in `block in run_callbacks'\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:138:in `run_callbacks'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/enqueuing.rb:63:in `enqueue'\n    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/enqueuing.rb:30:in `perform_later'\n    /home/yahonda/src/github.com/rails/rails/activejob/test/cases/queuing_test.rb:14:in `block in &lt;class:QueuingTest&gt;'\n\n\nbin/test test/cases/queuing_test.rb:13\n\n\n\nFinished in 0.008724s, 114.6312 runs/s, 0.0000 assertions/s.\n1 runs, 0 assertions, 0 failures, 1 errors, 0 skips\n$\"><pre class=\"notranslate\">$ <span class=\"pl-c1\">AJ_ADAPTER</span><span class=\"pl-c1\">=</span><span class=\"pl-en\">que</span> <span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">cases</span>/<span class=\"pl-en\">queuing_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">13</span>\n<span class=\"pl-en\">Using</span> <span class=\"pl-en\">que</span>\n<span class=\"pl-en\">Run</span> <span class=\"pl-pds\">options</span>: --<span class=\"pl-en\">seed</span> <span class=\"pl-c1\">21508</span>\n\n<span class=\"pl-c\"># Running:</span>\n\n<span class=\"pl-c1\">E</span>\n\n<span class=\"pl-v\">Error</span>:\n<span class=\"pl-v\">QueuingTest</span><span class=\"pl-c\">#test_run_queued_job:</span>\n<span class=\"pl-en\">ArgumentError</span>: <span class=\"pl-en\">missing</span> <span class=\"pl-pds\">keywords</span>: <span class=\"pl-pds\">:priority</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:queue</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-kos\">.</span><span class=\"pl-en\">rbenv</span>/<span class=\"pl-en\">versions</span>/<span class=\"pl-c1\">3.1</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">2</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">ruby</span>/<span class=\"pl-en\">gems</span>/<span class=\"pl-c1\">3.1</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">0</span>/<span class=\"pl-en\">gems</span>/<span class=\"pl-en\">que</span>-<span class=\"pl-c1\">2.2</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">0</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">que</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">extensions</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">65</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">enqueue</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/queue_adapters/que_adapter.rb:25:in `enqueue'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activejob</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">enqueuing</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">67</span><span class=\"pl-pds\">:in</span> <span class=\"pl-s\">`block in enqueue'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:118:in `</span><span class=\"pl-kos\"></span><span class=\"pl-en\">block</span> <span class=\"pl-en\">in</span> <span class=\"pl-en\">run_callbacks</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/instrumentation.rb:28:in `block in instrument'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activesupport</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_support</span>/<span class=\"pl-en\">notifications</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">206</span><span class=\"pl-pds\">:in</span> <span class=\"pl-s\">`block in instrument'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/notifications/instrumenter.rb:58:in `</span><span class=\"pl-en\">instrument</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/notifications.rb:206:in `instrument'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activejob</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">instrumentation</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">27</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">instrument</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/instrumentation.rb:9:in `block (2 levels) in &lt;module:Instrumentation&gt;'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activesupport</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_support</span>/<span class=\"pl-en\">callbacks</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">127</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">instance_exec</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:127:in `block in run_callbacks'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activejob</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">logging</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">27</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">tag_logger</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/logging.rb:14:in `block (2 levels) in &lt;module:Logging&gt;'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activesupport</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_support</span>/<span class=\"pl-en\">callbacks</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">127</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">instance_exec</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:127:in `block in run_callbacks'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activesupport</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_support</span>/<span class=\"pl-en\">callbacks</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">138</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">run_callbacks</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activejob/lib/active_job/enqueuing.rb:63:in `enqueue'</span>\n    <span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-en\">src</span>/<span class=\"pl-en\">github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activejob</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">active_job</span>/<span class=\"pl-en\">enqueuing</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">30</span><span class=\"pl-pds\">:in</span> `<span class=\"pl-en\">perform_later</span><span class=\"pl-s\">'</span>\n<span class=\"pl-s\">    /home/yahonda/src/github.com/rails/rails/activejob/test/cases/queuing_test.rb:14:in `block in &lt;class:QueuingTest&gt;'</span>\n\n\n<span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">cases</span>/<span class=\"pl-en\">queuing_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">13</span>\n\n\n\n<span class=\"pl-en\">Finished</span> <span class=\"pl-en\">in</span> <span class=\"pl-c1\">0.008724</span><span class=\"pl-en\">s</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">114.6312</span> <span class=\"pl-en\">runs</span>/<span class=\"pl-en\">s</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0.0000</span> <span class=\"pl-en\">assertions</span>/<span class=\"pl-en\">s</span><span class=\"pl-kos\">.</span>\n<span class=\"pl-c1\">1</span> <span class=\"pl-en\">runs</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0</span> <span class=\"pl-en\">assertions</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0</span> <span class=\"pl-en\">failures</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">1</span> <span class=\"pl-en\">errors</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0</span> <span class=\"pl-en\">skips</span>\n$</pre></div>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: main branch</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: $ ruby -v<br>\nruby 3.1.2p20 (2022-04-12 revision 4491bb740a) [x86_64-linux]</p>",
            "url": "https://github.com/rails/rails/issues/45899",
            "title": "Active Job unit tests fail using que 2.2.0",
            "date_modified": "2022-09-12T23:22:43.000Z",
            "date_published": "2022-08-29T04:24:06.000Z",
            "author": {
                "name": "yahonda",
                "url": "https://github.com/yahonda"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1222990?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Enqueuing a deserialized job in adapter calls <code class=\"notranslate\">serialize</code> again, and that loses the arguments.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class DemoJob &lt; ActiveJob::Base\n  def perform(name)\n     puts 'hello #{name}!'\n  end\nend\n\np ActiveJob::Base.deserialize(DemoJob.new('world').serialize).serialize # =&gt; {&quot;job_class&quot;=&gt;&quot;DemoJob&quot;, &quot;job_id&quot;=&gt;&quot;#################&quot;, &quot;queue_name&quot;=&gt;&quot;default&quot;, &quot;arguments&quot;=&gt;[]}\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">DemoJob</span> &lt; <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">name</span><span class=\"pl-kos\">)</span>\n     <span class=\"pl-en\">puts</span> <span class=\"pl-s\">'hello #{name}!'</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">p</span> <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">deserialize</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">DemoJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'world'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">serialize</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">serialize</span> <span class=\"pl-c\"># =&gt; {\"job_class\"=&gt;\"DemoJob\", \"job_id\"=&gt;\"#################\", \"queue_name\"=&gt;\"default\", \"arguments\"=&gt;[]}</span></pre></div>\n<p dir=\"auto\">Actual deserialization of arguments is currently delayed until <code class=\"notranslate\">perform_now</code> (its <code class=\"notranslate\">deserialize_arguments_if_needed</code> call), but <code class=\"notranslate\">serialize</code> method neither deserializes arguments nor passes on the still serialized arguments.</p>\n<p dir=\"auto\">I was trying to construct a job that receives another job to be performed conditionally using <code class=\"notranslate\">ActiveJob::Base#serialize</code> and <code class=\"notranslate\">ActiveJob::Base.deserialize</code> pair.</p>",
            "url": "https://github.com/rails/rails/issues/19619",
            "title": "ActiveJob: serializing a deserialized job loses arguments",
            "date_modified": "2022-08-26T00:00:08.000Z",
            "date_published": "2015-04-02T07:45:36.000Z",
            "author": {
                "name": "ippeiukai",
                "url": "https://github.com/ippeiukai"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/4856944?u=c67acdd5c153db30ec195161a8fd4f0b149a41c8&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Steps to reproduce</h3>\n\n<p dir=\"auto\">Not 100% sure about this, and I apologize if this turns out to be a red herring or non-reproducible; but at least one other person seems to be having the same issue as I am, so I'm creating this ticket.</p>\n<p dir=\"auto\">Issue seems to be happening specifically in apps created with the <code class=\"notranslate\">--api --database=postgresql</code>  flags.</p>\n<p dir=\"auto\">Previous discussion in <a href=\"https://stackoverflow.com/questions/74497573/cant-create-a-database-using-postgresql-with-rails\" rel=\"nofollow\">this stackoverflow</a> is related.</p>\n<h3 dir=\"auto\">Test case</h3>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"rails new testapp --api --database=postgresql\ncd testapp\nrake db:create\"><pre class=\"notranslate\">rails new testapp --api --database=postgresql\n<span class=\"pl-c1\">cd</span> testapp\nrake db:create</pre></div>\n<p dir=\"auto\">This comes back with</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ActiveRecord::NoDatabaseError: We could not find your database: postgres. Which can be found in the database configuration file located at config/database.yml.\"><pre class=\"notranslate\"><code class=\"notranslate\">ActiveRecord::NoDatabaseError: We could not find your database: postgres. Which can be found in the database configuration file located at config/database.yml.\n</code></pre></div>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">It should not try to connect to <code class=\"notranslate\">postgres</code> database.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\">It tries to connect to <code class=\"notranslate\">postgres</code> database.  It seems to be picking up the <code class=\"notranslate\">default</code> config as an actual environment... the <code class=\"notranslate\">pg</code> gem's default database name is <code class=\"notranslate\">postgres</code>... put 2 + 2 together and you might have yourself a bug.</p>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: 7.0.4</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: ruby 3.1.2p20 (2022-04-12 revision 4491bb740a) [x86_64-linux]</p>",
            "url": "https://github.com/rails/rails/issues/46577",
            "title": "Is `rake db:create` accidentally treating the `default` config as an environment on par with `development`/`test`/`production`? ",
            "date_modified": "2022-11-25T12:41:17.000Z",
            "date_published": "2022-11-25T10:00:29.000Z",
            "author": {
                "name": "monarchwadia",
                "url": "https://github.com/monarchwadia"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/73684?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Managed to reproduce <a href=\"https://buildkite.com/rails/rails/builds/89114#0182ef6a-4316-4671-981b-3dafdeee29a2\" rel=\"nofollow\">https://buildkite.com/rails/rails/builds/89114#0182ef6a-4316-4671-981b-3dafdeee29a2</a></p>\n<h3 dir=\"auto\">Steps to reproduce</h3>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"git clone https://github.com/rails/rails\ncd rails/activejob\nbundle update redis --conservative\ngit diff\nbundle exec rake test:integration:resque\nAJ_INTEGRATION_TESTS=1 AJ_ADAPTER=sidekiq bin/test test/integration/queuing_test.rb\"><pre class=\"notranslate\"><span class=\"pl-en\">git</span> <span class=\"pl-en\">clone</span> <span class=\"pl-pds\">https</span>:<span class=\"pl-pds\">//github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>\n<span class=\"pl-en\">cd</span> <span class=\"pl-en\">rails</span>/<span class=\"pl-en\">activejob</span>\n<span class=\"pl-en\">bundle</span> <span class=\"pl-en\">update</span> <span class=\"pl-en\">redis</span> --<span class=\"pl-en\">conservative</span>\n<span class=\"pl-en\">git</span> <span class=\"pl-en\">diff</span>\n<span class=\"pl-en\">bundle</span> <span class=\"pl-en\">exec</span> <span class=\"pl-en\">rake</span> <span class=\"pl-pds\">test</span>:<span class=\"pl-en\">integration</span>:<span class=\"pl-en\">resque</span>\n<span class=\"pl-c1\">AJ_INTEGRATION_TESTS</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">1</span> <span class=\"pl-c1\">AJ_ADAPTER</span><span class=\"pl-c1\">=</span><span class=\"pl-en\">sidekiq</span> <span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">integration</span>/<span class=\"pl-en\">queuing_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span></pre></div>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">Both of Active Job integration tests for <code class=\"notranslate\">resque</code> and <code class=\"notranslate\">sidekiq</code> should pass.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ git diff\ndiff --git a/Gemfile.lock b/Gemfile.lock\nindex 28cfa23d9c..c39161f625 100644\n--- a/Gemfile.lock\n+++ b/Gemfile.lock\n@@ -400,7 +400,10 @@ GEM\n     rbtree (0.4.5)\n     rdoc (6.3.3)\n     redcarpet (3.2.3)\n-    redis (4.7.1)\n+    redis (5.0.1)\n+      redis-client (~&gt; 0.7)\n+    redis-client (0.7.1)\n+      connection_pool\n     redis-namespace (1.8.1)\n       redis (&gt;= 3.0.4)\n     regexp_parser (2.2.1)\n$\"><pre class=\"notranslate\">$ <span class=\"pl-en\">git</span> <span class=\"pl-en\">diff</span>\n<span class=\"pl-en\">diff</span> --<span class=\"pl-en\">git</span> <span class=\"pl-en\">a</span>/<span class=\"pl-v\">Gemfile</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lock</span> <span class=\"pl-en\">b</span>/<span class=\"pl-v\">Gemfile</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lock</span>\n<span class=\"pl-en\">index</span> <span class=\"pl-c1\">28</span><span class=\"pl-en\">cfa23d9c</span>..<span class=\"pl-en\">c39161f625</span> <span class=\"pl-c1\">100644</span>\n--- <span class=\"pl-en\">a</span>/<span class=\"pl-v\">Gemfile</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lock</span>\n+++ <span class=\"pl-en\">b</span>/<span class=\"pl-v\">Gemfile</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lock</span>\n@@ -<span class=\"pl-c1\">400</span><span class=\"pl-kos\">,</span><span class=\"pl-c1\">7</span> +<span class=\"pl-c1\">400</span><span class=\"pl-kos\">,</span><span class=\"pl-c1\">10</span> @@ <span class=\"pl-c1\">GEM</span>\n     <span class=\"pl-en\">rbtree</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">0.4</span><span class=\"pl-kos\">.</span><span class=\"pl-en\"></span><span class=\"pl-c1\">5</span><span class=\"pl-kos\">)</span>\n     <span class=\"pl-en\">rdoc</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">6.3</span><span class=\"pl-kos\">.</span><span class=\"pl-en\"></span><span class=\"pl-c1\">3</span><span class=\"pl-kos\">)</span>\n     <span class=\"pl-en\">redcarpet</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">3.2</span><span class=\"pl-kos\">.</span><span class=\"pl-en\"></span><span class=\"pl-c1\">3</span><span class=\"pl-kos\">)</span>\n-    <span class=\"pl-en\">redis</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">4.7</span><span class=\"pl-kos\">.</span><span class=\"pl-en\"></span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span>\n+    <span class=\"pl-en\">redis</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">5.0</span><span class=\"pl-kos\">.</span><span class=\"pl-en\"></span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span>\n+      <span class=\"pl-en\">redis</span>-<span class=\"pl-en\">client</span> <span class=\"pl-kos\">(</span>~&gt; <span class=\"pl-c1\">0.7</span><span class=\"pl-kos\">)</span>\n+    <span class=\"pl-en\">redis</span>-<span class=\"pl-en\">client</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">0.7</span><span class=\"pl-kos\">.</span><span class=\"pl-en\"></span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span>\n+      <span class=\"pl-en\">connection_pool</span>\n     <span class=\"pl-en\">redis</span>-<span class=\"pl-en\">namespace</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1.8</span><span class=\"pl-kos\">.</span><span class=\"pl-en\"></span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span>\n       <span class=\"pl-en\">redis</span> <span class=\"pl-kos\">(</span>&gt;= <span class=\"pl-c1\">3.0</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">4</span><span class=\"pl-kos\">)</span>\n     <span class=\"pl-en\">regexp_parser</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">2.2</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span>\n$</pre></div>\n<ul dir=\"auto\">\n<li>for resque <code class=\"notranslate\">redis-client-0.7.1/lib/redis_client/config.rb:20:in </code>initialize': unknown keyword: :thread_safe (ArgumentError)`</li>\n</ul>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ bundle exec rake test:integration:resque\n/home/yahonda/.rbenv/versions/3.1.2/bin/ruby -w -I&quot;lib:test&quot; /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/rake_test_loader.rb &quot;test/integration/queuing_test.rb&quot;\nUsing resque\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/zeitwerk-2.6.0/lib/zeitwerk/kernel.rb:24: warning: method redefined; discarding old require\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/bootsnap-1.9.3/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:27: warning: previous definition of require was here\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32454: warning: statement not reached\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32615: warning: statement not reached\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32651: warning: statement not reached\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32740: warning: statement not reached\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32756: warning: statement not reached\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32822: warning: statement not reached\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32863: warning: statement not reached\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32888: warning: statement not reached\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:31984: warning: assigned but unused variable - testEof\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/httpclient-2.8.3/lib/httpclient/ssl_config.rb:370: warning: assigned but unused variable - pathlen\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/httpclient-2.8.3/lib/httpclient/ssl_config.rb:51: warning: method redefined; discarding old initialize\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/httpclient-2.8.3/lib/httpclient/ssl_config.rb:58: warning: method redefined; discarding old add_cert\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/httpclient-2.8.3/lib/httpclient/ssl_config.rb:58: warning: method redefined; discarding old add_file\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/httpclient-2.8.3/lib/httpclient/ssl_config.rb:58: warning: method redefined; discarding old add_path\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/cookiejar-0.3.3/lib/cookiejar/cookie.rb:183: warning: mismatched indentations at 'end' with 'else' at 181\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/cookiejar-0.3.3/lib/cookiejar/jar.rb:225: warning: mismatched indentations at 'end' with 'else' at 223\n/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/redis-client-0.7.1/lib/redis_client/config.rb:20:in `initialize': unknown keyword: :thread_safe (ArgumentError)\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/redis-client-0.7.1/lib/redis_client/config.rb:155:in `initialize'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/redis-client-0.7.1/lib/redis_client.rb:122:in `new'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/redis-client-0.7.1/lib/redis_client.rb:122:in `config'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/redis-5.0.1/lib/redis/client.rb:22:in `config'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/redis-5.0.1/lib/redis.rb:157:in `initialize_client'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/redis-5.0.1/lib/redis.rb:73:in `initialize'\n\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/support/integration/adapters/resque.rb:6:in `new'\n\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/support/integration/adapters/resque.rb:6:in `setup'\n\tfrom /tmp/d20220831-278031-adlbts/dummy/config/initializers/activejob.rb:2:in `&lt;main&gt;'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/bootsnap-1.9.3/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:60:in `load'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/bootsnap-1.9.3/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:60:in `load'\n\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/engine.rb:673:in `block in load_config_initializer'\n\tfrom /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/notifications.rb:208:in `instrument'\n\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/engine.rb:672:in `load_config_initializer'\n\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/engine.rb:626:in `block (2 levels) in &lt;class:Engine&gt;'\n\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/engine.rb:625:in `each'\n\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/engine.rb:625:in `block in &lt;class:Engine&gt;'\n\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/initializable.rb:32:in `instance_exec'\n\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/initializable.rb:32:in `run'\n\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/initializable.rb:61:in `block in run_initializers'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:228:in `block in tsort_each'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:350:in `block (2 levels) in each_strongly_connected_component'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:422:in `block (2 levels) in each_strongly_connected_component_from'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:431:in `each_strongly_connected_component_from'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:421:in `block in each_strongly_connected_component_from'\n\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/initializable.rb:50:in `each'\n\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/initializable.rb:50:in `tsort_each_child'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:415:in `call'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:415:in `each_strongly_connected_component_from'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:349:in `block in each_strongly_connected_component'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:347:in `each'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:347:in `call'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:347:in `each_strongly_connected_component'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:226:in `tsort_each'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:205:in `tsort_each'\n\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/initializable.rb:60:in `run_initializers'\n\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/application.rb:372:in `initialize!'\n\tfrom /tmp/d20220831-278031-adlbts/dummy/config/environment.rb:5:in `&lt;top (required)&gt;'\n\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/support/integration/helper.rb:16:in `require'\n\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/support/integration/helper.rb:16:in `&lt;top (required)&gt;'\n\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/helper.rb:12:in `require'\n\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/helper.rb:12:in `&lt;top (required)&gt;'\n\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/integration/queuing_test.rb:3:in `require'\n\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/integration/queuing_test.rb:3:in `&lt;top (required)&gt;'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/rake_test_loader.rb:21:in `require'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/rake_test_loader.rb:21:in `block in &lt;main&gt;'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/rake_test_loader.rb:6:in `select'\n\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/rake_test_loader.rb:6:in `&lt;main&gt;'\nrake aborted!\nCommand failed with status (1): [ruby -w -I&quot;lib:test&quot; /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/rake_test_loader.rb &quot;test/integration/queuing_test.rb&quot; ]\n/home/yahonda/.rbenv/versions/3.1.2/bin/bundle:25:in `load'\n/home/yahonda/.rbenv/versions/3.1.2/bin/bundle:25:in `&lt;main&gt;'\nTasks: TOP =&gt; test:integration:resque\n(See full trace by running task with --trace)\n$\"><pre class=\"notranslate\">$ <span class=\"pl-en\">bundle</span> <span class=\"pl-en\">exec</span> <span class=\"pl-en\">rake</span> <span class=\"pl-pds\">test</span>:<span class=\"pl-en\">integration</span>:<span class=\"pl-en\">resque</span>\n<span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-kos\">.</span><span class=\"pl-en\">rbenv</span>/<span class=\"pl-en\">versions</span>/<span class=\"pl-c1\">3.1</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">2</span>/<span class=\"pl-en\">bin</span>/<span class=\"pl-en\">ruby</span> -<span class=\"pl-en\">w</span> -<span class=\"pl-c1\">I</span><span class=\"pl-s\">\"lib:test\"</span> /<span class=\"pl-en\">home</span>/<span class=\"pl-en\">yahonda</span>/<span class=\"pl-kos\">.</span><span class=\"pl-en\">rbenv</span>/<span class=\"pl-en\">versions</span>/<span class=\"pl-c1\">3.1</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">2</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">ruby</span>/<span class=\"pl-en\">gems</span>/<span class=\"pl-c1\">3.1</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">0</span>/<span class=\"pl-en\">gems</span>/<span class=\"pl-en\">rake</span>-<span class=\"pl-c1\">13.0</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">6</span>/<span class=\"pl-en\">lib</span>/<span class=\"pl-en\">rake</span>/<span class=\"pl-en\">rake_test_loader</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span> \"<span class=\"pl-en\">test</span>/<span class=\"pl-en\">integration</span>/<span class=\"pl-en\">queuing_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span><span class=\"pl-s\">\"</span>\n<span class=\"pl-s\">Using resque</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/zeitwerk-2.6.0/lib/zeitwerk/kernel.rb:24: warning: method redefined; discarding old require</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/bootsnap-1.9.3/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:27: warning: previous definition of require was here</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32454: warning: statement not reached</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32615: warning: statement not reached</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32651: warning: statement not reached</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32740: warning: statement not reached</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32756: warning: statement not reached</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32822: warning: statement not reached</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32863: warning: statement not reached</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:32888: warning: statement not reached</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/mail-2.7.1/lib/mail/parsers/address_lists_parser.rb:31984: warning: assigned but unused variable - testEof</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/httpclient-2.8.3/lib/httpclient/ssl_config.rb:370: warning: assigned but unused variable - pathlen</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/httpclient-2.8.3/lib/httpclient/ssl_config.rb:51: warning: method redefined; discarding old initialize</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/httpclient-2.8.3/lib/httpclient/ssl_config.rb:58: warning: method redefined; discarding old add_cert</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/httpclient-2.8.3/lib/httpclient/ssl_config.rb:58: warning: method redefined; discarding old add_file</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/httpclient-2.8.3/lib/httpclient/ssl_config.rb:58: warning: method redefined; discarding old add_path</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/cookiejar-0.3.3/lib/cookiejar/cookie.rb:183: warning: mismatched indentations at 'end' with 'else' at 181</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/cookiejar-0.3.3/lib/cookiejar/jar.rb:225: warning: mismatched indentations at 'end' with 'else' at 223</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/redis-client-0.7.1/lib/redis_client/config.rb:20:in `initialize': unknown keyword: :thread_safe (ArgumentError)</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/redis-client-0.7.1/lib/redis_client/config.rb:155:in `initialize'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/redis-client-0.7.1/lib/redis_client.rb:122:in `new'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/redis-client-0.7.1/lib/redis_client.rb:122:in `config'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/redis-5.0.1/lib/redis/client.rb:22:in `config'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/redis-5.0.1/lib/redis.rb:157:in `initialize_client'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/redis-5.0.1/lib/redis.rb:73:in `initialize'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/support/integration/adapters/resque.rb:6:in `new'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/support/integration/adapters/resque.rb:6:in `setup'</span>\n<span class=\"pl-s\">\tfrom /tmp/d20220831-278031-adlbts/dummy/config/initializers/activejob.rb:2:in `&lt;main&gt;'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/bootsnap-1.9.3/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:60:in `load'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/bootsnap-1.9.3/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:60:in `load'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/engine.rb:673:in `block in load_config_initializer'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/notifications.rb:208:in `instrument'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/engine.rb:672:in `load_config_initializer'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/engine.rb:626:in `block (2 levels) in &lt;class:Engine&gt;'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/engine.rb:625:in `each'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/engine.rb:625:in `block in &lt;class:Engine&gt;'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/initializable.rb:32:in `instance_exec'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/initializable.rb:32:in `run'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/initializable.rb:61:in `block in run_initializers'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:228:in `block in tsort_each'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:350:in `block (2 levels) in each_strongly_connected_component'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:422:in `block (2 levels) in each_strongly_connected_component_from'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:431:in `each_strongly_connected_component_from'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:421:in `block in each_strongly_connected_component_from'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/initializable.rb:50:in `each'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/initializable.rb:50:in `tsort_each_child'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:415:in `call'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:415:in `each_strongly_connected_component_from'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:349:in `block in each_strongly_connected_component'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:347:in `each'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:347:in `call'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:347:in `each_strongly_connected_component'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:226:in `tsort_each'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/3.1.0/tsort.rb:205:in `tsort_each'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/initializable.rb:60:in `run_initializers'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/railties/lib/rails/application.rb:372:in `initialize!'</span>\n<span class=\"pl-s\">\tfrom /tmp/d20220831-278031-adlbts/dummy/config/environment.rb:5:in `&lt;top (required)&gt;'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/support/integration/helper.rb:16:in `require'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/support/integration/helper.rb:16:in `&lt;top (required)&gt;'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/helper.rb:12:in `require'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/helper.rb:12:in `&lt;top (required)&gt;'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/integration/queuing_test.rb:3:in `require'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/src/github.com/rails/rails/activejob/test/integration/queuing_test.rb:3:in `&lt;top (required)&gt;'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/rake_test_loader.rb:21:in `require'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/rake_test_loader.rb:21:in `block in &lt;main&gt;'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/rake_test_loader.rb:6:in `select'</span>\n<span class=\"pl-s\">\tfrom /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/rake_test_loader.rb:6:in `&lt;main&gt;'</span>\n<span class=\"pl-s\">rake aborted!</span>\n<span class=\"pl-s\">Command failed with status (1): [ruby -w -I\"</span><span class=\"pl-en\">lib</span><span class=\"pl-pds\">:test</span><span class=\"pl-s\">\" /home/yahonda/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/rake_test_loader.rb \"</span><span class=\"pl-en\">test</span>/<span class=\"pl-en\">integration</span>/<span class=\"pl-en\">queuing_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>\" <span class=\"pl-kos\">]</span>\n<span class=\"pl-pds\">/home/yahonda</span>/<span class=\"pl-kos\">.</span><span class=\"pl-en\">rbenv</span>/<span class=\"pl-en\">versions</span>/<span class=\"pl-c1\">3.1</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">2</span>/<span class=\"pl-en\">bin</span>/<span class=\"pl-en\">bundle</span>:<span class=\"pl-c1\">25</span><span class=\"pl-pds\">:in</span> <span class=\"pl-s\">`load'</span>\n<span class=\"pl-s\">/home/yahonda/.rbenv/versions/3.1.2/bin/bundle:25:in `</span>&lt;<span class=\"pl-en\">main</span>&gt;'\n<span class=\"pl-v\">Tasks</span>: <span class=\"pl-c1\">TOP</span> <span class=\"pl-c1\">=</span>&gt; <span class=\"pl-pds\">test</span><span class=\"pl-pds\">:integration</span><span class=\"pl-pds\">:resque</span>\n<span class=\"pl-kos\">(</span><span class=\"pl-en\">See</span> <span class=\"pl-en\">full</span> <span class=\"pl-en\">trace</span> <span class=\"pl-en\">by</span> <span class=\"pl-en\">running</span> <span class=\"pl-en\">task</span> <span class=\"pl-en\">with</span> --<span class=\"pl-en\">trace</span><span class=\"pl-kos\">)</span>\n$</pre></div>\n<ul dir=\"auto\">\n<li>for sidekiq</li>\n</ul>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ AJ_INTEGRATION_TESTS=1 AJ_ADAPTER=sidekiq bin/test test/integration/queuing_test.rb\nUsing sidekiq\nRun options: --seed 44047\n\n# Running:\n\n.F\n\nFailure:\nQueuingTest#test_should_run_jobs_enqueued_on_a_listening_queue [/home/yahonda/src/github.com/rails/rails/activejob/test/integration/queuing_test.rb:13]:\nJob AJ-129bbbb5-e8ba-480b-b4b6-5f386868c6e4 was not executed\n\n\nbin/test test/integration/queuing_test.rb:10\n\nF\n\nFailure:\nQueuingTest#test_current_timezone_is_kept_while_running_perform_later [/home/yahonda/src/github.com/rails/rails/activejob/test/integration/queuing_test.rb:118]:\nJob AJ-a1d7d95b-4a1e-45b9-ab5f-7d50a809fe41 was not executed\n\n\nbin/test test/integration/queuing_test.rb:109\n\n.SF\n\nFailure:\nQueuingTest#test_current_locale_is_kept_while_running_perform_later [/home/yahonda/src/github.com/rails/rails/activejob/test/integration/queuing_test.rb:101]:\nJob AJ-eaf07152-0f27-4d5d-8b81-4023971c352e was not executed\n\n\nbin/test test/integration/queuing_test.rb:92\n\nSSS.F\n\nFailure:\nQueuingTest#test_should_run_job_enqueued_in_the_future_at_the_specified_time [/home/yahonda/src/github.com/rails/rails/activejob/test/integration/queuing_test.rb:75]:\nJob AJ-3152b499-0fbe-4e13-ae37-ccc708eb7784 was not executed\n\n\nbin/test test/integration/queuing_test.rb:70\n\n...\n\nFinished in 34.074661s, 0.4109 runs/s, 0.3522 assertions/s.\n14 runs, 12 assertions, 4 failures, 0 errors, 4 skips\n\nYou have skipped tests. Run with --verbose for details.\n$\"><pre class=\"notranslate\">$ <span class=\"pl-c1\">AJ_INTEGRATION_TESTS</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">1</span> <span class=\"pl-c1\">AJ_ADAPTER</span><span class=\"pl-c1\">=</span><span class=\"pl-en\">sidekiq</span> <span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">integration</span>/<span class=\"pl-en\">queuing_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>\n<span class=\"pl-en\">Using</span> <span class=\"pl-en\">sidekiq</span>\n<span class=\"pl-en\">Run</span> <span class=\"pl-pds\">options</span>: --<span class=\"pl-en\">seed</span> <span class=\"pl-c1\">44047</span>\n\n<span class=\"pl-c\"># Running:</span>\n\n<span class=\"pl-kos\">.</span><span class=\"pl-en\">F</span>\n\n<span class=\"pl-v\">Failure</span>:\n<span class=\"pl-v\">QueuingTest</span><span class=\"pl-c\">#test_should_run_jobs_enqueued_on_a_listening_queue [/home/yahonda/src/github.com/rails/rails/activejob/test/integration/queuing_test.rb:13]:</span>\n<span class=\"pl-en\">Job</span> <span class=\"pl-c1\">AJ</span>-<span class=\"pl-c1\">129</span><span class=\"pl-en\">bbbb5</span>-<span class=\"pl-en\">e8ba</span>-<span class=\"pl-c1\">480</span><span class=\"pl-en\">b</span>-<span class=\"pl-en\">b4b6</span>-<span class=\"pl-c1\">5</span><span class=\"pl-en\">f386868c6e4</span> <span class=\"pl-en\">was</span> not <span class=\"pl-en\">executed</span>\n\n\n<span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">integration</span>/<span class=\"pl-en\">queuing_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">10</span>\n\n<span class=\"pl-en\">F</span>\n\n<span class=\"pl-v\">Failure</span>:\n<span class=\"pl-v\">QueuingTest</span><span class=\"pl-c\">#test_current_timezone_is_kept_while_running_perform_later [/home/yahonda/src/github.com/rails/rails/activejob/test/integration/queuing_test.rb:118]:</span>\n<span class=\"pl-en\">Job</span> <span class=\"pl-c1\">AJ</span>-<span class=\"pl-en\">a1d7d95b</span>-<span class=\"pl-c1\">4</span><span class=\"pl-en\">a1e</span>-<span class=\"pl-c1\">45</span><span class=\"pl-en\">b9</span>-<span class=\"pl-en\">ab5f</span>-<span class=\"pl-c1\">7</span><span class=\"pl-en\">d50a809fe41</span> <span class=\"pl-en\">was</span> not <span class=\"pl-en\">executed</span>\n\n\n<span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">integration</span>/<span class=\"pl-en\">queuing_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">109</span>\n\n<span class=\"pl-kos\">.</span><span class=\"pl-en\">SF</span>\n\n<span class=\"pl-v\">Failure</span>:\n<span class=\"pl-v\">QueuingTest</span><span class=\"pl-c\">#test_current_locale_is_kept_while_running_perform_later [/home/yahonda/src/github.com/rails/rails/activejob/test/integration/queuing_test.rb:101]:</span>\n<span class=\"pl-en\">Job</span> <span class=\"pl-c1\">AJ</span>-<span class=\"pl-en\">eaf07152</span>-<span class=\"pl-c1\">0</span><span class=\"pl-en\">f27</span>-<span class=\"pl-c1\">4</span><span class=\"pl-en\">d5d</span>-<span class=\"pl-c1\">8</span><span class=\"pl-en\">b81</span>-<span class=\"pl-c1\">4023971</span><span class=\"pl-en\">c352e</span> <span class=\"pl-en\">was</span> not <span class=\"pl-en\">executed</span>\n\n\n<span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">integration</span>/<span class=\"pl-en\">queuing_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">92</span>\n\n<span class=\"pl-en\">SSS</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">F</span>\n\n<span class=\"pl-v\">Failure</span>:\n<span class=\"pl-v\">QueuingTest</span><span class=\"pl-c\">#test_should_run_job_enqueued_in_the_future_at_the_specified_time [/home/yahonda/src/github.com/rails/rails/activejob/test/integration/queuing_test.rb:75]:</span>\n<span class=\"pl-en\">Job</span> <span class=\"pl-c1\">AJ</span>-<span class=\"pl-c1\">3152</span><span class=\"pl-en\">b499</span>-<span class=\"pl-c1\">0</span><span class=\"pl-en\">fbe</span>-<span class=\"pl-c1\">4e13</span>-<span class=\"pl-en\">ae37</span>-<span class=\"pl-en\">ccc708eb7784</span> <span class=\"pl-en\">was</span> not <span class=\"pl-en\">executed</span>\n\n\n<span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">integration</span>/<span class=\"pl-en\">queuing_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">70</span>\n\n...\n\n<span class=\"pl-en\">Finished</span> <span class=\"pl-en\">in</span> <span class=\"pl-c1\">34.074661</span><span class=\"pl-en\">s</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0.4109</span> <span class=\"pl-en\">runs</span>/<span class=\"pl-en\">s</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0.3522</span> <span class=\"pl-en\">assertions</span>/<span class=\"pl-en\">s</span><span class=\"pl-kos\">.</span>\n<span class=\"pl-c1\">14</span> <span class=\"pl-en\">runs</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">12</span> <span class=\"pl-en\">assertions</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">4</span> <span class=\"pl-en\">failures</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0</span> <span class=\"pl-en\">errors</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">4</span> <span class=\"pl-en\">skips</span>\n\n<span class=\"pl-en\">You</span> <span class=\"pl-en\">have</span> <span class=\"pl-en\">skipped</span> <span class=\"pl-en\">tests</span><span class=\"pl-kos\">.</span> <span class=\"pl-en\">Run</span> <span class=\"pl-en\">with</span> --<span class=\"pl-en\">verbose</span> <span class=\"pl-k\">for</span> <span class=\"pl-en\">details</span><span class=\"pl-kos\">.</span>\n$</pre></div>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: main branch</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: ruby 3.1.2p20 (2022-04-12 revision 4491bb740a) [x86_64-linux]</p>",
            "url": "https://github.com/rails/rails/issues/45913",
            "title": "Active Job integration tests for `resque` and `sidekiq` fail with `redis` 5.0.1 and `redis-client` 0.7.1",
            "date_modified": "2022-09-07T17:35:35.000Z",
            "date_published": "2022-08-30T23:52:34.000Z",
            "author": {
                "name": "yahonda",
                "url": "https://github.com/yahonda"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/58794487?u=05c4631c63c592c91ed47388ea1f261ca4aea578&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Steps to reproduce</h3>\n<ul dir=\"auto\">\n<li>have an app with active storage</li>\n</ul>\n<h3 dir=\"auto\">Expected behavior</h3>\n<ul dir=\"auto\">\n<li>no errors from active storage</li>\n</ul>\n<h3 dir=\"auto\">Actual behavior</h3>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">ActiveStorage::FileNotFoundError</code>s</li>\n</ul>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: Rails 6.1.4</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: ruby 3.0.2p107 (2021-07-07 revision 0db68f0233) [x86_64-darwin20]</p>\n<p dir=\"auto\">I'm not sure which file I should delete and how to not receive this type of errors</p>",
            "url": "https://github.com/rails/rails/issues/42923",
            "title": "`on_rescue ActiveStorage::FileNotFoundError, :delete`",
            "date_modified": "2022-11-23T12:57:51.000Z",
            "date_published": "2021-07-31T05:15:11.000Z",
            "author": {
                "name": "dorianmariefr",
                "url": "https://github.com/dorianmariefr"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/16985871?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Steps to reproduce</h3>\n<p dir=\"auto\">Run <code class=\"notranslate\">rails new skip_active_job_error -T -a sprockets -j rollup -c bulma -d sqlite3 --skip-active-job -f</code>. The guilty part is <code class=\"notranslate\">--skip-active-job</code>, there's no error without it.</p>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">No errors.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<blockquote>\n<p dir=\"auto\">NoMethodError: undefined method `action_mailer' for #&lt;Rails::Application::Configuration</p>\n</blockquote>\n<details>\n  <summary>Stacktrace</summary>\n  <pre class=\"notranslate\">$ rails new sqlite_rollup_manual -T -a sprockets -j rollup -c bulma -d sqlite3 --skip-active-job -f                            35s\n      create\n      create  README.md\n      create  Rakefile\n      create  .ruby-version\n      create  config.ru\n      create  .gitignore\n      create  .gitattributes\n      create  Gemfile\n         run  git init from \".\"\nInitialized empty Git repository in /Users/me/ws/tzif.io/hix/tryouts/sqlite_rollup_manual/.git/\n      create  app\n      create  app/assets/config/manifest.js\n      create  app/assets/stylesheets/application.css\n      create  app/channels/application_cable/channel.rb\n      create  app/channels/application_cable/connection.rb\n      create  app/controllers/application_controller.rb\n      create  app/helpers/application_helper.rb\n      create  app/jobs/application_job.rb\n      create  app/mailers/application_mailer.rb\n      create  app/models/application_record.rb\n      create  app/views/layouts/application.html.erb\n      create  app/views/layouts/mailer.html.erb\n      create  app/views/layouts/mailer.text.erb\n      create  app/assets/images\n      create  app/assets/images/.keep\n      create  app/controllers/concerns/.keep\n      create  app/models/concerns/.keep\n      create  bin\n      create  bin/rails\n      create  bin/rake\n      create  bin/setup\n      create  config\n      create  config/routes.rb\n      create  config/application.rb\n      create  config/environment.rb\n      create  config/cable.yml\n      create  config/puma.rb\n      create  config/environments\n      create  config/environments/development.rb\n      create  config/environments/production.rb\n      create  config/environments/test.rb\n      create  config/initializers\n      create  config/initializers/assets.rb\n      create  config/initializers/content_security_policy.rb\n      create  config/initializers/cors.rb\n      create  config/initializers/filter_parameter_logging.rb\n      create  config/initializers/inflections.rb\n      create  config/initializers/new_framework_defaults_7_0.rb\n      create  config/initializers/permissions_policy.rb\n      create  config/locales\n      create  config/locales/en.yml\n      create  config/master.key\n      append  .gitignore\n      create  config/boot.rb\n      create  config/database.yml\n      create  db\n      create  db/seeds.rb\n      create  lib\n      create  lib/tasks\n      create  lib/tasks/.keep\n      create  lib/assets\n      create  lib/assets/.keep\n      create  log\n      create  log/.keep\n      create  public\n      create  public/404.html\n      create  public/422.html\n      create  public/500.html\n      create  public/apple-touch-icon-precomposed.png\n      create  public/apple-touch-icon.png\n      create  public/favicon.ico\n      create  public/robots.txt\n      create  tmp\n      create  tmp/.keep\n      create  tmp/pids\n      create  tmp/pids/.keep\n      create  tmp/cache\n      create  tmp/cache/assets\n      create  vendor\n      create  vendor/.keep\n      remove  app/jobs\n      remove  config/initializers/cors.rb\n      remove  config/initializers/new_framework_defaults_7_0.rb\n         run  bundle install\nFetching gem metadata from https://rubygems.org/...........\nResolving dependencies.......\nUsing rake 13.0.6\nUsing concurrent-ruby 1.1.10\nUsing minitest 5.16.3\nUsing nio4r 2.5.8\nUsing erubi 1.11.0\nUsing racc 1.6.0\nUsing bundler 2.3.23\nUsing rack 2.2.4\nUsing crass 1.0.6\nUsing method_source 1.0.0\nUsing thor 1.2.1\nUsing zeitwerk 2.6.1\nUsing io-console 0.5.11\nUsing sqlite3 1.5.3 (arm64-darwin)\nUsing i18n 1.12.0\nUsing tzinfo 2.0.5\nUsing puma 5.6.5\nUsing websocket-extensions 0.1.5\nUsing mini_mime 1.1.2\nUsing reline 0.3.1\nUsing marcel 1.0.2\nUsing builder 3.2.4\nUsing timeout 0.3.0\nUsing bindex 0.8.1\nUsing msgpack 1.6.0\nUsing nokogiri 1.13.9 (arm64-darwin)\nUsing activesupport 7.0.4\nUsing loofah 2.19.0\nUsing rack-test 2.0.2\nUsing rails-dom-testing 2.0.3\nUsing rails-html-sanitizer 1.4.3\nUsing globalid 1.0.0\nUsing websocket-driver 0.7.5\nUsing mail 2.7.1\nUsing net-protocol 0.1.3\nUsing bootsnap 1.13.0\nUsing net-imap 0.3.1\nUsing net-pop 0.1.2\nUsing net-smtp 0.3.2\nUsing irb 1.4.2\nUsing sprockets 4.1.1\nUsing actionview 7.0.4\nUsing debug 1.6.2\nUsing actionpack 7.0.4\nUsing activejob 7.0.4\nUsing railties 7.0.4\nUsing jbuilder 2.11.5\nUsing cssbundling-rails 1.1.1\nUsing actioncable 7.0.4\nUsing sprockets-rails 3.4.2\nUsing actionmailer 7.0.4\nUsing jsbundling-rails 1.0.3\nUsing stimulus-rails 1.1.0\nUsing turbo-rails 1.3.1\nUsing activemodel 7.0.4\nUsing activerecord 7.0.4\nUsing web-console 4.2.0\nUsing activestorage 7.0.4\nUsing actionmailbox 7.0.4\nUsing actiontext 7.0.4\nUsing rails 7.0.4\nBundle complete! 13 Gemfile dependencies, 61 gems now installed.\nUse `bundle info [gemname]` to see where a bundled gem is installed.\n         run  bundle binstubs bundler\n       rails  javascript:install:rollup\nrails aborted!\nNoMethodError: undefined method `action_mailer' for #, @generators=#{:orm=&gt;:active_record, :system_tests=&gt;nil}, :active_record=&gt;{:migration=&gt;true, :timestamps=&gt;true}}, @fallbacks={}, @templates=[], @colorize_logging=true, @api_only=false, @hidden_namespaces=[], @after_generate_callbacks=[]&gt;, @middleware=#, @javascript_path=\"javascript\", @encoding=#, @allow_concurrency=nil, @consider_all_requests_local=true, @filter_parameters=[], @filter_redirect=[], @helpers_paths=[], @hosts=[\".localhost\", #, #], @host_authorization={}, @public_file_server=#true, :index_name=&gt;\"index\"}&gt;, @force_ssl=false, @ssl_options={:hsts=&gt;{:subdomains=&gt;true}}, @session_store=nil, @time_zone=\"UTC\", @beginning_of_week=:monday, @log_level=:debug, @cache_store=:null_store, @railties_order=[:all], @relative_url_root=nil, @reload_classes_only_on_change=true, @file_watcher=ActiveSupport::FileUpdateChecker, @exceptions_app=nil, @autoflush_log=true, @log_formatter=#, @eager_load=false, @secret_key_base=nil, @api_only=false, @debug_exception_response_format=nil, @x=#, @enable_dependency_loading=false, @read_encrypted_secrets=false, @content_security_policy=nil, @content_security_policy_report_only=false, @content_security_policy_nonce_generator=nil, @content_security_policy_nonce_directives=nil, @require_master_key=false, @loaded_config_version=7.0, @credentials=##, :key_path=&gt;#}&gt;, @disable_sandbox=false, @add_autoload_paths_to_load_path=true, @permissions_policy=nil, @rake_eager_load=false, @server_timing=true, @paths=#, @root={\"app\"=&gt;#, @glob=\"{*,*/concerns}\", @exclude=[\"assets\", \"javascript\"], @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/assets\"=&gt;#, @glob=\"*\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"app/controllers\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/channels\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/helpers\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/models\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/mailers\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/views\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"lib\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=true&gt;, \"lib/assets\"=&gt;#, @glob=\"*\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"lib/tasks\"=&gt;#, @glob=\"**/*.rake\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/environments\"=&gt;#, @glob=\"development.rb\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/initializers\"=&gt;#, @glob=\"**/*.rb\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/locales\"=&gt;#, @glob=\"**/*.{rb,yml}\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/routes.rb\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/routes\"=&gt;#, @glob=\"**/*.rb\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"db\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"db/migrate\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"db/seeds.rb\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"vendor\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=true&gt;, \"vendor/assets\"=&gt;#, @glob=\"*\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/database\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/secrets\"=&gt;#, @glob=\"secrets.yml{,.enc}\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/environment\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"lib/templates\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"log\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"public\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"public/javascripts\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"public/stylesheets\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"tmp\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;}&gt;, @cache_classes=false&gt;\n/Users/me/ws/tzif.io/hix/tryouts/sqlite_rollup_manual/config/environments/development.rb:37:in `block in '\n/Users/me/ws/tzif.io/hix/tryouts/sqlite_rollup_manual/config/environments/development.rb:3:in `'\n/Users/me/ws/tzif.io/hix/tryouts/sqlite_rollup_manual/config/environment.rb:5:in `'\nTasks: TOP =&gt; app:template =&gt; environment\n(See full trace by running task with --trace)\nrails aborted!\nNoMethodError: undefined method `action_mailer' for #, @generators=#{:orm=&gt;:active_record, :system_tests=&gt;nil}, :active_record=&gt;{:migration=&gt;true, :timestamps=&gt;true}}, @fallbacks={}, @templates=[], @colorize_logging=true, @api_only=false, @hidden_namespaces=[], @after_generate_callbacks=[]&gt;, @middleware=#, @javascript_path=\"javascript\", @encoding=#, @allow_concurrency=nil, @consider_all_requests_local=true, @filter_parameters=[], @filter_redirect=[], @helpers_paths=[], @hosts=[\".localhost\", #, #], @host_authorization={}, @public_file_server=#true, :index_name=&gt;\"index\"}&gt;, @force_ssl=false, @ssl_options={:hsts=&gt;{:subdomains=&gt;true}}, @session_store=nil, @time_zone=\"UTC\", @beginning_of_week=:monday, @log_level=:debug, @cache_store=:null_store, @railties_order=[:all], @relative_url_root=nil, @reload_classes_only_on_change=true, @file_watcher=ActiveSupport::FileUpdateChecker, @exceptions_app=nil, @autoflush_log=true, @log_formatter=#, @eager_load=false, @secret_key_base=nil, @api_only=false, @debug_exception_response_format=nil, @x=#, @enable_dependency_loading=false, @read_encrypted_secrets=false, @content_security_policy=nil, @content_security_policy_report_only=false, @content_security_policy_nonce_generator=nil, @content_security_policy_nonce_directives=nil, @require_master_key=false, @loaded_config_version=7.0, @credentials=##, :key_path=&gt;#}&gt;, @disable_sandbox=false, @add_autoload_paths_to_load_path=true, @permissions_policy=nil, @rake_eager_load=false, @server_timing=true, @paths=#, @root={\"app\"=&gt;#, @glob=\"{*,*/concerns}\", @exclude=[\"assets\", \"javascript\"], @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/assets\"=&gt;#, @glob=\"*\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"app/controllers\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/channels\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/helpers\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/models\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/mailers\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/views\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"lib\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=true&gt;, \"lib/assets\"=&gt;#, @glob=\"*\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"lib/tasks\"=&gt;#, @glob=\"**/*.rake\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/environments\"=&gt;#, @glob=\"development.rb\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/initializers\"=&gt;#, @glob=\"**/*.rb\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/locales\"=&gt;#, @glob=\"**/*.{rb,yml}\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/routes.rb\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/routes\"=&gt;#, @glob=\"**/*.rb\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"db\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"db/migrate\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"db/seeds.rb\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"vendor\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=true&gt;, \"vendor/assets\"=&gt;#, @glob=\"*\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/database\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/secrets\"=&gt;#, @glob=\"secrets.yml{,.enc}\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/environment\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"lib/templates\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"log\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"public\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"public/javascripts\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"public/stylesheets\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"tmp\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;}&gt;, @cache_classes=false&gt;\n/Users/me/ws/tzif.io/hix/tryouts/sqlite_rollup_manual/config/environments/development.rb:37:in `block in '\n/Users/me/ws/tzif.io/hix/tryouts/sqlite_rollup_manual/config/environments/development.rb:3:in `'\n/Users/me/ws/tzif.io/hix/tryouts/sqlite_rollup_manual/config/environment.rb:5:in `'\nTasks: TOP =&gt; app:template =&gt; environment\n(See full trace by running task with --trace)\n       rails  turbo:install stimulus:install\nYou must either be running with node (package.json) or importmap-rails (config/importmap.rb) to use this gem.\nYou must either be running with node (package.json) or importmap-rails (config/importmap.rb) to use this gem.\n       rails  css:install:bulma\nrails aborted!\nNoMethodError: undefined method `action_mailer' for #, @generators=#{:orm=&gt;:active_record, :system_tests=&gt;nil}, :active_record=&gt;{:migration=&gt;true, :timestamps=&gt;true}}, @fallbacks={}, @templates=[], @colorize_logging=true, @api_only=false, @hidden_namespaces=[], @after_generate_callbacks=[]&gt;, @middleware=#, @javascript_path=\"javascript\", @encoding=#, @allow_concurrency=nil, @consider_all_requests_local=true, @filter_parameters=[], @filter_redirect=[], @helpers_paths=[], @hosts=[\".localhost\", #, #], @host_authorization={}, @public_file_server=#true, :index_name=&gt;\"index\"}&gt;, @force_ssl=false, @ssl_options={:hsts=&gt;{:subdomains=&gt;true}}, @session_store=nil, @time_zone=\"UTC\", @beginning_of_week=:monday, @log_level=:debug, @cache_store=:null_store, @railties_order=[:all], @relative_url_root=nil, @reload_classes_only_on_change=true, @file_watcher=ActiveSupport::FileUpdateChecker, @exceptions_app=nil, @autoflush_log=true, @log_formatter=#, @eager_load=false, @secret_key_base=nil, @api_only=false, @debug_exception_response_format=nil, @x=#, @enable_dependency_loading=false, @read_encrypted_secrets=false, @content_security_policy=nil, @content_security_policy_report_only=false, @content_security_policy_nonce_generator=nil, @content_security_policy_nonce_directives=nil, @require_master_key=false, @loaded_config_version=7.0, @credentials=##, :key_path=&gt;#}&gt;, @disable_sandbox=false, @add_autoload_paths_to_load_path=true, @permissions_policy=nil, @rake_eager_load=false, @server_timing=true, @paths=#, @root={\"app\"=&gt;#, @glob=\"{*,*/concerns}\", @exclude=[\"assets\", \"javascript\"], @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/assets\"=&gt;#, @glob=\"*\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"app/controllers\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/channels\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/helpers\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/models\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/mailers\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/views\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"lib\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=true&gt;, \"lib/assets\"=&gt;#, @glob=\"*\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"lib/tasks\"=&gt;#, @glob=\"**/*.rake\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/environments\"=&gt;#, @glob=\"development.rb\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/initializers\"=&gt;#, @glob=\"**/*.rb\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/locales\"=&gt;#, @glob=\"**/*.{rb,yml}\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/routes.rb\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/routes\"=&gt;#, @glob=\"**/*.rb\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"db\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"db/migrate\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"db/seeds.rb\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"vendor\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=true&gt;, \"vendor/assets\"=&gt;#, @glob=\"*\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/database\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/secrets\"=&gt;#, @glob=\"secrets.yml{,.enc}\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/environment\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"lib/templates\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"log\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"public\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"public/javascripts\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"public/stylesheets\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"tmp\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;}&gt;, @cache_classes=false&gt;\n/Users/me/ws/tzif.io/hix/tryouts/sqlite_rollup_manual/config/environments/development.rb:37:in `block in '\n/Users/me/ws/tzif.io/hix/tryouts/sqlite_rollup_manual/config/environments/development.rb:3:in `'\n/Users/me/ws/tzif.io/hix/tryouts/sqlite_rollup_manual/config/environment.rb:5:in `'\nTasks: TOP =&gt; app:template =&gt; environment\n(See full trace by running task with --trace)\nrails aborted!\nNoMethodError: undefined method `action_mailer' for #, @generators=#{:orm=&gt;:active_record, :system_tests=&gt;nil}, :active_record=&gt;{:migration=&gt;true, :timestamps=&gt;true}}, @fallbacks={}, @templates=[], @colorize_logging=true, @api_only=false, @hidden_namespaces=[], @after_generate_callbacks=[]&gt;, @middleware=#, @javascript_path=\"javascript\", @encoding=#, @allow_concurrency=nil, @consider_all_requests_local=true, @filter_parameters=[], @filter_redirect=[], @helpers_paths=[], @hosts=[\".localhost\", #, #], @host_authorization={}, @public_file_server=#true, :index_name=&gt;\"index\"}&gt;, @force_ssl=false, @ssl_options={:hsts=&gt;{:subdomains=&gt;true}}, @session_store=nil, @time_zone=\"UTC\", @beginning_of_week=:monday, @log_level=:debug, @cache_store=:null_store, @railties_order=[:all], @relative_url_root=nil, @reload_classes_only_on_change=true, @file_watcher=ActiveSupport::FileUpdateChecker, @exceptions_app=nil, @autoflush_log=true, @log_formatter=#, @eager_load=false, @secret_key_base=nil, @api_only=false, @debug_exception_response_format=nil, @x=#, @enable_dependency_loading=false, @read_encrypted_secrets=false, @content_security_policy=nil, @content_security_policy_report_only=false, @content_security_policy_nonce_generator=nil, @content_security_policy_nonce_directives=nil, @require_master_key=false, @loaded_config_version=7.0, @credentials=##, :key_path=&gt;#}&gt;, @disable_sandbox=false, @add_autoload_paths_to_load_path=true, @permissions_policy=nil, @rake_eager_load=false, @server_timing=true, @paths=#, @root={\"app\"=&gt;#, @glob=\"{*,*/concerns}\", @exclude=[\"assets\", \"javascript\"], @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/assets\"=&gt;#, @glob=\"*\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"app/controllers\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/channels\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/helpers\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/models\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/mailers\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=true, @autoload=false, @load_path=false&gt;, \"app/views\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"lib\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=true&gt;, \"lib/assets\"=&gt;#, @glob=\"*\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"lib/tasks\"=&gt;#, @glob=\"**/*.rake\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/environments\"=&gt;#, @glob=\"development.rb\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/initializers\"=&gt;#, @glob=\"**/*.rb\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/locales\"=&gt;#, @glob=\"**/*.{rb,yml}\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/routes.rb\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/routes\"=&gt;#, @glob=\"**/*.rb\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"db\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"db/migrate\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"db/seeds.rb\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"vendor\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=true&gt;, \"vendor/assets\"=&gt;#, @glob=\"*\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/database\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/secrets\"=&gt;#, @glob=\"secrets.yml{,.enc}\", @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"config/environment\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"lib/templates\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"log\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"public\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"public/javascripts\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"public/stylesheets\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;, \"tmp\"=&gt;#, @glob=nil, @exclude=nil, @autoload_once=false, @eager_load=false, @autoload=false, @load_path=false&gt;}&gt;, @cache_classes=false&gt;\n/Users/me/ws/tzif.io/hix/tryouts/sqlite_rollup_manual/config/environments/development.rb:37:in `block in '\n/Users/me/ws/tzif.io/hix/tryouts/sqlite_rollup_manual/config/environments/development.rb:3:in `'\n/Users/me/ws/tzif.io/hix/tryouts/sqlite_rollup_manual/config/environment.rb:5:in `'\nTasks: TOP =&gt; app:template =&gt; environment\n(See full trace by running task with --trace)\n  </pre>\n</details>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: 7.0.4</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: 3.1.2</p>",
            "url": "https://github.com/rails/rails/issues/46295",
            "title": "NoMethodError: undefined method `action_mailer' for #<Rails::Application::Configuration when using --skip-active-job flag",
            "date_modified": "2022-10-25T13:37:49.000Z",
            "date_published": "2022-10-21T06:48:01.000Z",
            "author": {
                "name": "wscourge",
                "url": "https://github.com/wscourge"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/47554?u=7f919feee43d319ec01c7b135f4d1868a31bddc3&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">ActiveRecord's <code class=\"notranslate\">destroy_association_async_job</code> currently loads an ActiveJob Job constant during ActiveRecord's initialization. Introduced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"690442175\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/40157\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/40157/hovercard\" href=\"https://github.com/rails/rails/pull/40157\">#40157</a></p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/4d5a570cfe1890f71a1d198a5fe40d528f2b60d4/activejob/lib/active_job/railtie.rb#L45-L47\">rails/activejob/lib/active_job/railtie.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 45 to 47\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/4d5a570cfe1890f71a1d198a5fe40d528f2b60d4\">4d5a570</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L45\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"45\"></td>\n          <td id=\"LC45\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-v\">ActiveSupport</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">on_load</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:active_record</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L46\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"46\"></td>\n          <td id=\"LC46\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">destroy_association_async_job</span> ||= <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">DestroyAssociationAsyncJob</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L47\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"47\"></td>\n          <td id=\"LC47\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">That means that loading ActiveRecord triggers loading the Job constant, which triggers initializing ActiveJob, which then triggers initializing the ActiveJob adapter. I have seen this cause an autoloading deadlock if somewhere during this chain an ActiveRecord constant is touched.</p>\n<p dir=\"auto\">A similar autoload chain is also present with <a href=\"https://github.com/rails/rails/blob/1003e974ed9cdae6a057a1857374bceb09b34a7b/actionmailer/lib/action_mailer/railtie.rb#L44-L46\"><code class=\"notranslate\">ActionMailer.delivery_job</code></a> but I have yet to see it deadlock (probably because people are less likely to reference an ActionMailer constant in their ActiveJob configuration).</p>\n<p dir=\"auto\">Aside: I also think that the ActiveJob initializer linked above should be inverted such that it lives in ActiveRecord and is assigned <code class=\"notranslate\">on_load(:active_job)</code>; that makes it more consistent with ActionMailers Railtie behavior. I don't think this impacts the autoload behavior though, just an observation.</p>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">This loading could be deferred if instead of a constant, <code class=\"notranslate\">destroy_association_async_job</code> was configured with a string that was then constantized when the behavior is invoked.</p>",
            "url": "https://github.com/rails/rails/issues/45434",
            "title": "Defer constant loading ActiveRecord `destroy_association_async_job` during Rails initialization",
            "date_modified": "2022-07-13T18:06:39.000Z",
            "date_published": "2022-06-22T20:27:20.000Z",
            "author": {
                "name": "bensheldon",
                "url": "https://github.com/bensheldon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5134584?u=eab647d5381368b9eb1beb306cb6ca79fb48696e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">We started using ActiveStorage in production recently and immediately started getting a large volume of FileNotFound errors in Analyze jobs. We are not using direct-to-S3 uploads, we are sending the files to our rails controller.</p>\n<p dir=\"auto\">I noticed in a rails console, when attaching an IO directly and saving, the AnalyzeJob is enqueued before the file is uploaded:</p>\n<p dir=\"auto\">This would explain the errors. Latency in our sidekiq queue is usually quite low, so I suspect the issue is that the analysis job runs before the image is fully uploaded. From what I can tell, the jobs usually succeed on retry.</p>\n<h3 dir=\"auto\">Steps to reproduce</h3>\n<ul dir=\"auto\">\n<li>directly attach an io</li>\n<li>save</li>\n<li>observe that enqueue occurs before the upload is complete</li>\n</ul>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/5134584/80838952-03f2c180-8baf-11ea-96e6-daec0ff2ca32.png\"><img src=\"https://user-images.githubusercontent.com/5134584/80838952-03f2c180-8baf-11ea-96e6-daec0ff2ca32.png\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">Analyze job shouldn't be enqueued until the upload is complete.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\">Analyze job is enqueued before the upload is complete</p>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: 6.0.2.2</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: 2.6.2</p>",
            "url": "https://github.com/rails/rails/issues/39107",
            "title": "ActiveStorage::FileNotFoundError in AnalyzeJob due to enqueue-before-upload",
            "date_modified": "2022-09-23T20:15:50.000Z",
            "date_published": "2020-05-01T20:41:53.000Z",
            "author": {
                "name": "andrewhamon",
                "url": "https://github.com/andrewhamon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/12839?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">(I'm not quite sure if that issue is limited to the DelayedJob adapter)</p>\n<h3 dir=\"auto\">Steps to reproduce</h3>\n<p dir=\"auto\">Demo project with traces: <a href=\"https://github.com/fnordfish/activejob-poison-pill-demo\">https://github.com/fnordfish/activejob-poison-pill-demo</a>.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class TestJob &lt; ActiveJob::Base\n  # Thid has no effect on Exceptions thrown in Queue Adapters?\n  discard_on Encoding::CompatibilityError\n  \n  # this will eventually bubble up into the Adapter (when retries exhausted?)\n  retry_on Exception, wait: 1.second\n\n  def perform(message)\n    raise message.dup.force_encoding(&quot;ASCII-8BIT&quot;)\n  end\nend\n\nTestJob.perform_later(&quot;&quot;)\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">TestJob</span> &lt; <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-c\"># Thid has no effect on Exceptions thrown in Queue Adapters?</span>\n  <span class=\"pl-en\">discard_on</span> <span class=\"pl-v\">Encoding</span>::<span class=\"pl-v\">CompatibilityError</span>\n  \n  <span class=\"pl-c\"># this will eventually bubble up into the Adapter (when retries exhausted?)</span>\n  <span class=\"pl-en\">retry_on</span> <span class=\"pl-v\">Exception</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">wait</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">second</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">message</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-en\">raise</span> <span class=\"pl-s1\">message</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">force_encoding</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"ASCII-8BIT\"</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">TestJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">perform_later</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"\"</span><span class=\"pl-kos\">)</span></pre></div>\n<h3 dir=\"auto\">Expected behavior</h3>\n<ul dir=\"auto\">\n<li>Job fails</li>\n<li>Exception trace of the <code class=\"notranslate\">Encoding::CompatibilityError</code> is logged</li>\n<li>Job worker keeps on working, not trying the failed job again</li>\n</ul>\n<h3 dir=\"auto\">Actual behavior</h3>\n<ul dir=\"auto\">\n<li>Job fails</li>\n<li>Exception trace of the <code class=\"notranslate\">Encoding::CompatibilityError</code> is logged</li>\n<li>Job worker crashes with <code class=\"notranslate\">Encoding::CompatibilityError</code> exception</li>\n<li>Restarting the job worker will try the failed job again, crashing the job worker again</li>\n</ul>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: 7.0.3, 7.1.0.alpha</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: 3.1</p>",
            "url": "https://github.com/rails/rails/issues/45418",
            "title": "Active Job worker crashes when a job causes an Exception in DelayedJob",
            "date_modified": "2022-07-05T17:22:57.000Z",
            "date_published": "2022-06-21T10:07:33.000Z",
            "author": {
                "name": "fnordfish",
                "url": "https://github.com/fnordfish"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1007217?u=926692fa6fed90c89bf35df114d93e71d2bdf300&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Steps to reproduce</h3>\n<p dir=\"auto\">I encountered this error while following DHH's youtube video \"Rails 7: The Demo\" at 9:10. I have a fresh install of Ubuntu 20.04 and RoR. I got the same error on another computer with a freshly installed Ubuntu and RoR.  Here are the steps:</p>\n<ol dir=\"auto\">\n<li>Install action_text and add a rich_text_area to a form.</li>\n<li>Run rails server</li>\n<li>add some text and image to the rich text and hit submit (just like in the video)</li>\n</ol>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">contents of form get saved normally along with image getting uploaded.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\">Rails server quits and I see the following error:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"...\n...\n#&lt;Thread:0x00007fd7113596f8 /home/dynamic/.rvm/gems/ruby-3.0.2/gems/actionpack-7.0.0/lib/action_controller/metal/live.rb:340 run&gt; terminated with exception (report_on_exception is true):\n/home/dynamic/.rvm/gems/ruby-3.0.2/gems/ffi-1.15.4/lib/ffi/library.rb:145:in `block in ffi_lib': Could not open library 'vips.so.42': vips.so.42: cannot open shared object file: No such file or directory. (LoadError)\nCould not open library 'libvips.so.42': libvips.so.42: cannot open shared object file: No such file or directory\n\tfrom /home/dynamic/.rvm/gems/ruby-3.0.2/gems/ffi-1.15.4/lib/ffi/library.rb:99:in `map'\n\tfrom /home/dynamic/.rvm/gems/ruby-3.0.2/gems/ffi-1.15.4/lib/ffi/library.rb:99:in `ffi_lib'\n\tfrom /home/dynamic/.rvm/gems/ruby-3.0.2/gems/ruby-vips-2.1.4/lib/vips.rb:573:in `&lt;module:Vips&gt;'\n\tfrom /home/dynamic/.rvm/gems/ruby-3.0.2/gems/ruby-vips-2.1.4/lib/vips.rb:570:in `&lt;main&gt;'\n...\n...\"><pre class=\"notranslate\"><code class=\"notranslate\">...\n...\n#&lt;Thread:0x00007fd7113596f8 /home/dynamic/.rvm/gems/ruby-3.0.2/gems/actionpack-7.0.0/lib/action_controller/metal/live.rb:340 run&gt; terminated with exception (report_on_exception is true):\n/home/dynamic/.rvm/gems/ruby-3.0.2/gems/ffi-1.15.4/lib/ffi/library.rb:145:in `block in ffi_lib': Could not open library 'vips.so.42': vips.so.42: cannot open shared object file: No such file or directory. (LoadError)\nCould not open library 'libvips.so.42': libvips.so.42: cannot open shared object file: No such file or directory\n\tfrom /home/dynamic/.rvm/gems/ruby-3.0.2/gems/ffi-1.15.4/lib/ffi/library.rb:99:in `map'\n\tfrom /home/dynamic/.rvm/gems/ruby-3.0.2/gems/ffi-1.15.4/lib/ffi/library.rb:99:in `ffi_lib'\n\tfrom /home/dynamic/.rvm/gems/ruby-3.0.2/gems/ruby-vips-2.1.4/lib/vips.rb:573:in `&lt;module:Vips&gt;'\n\tfrom /home/dynamic/.rvm/gems/ruby-3.0.2/gems/ruby-vips-2.1.4/lib/vips.rb:570:in `&lt;main&gt;'\n...\n...\n</code></pre></div>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: 7.0.0</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: 3.0.3</p>\n<h3 dir=\"auto\">What fixed the issue:</h3>\n<p dir=\"auto\">I installed ImageMagick and libvips: <code class=\"notranslate\">sudo apt install imagemagick libvips</code> and the error went away and everything works normally. It took me a long time to figure that out. I hope there is a more appropriate error message when ImageMagick and libvips are not installed on the computer. The error message should clearly ask the user to install ImageMagick to proceed. This will save a lot of frustration and time.</p>",
            "url": "https://github.com/rails/rails/issues/43976",
            "title": "Active Text / Active Storage: vips.so.42: cannot open shared object file: No such file or directory",
            "date_modified": "2022-11-10T20:18:20.000Z",
            "date_published": "2021-12-22T22:57:41.000Z",
            "author": {
                "name": "overdrivemachines",
                "url": "https://github.com/overdrivemachines"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/21235090?u=89134f923570b6f52573ba0eef5e0c87c5d056ce&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Steps to reproduce</h3>\n<p dir=\"auto\">There are various ways to reproduce this. What I did was render an Action Text content field with an image attachment within a Turbo stream using the <code class=\"notranslate\">broadcasts_to</code> class method (which renders in a background job).</p>\n<p dir=\"auto\">Other issues referring to this behavior:</p>\n<ul dir=\"auto\">\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"776056318\" data-permission-text=\"Title is private\" data-url=\"https://github.com/hotwired/turbo-rails/issues/54\" data-hovercard-type=\"issue\" data-hovercard-url=\"/hotwired/turbo-rails/issues/54/hovercard\" href=\"https://github.com/hotwired/turbo-rails/issues/54\">hotwired/turbo-rails#54</a> (closed by the person who opened the issue, who found a workaround for other uses of Active Storage but not for the Action Text case)</li>\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"296738214\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/31979\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/31979/hovercard\" href=\"https://github.com/rails/rails/issues/31979\">#31979</a> (closed by stale bot, contains full repro steps)</li>\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"419738384\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/35578\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/35578/hovercard\" href=\"https://github.com/rails/rails/issues/35578\">#35578</a> (fixed, but only for Action Mailer)</li>\n</ul>\n<p dir=\"auto\">It appears that this issue has been around for some time, and that it affects multiple out-of-the box uses of Rails.</p>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">The url in the image tag <code class=\"notranslate\">&lt;src&gt;</code> generated from the attachment should use the default host. In the case of my example from dev mode, it should be 'localhost'.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\">The attachment host in the <code class=\"notranslate\">&lt;src&gt;</code> url is 'example.org'. This differs from the behavior when rendering from a controller.</p>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: 6.1.3.1</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: 3.0.0</p>",
            "url": "https://github.com/rails/rails/issues/41795",
            "title": "Rendering a partial outside of a controller results in the wrong host being used in Active Storage URLs",
            "date_modified": "2022-11-24T16:18:36.000Z",
            "date_published": "2021-03-30T04:43:54.000Z",
            "author": {
                "name": "brian-kephart",
                "url": "https://github.com/brian-kephart"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1906547?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Steps to reproduce</h3>\n<ul dir=\"auto\">\n<li>Set adapter to perform jobs inline\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">ActiveJob::Base.queue_adapter = :inline</code></li>\n</ul>\n</li>\n<li>Set current attribute\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">Current.foo = \"bar\"</code></li>\n</ul>\n</li>\n<li>Perform job later\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">FooJob.perform_later</code></li>\n</ul>\n</li>\n<li>Check value of current attribute</li>\n</ul>\n<p dir=\"auto\">I've created a sample repo that shows the problem with tests. The second commit includes the most relevant code.</p>\n<p dir=\"auto\"><a href=\"https://github.com/tomprats/current-attributes-test\">https://github.com/tomprats/current-attributes-test</a></p>\n<h3 dir=\"auto\">Expected behavior</h3>\n<ul dir=\"auto\">\n<li>Current attributes should not be nil\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">Current.foo</code> =&gt; <code class=\"notranslate\">\"bar\"</code></li>\n</ul>\n</li>\n</ul>\n<h3 dir=\"auto\">Actual behavior</h3>\n<ul dir=\"auto\">\n<li>Current attribute will be null\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">Current.foo</code> =&gt; <code class=\"notranslate\">nil</code></li>\n</ul>\n</li>\n</ul>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: 5.2.3</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: 2.5.1</p>",
            "url": "https://github.com/rails/rails/issues/36298",
            "title": "Current Attributes gets reset in tests",
            "date_modified": "2022-08-04T04:59:11.000Z",
            "date_published": "2019-05-17T21:11:44.000Z",
            "author": {
                "name": "tomprats",
                "url": "https://github.com/tomprats"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/74608924?u=b7e6d326ee7a0f71b5a6c6b1fdca983246158fb8&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Steps to reproduce</h3>\n\n\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"1. Installing ActionText.\n2. Installing libvips, ruby-vips, ruby-ffi\n3. Adding config.active_storage.variant_processor = :vips to config/application.rb\n4. Adding has_rich_text :body to my Post.rb\n5. Adding the trix editor on the new post form.\n6. Adding a post with an image through the form.\"><pre class=\"notranslate\"><span class=\"pl-c1\">1</span><span class=\"pl-kos\">.</span> <span class=\"pl-en\">Installing</span> <span class=\"pl-v\">ActionText</span><span class=\"pl-kos\">.</span><span class=\"pl-en\"></span>\n<span class=\"pl-c1\">2</span><span class=\"pl-kos\">.</span> <span class=\"pl-en\">Installing</span> <span class=\"pl-en\">libvips</span><span class=\"pl-kos\">,</span> <span class=\"pl-en\">ruby</span>-<span class=\"pl-en\">vips</span><span class=\"pl-kos\">,</span> <span class=\"pl-en\">ruby</span>-<span class=\"pl-en\">ffi</span>\n<span class=\"pl-c1\">3</span><span class=\"pl-kos\">.</span> <span class=\"pl-en\">Adding</span> <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_storage</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">variant_processor</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">:vips</span> <span class=\"pl-en\">to</span> <span class=\"pl-en\">config</span>/<span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>\n<span class=\"pl-c1\">4</span><span class=\"pl-kos\">.</span> <span class=\"pl-en\">Adding</span> <span class=\"pl-en\">has_rich_text</span> <span class=\"pl-pds\">:body</span> <span class=\"pl-en\">to</span> <span class=\"pl-en\">my</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>\n<span class=\"pl-c1\">5</span><span class=\"pl-kos\">.</span> <span class=\"pl-en\">Adding</span> <span class=\"pl-en\">the</span> <span class=\"pl-en\">trix</span> <span class=\"pl-en\">editor</span> <span class=\"pl-en\">on</span> <span class=\"pl-en\">the</span> <span class=\"pl-en\">new</span> <span class=\"pl-en\">post</span> <span class=\"pl-en\">form</span><span class=\"pl-kos\">.</span><span class=\"pl-en\"></span>\n<span class=\"pl-c1\">6</span><span class=\"pl-kos\">.</span> <span class=\"pl-en\">Adding</span> <span class=\"pl-en\">a</span> <span class=\"pl-en\">post</span> <span class=\"pl-en\">with</span> <span class=\"pl-en\">an</span> <span class=\"pl-en\">image</span> <span class=\"pl-en\">through</span> <span class=\"pl-en\">the</span> <span class=\"pl-en\">form</span><span class=\"pl-kos\">.</span><span class=\"pl-en\"></span></pre></div>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">Should save the post and redirect to the newly created post page while rails continues to work.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\">Rails saves the post and after redirection, the rails server crashes without any error.</p>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>:<br>\nRails 7.0.2.2</p>\n<p dir=\"auto\"><strong>Ruby version</strong>:<br>\nruby 3.1.0p0 (2021-12-25 revision fb4df44d16) [x64-mingw-ucrt]</p>\n<h3 dir=\"auto\">Log before crash</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Started GET &quot;/posts/new&quot; for 127.0.0.1 at 2022-03-20 15:32:43 +0530\nProcessing by PostsController#new as HTML\n  Rendering layout layouts/application.html.erb\n  Rendering posts/new.html.erb within layouts/application\n  Rendered posts/new.html.erb within layouts/application (Duration: 90.2ms | Allocations: 12092)\n  Rendered components/_navbar.html.erb (Duration: 0.1ms | Allocations: 53)\n  Rendered layout layouts/application.html.erb (Duration: 110.0ms | Allocations: 17229)\nCompleted 200 OK in 116ms (Views: 111.6ms | ActiveRecord: 0.0ms | Allocations: 17669)\n\n\nStarted POST &quot;/rails/active_storage/direct_uploads&quot; for 127.0.0.1 at 2022-03-20 15:32:49 +0530\nProcessing by ActiveStorage::DirectUploadsController#create as JSON\n  Parameters: {&quot;blob&quot;=&gt;{&quot;filename&quot;=&gt;&quot;Untitled.png&quot;, &quot;content_type&quot;=&gt;&quot;image/png&quot;, &quot;byte_size&quot;=&gt;67712, &quot;checksum&quot;=&gt;&quot;JSkbfD1/qYR3jiMSQ4StXw==&quot;}, &quot;direct_upload&quot;=&gt;{&quot;blob&quot;=&gt;{&quot;filename&quot;=&gt;&quot;Untitled.png&quot;, &quot;content_type&quot;=&gt;&quot;image/png&quot;, &quot;byte_size&quot;=&gt;67712, &quot;checksum&quot;=&gt;&quot;JSkbfD1/qYR3jiMSQ4StXw==&quot;}}}\n  TRANSACTION (0.1ms)  begin transaction\n  ActiveStorage::Blob Create (1.8ms)  INSERT INTO &quot;active_storage_blobs&quot; (&quot;key&quot;, &quot;filename&quot;, &quot;content_type&quot;, &quot;metadata&quot;, &quot;service_name&quot;, &quot;byte_size&quot;, &quot;checksum&quot;, &quot;created_at&quot;) VALUES (?, ?, \n?, ?, ?, ?, ?, ?)  [[&quot;key&quot;, &quot;yg3tcj8az8wejmz1hc0baej8cb6l&quot;], [&quot;filename&quot;, &quot;Untitled.png&quot;], [&quot;content_type&quot;, &quot;image/png&quot;], [&quot;metadata&quot;, nil], [&quot;service_name&quot;, &quot;local&quot;], [&quot;byte_size&quot;, 67712], \n[&quot;checksum&quot;, &quot;JSkbfD1/qYR3jiMSQ4StXw==&quot;], [&quot;created_at&quot;, &quot;2022-03-20 10:02:49.678370&quot;]]        \n  TRANSACTION (4.8ms)  commit transaction\n  Disk Storage (0.9ms) Generated URL for file at key: yg3tcj8az8wejmz1hc0baej8cb6l (http://localhost:3000/rails/active_storage/disk/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdDam9JYTJWNVNTSWhlV2N6ZEdOcU9HRjZPSGRsYW0xNk1XaGpNR0poWldvNFkySTJiQVk2QmtWVU9oRmpiMjUwWlc1MFgzUjVjR1ZKSWc1cGJXRm5aUzl3Ym1jR093WlVPaE5qYjI1MFpXNTBYMnhsYm1kMGFHa0RnQWdCT2cxamFHVmphM04xYlVraUhVcFRhMkptUkRFdmNWbFNNMnBwVFZOUk5GTjBXSGM5UFFZN0JsUTZFWE5sY25acFkyVmZibUZ0WlRvS2JHOWpZV3c9IiwiZXhwIjoiMjAyMi0wMy0yMFQxMDowNzo0OS42OTRaIiwicHVyIjoiYmxvYl90b2tlbiJ9fQ==--dc343ddf348a3fa46f8d8b59c26e68893ed5ae00)       \nCompleted 200 OK in 27ms (Views: 0.6ms | ActiveRecord: 6.7ms | Allocations: 4744)\n\n\nStarted PUT &quot;/rails/active_storage/disk/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdDam9JYTJWNVNTSWhlV2N6ZEdOcU9HRjZPSGRsYW0xNk1XaGpNR0poWldvNFkySTJiQVk2QmtWVU9oRmpiMjUwWlc1MFgzUjVjR1ZKSWc1cGJXRm5aUzl3Ym1jR093WlVPaE5qYjI1MFpXNTBYMnhsYm1kMGFHa0RnQWdCT2cxamFHVmphM04xYlVraUhVcFRhMkptUkRFdmNWbFNNMnBwVFZOUk5GTjBXSGM5UFFZN0JsUTZFWE5sY25acFkyVmZibUZ0WlRvS2JHOWpZV3c9IiwiZXhwIjoiMjAyMi0wMy0yMFQxMDowNzo0OS42OTRaIiwicHVyIjoiYmxvYl90b2tlbiJ9fQ==--dc343ddf348a3fa46f8d8b59c26e68893ed5ae00&quot; for 127.0.0.1 at 2022-03-20 15:32:49 +0530\nProcessing by ActiveStorage::DiskController#update as */*\n  Parameters: {&quot;encoded_token&quot;=&gt;&quot;[FILTERED]&quot;}\n  Disk Storage (5.0ms) Uploaded file to key: yg3tcj8az8wejmz1hc0baej8cb6l (checksum: JSkbfD1/qYR3jiMSQ4StXw==)\nCompleted 204 No Content in 13ms (ActiveRecord: 0.0ms | Allocations: 497)\n\n\nStarted GET &quot;/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBIdz09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--50e4c4426007be24eaa37994d19f26672b7c16aa/Untitled.png&quot; for 127.0.0.1 at 2022-03-20 15:32:49 +0530\nProcessing by ActiveStorage::Blobs::RedirectController#show as PNG\n  Parameters: {&quot;signed_id&quot;=&gt;&quot;eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBIdz09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--50e4c4426007be24eaa37994d19f26672b7c16aa&quot;, &quot;filename&quot;=&gt;&quot;Untitled&quot;}\n   (0.1ms)  SELECT sqlite_version(*)\n  ActiveStorage::Blob Load (0.3ms)  SELECT &quot;active_storage_blobs&quot;.* FROM &quot;active_storage_blobs&quot; WHERE &quot;active_storage_blobs&quot;.&quot;id&quot; = ? LIMIT ?  [[&quot;id&quot;, 26], [&quot;LIMIT&quot;, 1]]\n  Disk Storage (1.1ms) Generated URL for file at key: yg3tcj8az8wejmz1hc0baej8cb6l (http://localhost:3000/rails/active_storage/disk/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdDVG9JYTJWNVNTSWhlV2N6ZEdOcU9HRjZPSGRsYW0xNk1XaGpNR0poWldvNFkySTJiQVk2QmtWVU9oQmthWE53YjNOcGRHbHZia2tpUTJsdWJHbHVaVHNnWm1sc1pXNWhiV1U5SWxWdWRHbDBiR1ZrTG5CdVp5STdJR1pwYkdWdVlXMWxLajFWVkVZdE9DY25WVzUwYVhSc1pXUXVjRzVuQmpzR1ZEb1JZMjl1ZEdWdWRGOTBlWEJsU1NJT2FXMWhaMlV2Y0c1bkJqc0dWRG9SYzJWeWRtbGpaVjl1WVcxbE9ncHNiMk5oYkE9PSIsImV4cCI6IjIwMjItMDMtMjBUMTA6MDc6NDkuOTg1WiIsInB1ciI6ImJsb2Jfa2V5In19--3335eeeb5946484b14537c654c35e2c04294fddf/Untitled.png)\nRedirected to http://localhost:3000/rails/active_storage/disk/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdDVG9JYTJWNVNTSWhlV2N6ZEdOcU9HRjZPSGRsYW0xNk1XaGpNR0poWldvNFkySTJiQVk2QmtWVU9oQmthWE53YjNOcGRHbHZia2tpUTJsdWJHbHVaVHNnWm1sc1pXNWhiV1U5SWxWdWRHbDBiR1ZrTG5CdVp5STdJR1pwYkdWdVlXMWxLajFWVkVZdE9DY25WVzUwYVhSc1pXUXVjRzVuQmpzR1ZEb1JZMjl1ZEdWdWRGOTBlWEJsU1NJT2FXMWhaMlV2Y0c1bkJqc0dWRG9SYzJWeWRtbGpaVjl1WVcxbE9ncHNiMk5oYkE9PSIsImV4cCI6IjIwMjItMDMtMjBUMTA6MDc6NDkuOTg1WiIsInB1ciI6ImJsb2Jfa2V5In19--3335eeeb5946484b14537c654c35e2c04294fddf/Untitled.png\nCompleted 302 Found in 15ms (ActiveRecord: 0.9ms | Allocations: 1939)\n\n\nStarted GET &quot;/rails/active_storage/disk/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdDVG9JYTJWNVNTSWhlV2N6ZEdOcU9HRjZPSGRsYW0xNk1XaGpNR0poWldvNFkySTJiQVk2QmtWVU9oQmthWE53YjNOcGRHbHZia2tpUTJsdWJHbHVaVHNnWm1sc1pXNWhiV1U5SWxWdWRHbDBiR1ZrTG5CdVp5STdJR1pwYkdWdVlXMWxLajFWVkVZdE9DY25WVzUwYVhSc1pXUXVjRzVuQmpzR1ZEb1JZMjl1ZEdWdWRGOTBlWEJsU1NJT2FXMWhaMlV2Y0c1bkJqc0dWRG9SYzJWeWRtbGpaVjl1WVcxbE9ncHNiMk5oYkE9PSIsImV4cCI6IjIwMjItMDMtMjBUMTA6MDc6NDkuOTg1WiIsInB1ciI6ImJsb2Jfa2V5In19--3335eeeb5946484b14537c654c35e2c04294fddf/Untitled.png&quot; for 127.0.0.1 at 2022-03-20 15:32:50 +0530\nProcessing by ActiveStorage::DiskController#show as PNG\n  Parameters: {&quot;encoded_key&quot;=&gt;&quot;[FILTERED]&quot;, &quot;filename&quot;=&gt;&quot;Untitled&quot;}\nCompleted 200 OK in 4ms (ActiveRecord: 0.0ms | Allocations: 198)\n\n\nStarted POST &quot;/posts&quot; for 127.0.0.1 at 2022-03-20 15:33:05 +0530\nProcessing by PostsController#create as TURBO_STREAM\n  Parameters: {&quot;authenticity_token&quot;=&gt;&quot;[FILTERED]&quot;, &quot;post&quot;=&gt;{&quot;title&quot;=&gt;&quot;asdfaljdsf&quot;, &quot;body&quot;=&gt;&quot;&lt;div&gt;asdfasdfasdf&lt;figure data-trix-attachment=\\&quot;{&amp;quot;contentType&amp;quot;:&amp;quot;image/png&amp;quot;,&amp;quot;filename&amp;quot;:&amp;quot;Untitled.png&amp;quot;,&amp;quot;filesize&amp;quot;:67712,&amp;quot;height&amp;quot;:391,&amp;quot;sgid&amp;quot;:&amp;quot;BAh7CEkiCGdpZAY6BkVUSSI6Z2lkOi8vZ3V5cy13aG8tY29kZS9BY3RpdmVTdG9yYWdlOjpCbG9iLzI2P2V4cGlyZXNfaW4GOwBUSSIMcHVycG9zZQY7AFRJIg9hdHRhY2hhYmxlBjsAVEkiD2V4cGlyZXNfYXQGOwBUMA==--3f7a9f38b00731822e370a0629ee34084018e38b&amp;quot;,&amp;quot;url&amp;quot;:&amp;quot;http://localhost:3000/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBIdz09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--50e4c4426007be24eaa37994d19f26672b7c16aa/Untitled.png&amp;quot;,&amp;quot;width&amp;quot;:375}\\&quot; data-trix-content-type=\\&quot;image/png\\&quot; data-trix-attributes=\\&quot;{&amp;quot;presentation&amp;quot;:&amp;quot;gallery&amp;quot;}\\&quot; class=\\&quot;attachment attachment--preview attachment--png\\&quot;&gt;&lt;img src=\\&quot;http://localhost:3000/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBIdz09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--50e4c4426007be24eaa37994d19f26672b7c16aa/Untitled.png\\&quot; width=\\&quot;375\\&quot; height=\\&quot;391\\&quot;&gt;&lt;figcaption class=\\&quot;attachment__caption\\&quot;&gt;&lt;span class=\\&quot;attachment__name\\&quot;&gt;Untitled.png&lt;/span&gt; &lt;span class=\\&quot;attachment__size\\&quot;&gt;66.13 KB&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&quot;}, &quot;commit&quot;=&gt;&quot;Create Post&quot;}\n   (0.1ms)  SELECT sqlite_version(*)\n   app/controllers/posts_controller.rb:15:in `create'\n  TRANSACTION (0.0ms)  begin transaction\n   app/controllers/posts_controller.rb:16:in `create'\n  ActiveStorage::Blob Load (0.3ms)  SELECT &quot;active_storage_blobs&quot;.* FROM &quot;active_storage_blobs&quot; WHERE &quot;active_storage_blobs&quot;.&quot;id&quot; = ? LIMIT ?  [[&quot;id&quot;, 26], [&quot;LIMIT&quot;, 1]]\n   app/controllers/posts_controller.rb:16:in `create'\n  CACHE ActiveStorage::Blob Load (0.0ms)  SELECT &quot;active_storage_blobs&quot;.* FROM &quot;active_storage_blobs&quot; WHERE &quot;active_storage_blobs&quot;.&quot;id&quot; = ? LIMIT ?  [[&quot;id&quot;, 26], [&quot;LIMIT&quot;, 1]]\n   app/controllers/posts_controller.rb:16:in `create'\n  CACHE ActiveStorage::Blob Load (0.0ms)  SELECT &quot;active_storage_blobs&quot;.* FROM &quot;active_storage_blobs&quot; WHERE &quot;active_storage_blobs&quot;.&quot;id&quot; = ? LIMIT ?  [[&quot;id&quot;, 26], [&quot;LIMIT&quot;, 1]]\n   app/controllers/posts_controller.rb:16:in `create'\n  CACHE ActiveStorage::Blob Load (0.0ms)  SELECT &quot;active_storage_blobs&quot;.* FROM &quot;active_storage_blobs&quot; WHERE &quot;active_storage_blobs&quot;.&quot;id&quot; = ? LIMIT ?  [[&quot;id&quot;, 26], [&quot;LIMIT&quot;, 1]]\n   app/models/post.rb:8:in `body_length'\n  Post Create (1.7ms)  INSERT INTO &quot;posts&quot; (&quot;title&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES (?, ?, \n?)  [[&quot;title&quot;, &quot;asdfaljdsf&quot;], [&quot;created_at&quot;, &quot;2022-03-20 10:03:05.969215&quot;], [&quot;updated_at&quot;, &quot;2022-03-20 10:03:05.969215&quot;]]\n   app/controllers/posts_controller.rb:16:in `create'\n  ActiveStorage::Blob Load (0.1ms)  SELECT &quot;active_storage_blobs&quot;.* FROM &quot;active_storage_blobs&quot; WHERE &quot;active_storage_blobs&quot;.&quot;id&quot; = ? LIMIT ?  [[&quot;id&quot;, 26], [&quot;LIMIT&quot;, 1]]\n   app/controllers/posts_controller.rb:16:in `create'\n  ActionText::RichText Create (0.5ms)  INSERT INTO &quot;action_text_rich_texts&quot; (&quot;name&quot;, &quot;body&quot;, &quot;record_type&quot;, &quot;record_id&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES (?, ?, ?, ?, ?, ?)  [[&quot;name&quot;, &quot;body&quot;], [&quot;body&quot;, &quot;&lt;div&gt;asdfasdfasdf&lt;action-text-attachment sgid=\\&quot;BAh7CEkiCGdpZAY6BkVUSSI6Z2lkOi8vZ3V5cy13aG8tY29kZS9BY3RpdmVTdG9yYWdlOjpCbG9iLzI2P2V4cGlyZXNfaW4GOwBUSSIMcHVycG9zZQY7AFRJIg9hdHRhY2hhYmxlBjsAVEkiD2V4cGlyZXNfYXQGOwBUMA==--3f7a9f38b00731822e370a0629ee34084018e38b\\&quot; content-type=\\&quot;image/png\\&quot; url=\\&quot;http://localhost:3000/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBIdz09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--50e4c4426007be24eaa37994d19f26672b7c16aa/Untitled.png\\&quot; filename=\\&quot;Untitled.png\\&quot; filesize=\\&quot;67712\\&quot; width=\\&quot;375\\&quot; height=\\&quot;391\\&quot; presentation=\\&quot;gallery\\&quot;&gt;&lt;/action-text-attachment&gt;&lt;/div&gt;&quot;], [&quot;record_type&quot;, &quot;Post&quot;], [&quot;record_id&quot;, 20], [&quot;created_at&quot;, &quot;2022-03-20 10:03:06.009179&quot;], [&quot;updated_at&quot;, &quot;2022-03-20 10:03:06.009179&quot;]]\n   app/controllers/posts_controller.rb:16:in `create'\n  ActiveStorage::Blob Load (0.1ms)  SELECT &quot;active_storage_blobs&quot;.* FROM &quot;active_storage_blobs&quot; WHERE &quot;active_storage_blobs&quot;.&quot;id&quot; = ? LIMIT ?  [[&quot;id&quot;, 26], [&quot;LIMIT&quot;, 1]]\n   app/controllers/posts_controller.rb:16:in `create'\n  ActiveStorage::Blob Update (0.3ms)  UPDATE &quot;active_storage_blobs&quot; SET &quot;metadata&quot; = ? WHERE &quot;active_storage_blobs&quot;.&quot;id&quot; = ?  [[&quot;metadata&quot;, &quot;{\\&quot;identified\\&quot;:true}&quot;], [&quot;id&quot;, 26]]\n   app/controllers/posts_controller.rb:16:in `create'\n  ActiveStorage::Attachment Create (0.5ms)  INSERT INTO &quot;active_storage_attachments&quot; (&quot;name&quot;, &quot;record_type&quot;, &quot;record_id&quot;, &quot;blob_id&quot;, &quot;created_at&quot;) VALUES (?, ?, ?, ?, ?)  [[&quot;name&quot;, &quot;embeds&quot;], [&quot;record_type&quot;, &quot;ActionText::RichText&quot;], [&quot;record_id&quot;, 20], [&quot;blob_id&quot;, 26], [&quot;created_at&quot;, &quot;2022-03-20 10:03:06.032143&quot;]]\n   app/controllers/posts_controller.rb:16:in `create'\n  Post Update (0.1ms)  UPDATE &quot;posts&quot; SET &quot;updated_at&quot; = ? WHERE &quot;posts&quot;.&quot;id&quot; = ?  [[&quot;updated_at&quot;, &quot;2022-03-20 10:03:06.037194&quot;], [&quot;id&quot;, 20]]\n   app/controllers/posts_controller.rb:16:in `create'\n  ActionText::RichText Update (0.1ms)  UPDATE &quot;action_text_rich_texts&quot; SET &quot;updated_at&quot; = ? WHERE &quot;action_text_rich_texts&quot;.&quot;id&quot; = ?  [[&quot;updated_at&quot;, &quot;2022-03-20 10:03:06.036584&quot;], [&quot;id&quot;, 20]]\n   app/controllers/posts_controller.rb:16:in `create'\n  TRANSACTION (5.8ms)  commit transaction\n   app/controllers/posts_controller.rb:16:in `create'\n[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: 20f7d9f4-4915-4db6-ad45-9214c5df56f0) to Async(default) with arguments: #&lt;GlobalID:0x0000019f6a5745f8 @uri=#&lt;URI::GID gid://guys-who-code/ActiveStorage::Blob/26&gt;&gt;\nRedirected to http://localhost:3000/posts/20\nCompleted 302 Found in 140ms (ActiveRecord: 10.4ms | Allocations: 39718)\n\n\nStarted GET &quot;/posts/20&quot; for 127.0.0.1 at 2022-03-20 15:33:06 +0530\n[ActiveJob] [ActiveStorage::AnalyzeJob] [20f7d9f4-4915-4db6-ad45-9214c5df56f0]   ActiveStorage::Blob Load (0.2ms)  SELECT &quot;active_storage_blobs&quot;.* FROM &quot;active_storage_blobs&quot; WHERE &quot;active_storage_blobs&quot;.&quot;id&quot; = ? LIMIT ?  [[&quot;id&quot;, 26], [&quot;LIMIT&quot;, 1]]\n[ActiveJob] [ActiveStorage::AnalyzeJob] [20f7d9f4-4915-4db6-ad45-9214c5df56f0] Performing ActiveStorage::AnalyzeJob (Job ID: 20f7d9f4-4915-4db6-ad45-9214c5df56f0) from Async(default) enqueued at 2022-03-20T10:03:06Z with arguments: #&lt;GlobalID:0x0000019f6a5b8c08 @uri=#&lt;URI::GID gid://guys-who-code/ActiveStorage::Blob/26&gt;&gt;\n[ActiveJob] [ActiveStorage::AnalyzeJob] [20f7d9f4-4915-4db6-ad45-9214c5df56f0]   Disk Storage (4.1ms) Downloaded file from key: yg3tcj8az8wejmz1hc0baej8cb6l\nProcessing by PostsController#show as TURBO_STREAM\n  Parameters: {&quot;id&quot;=&gt;&quot;20&quot;}\n  Post Load (0.5ms)  SELECT &quot;posts&quot;.* FROM &quot;posts&quot; WHERE &quot;posts&quot;.&quot;id&quot; = ? LIMIT ?  [[&quot;id&quot;, 20], [&quot;LIMIT&quot;, 1]]\n   app/controllers/posts_controller.rb:3:in `show'\n  Rendering layout layouts/application.html.erb\n  Rendering posts/show.html.erb within layouts/application\n  ActionText::RichText Load (0.5ms)  SELECT &quot;action_text_rich_texts&quot;.* FROM &quot;action_text_rich_texts&quot; WHERE &quot;action_text_rich_texts&quot;.&quot;record_id&quot; = ? AND &quot;action_text_rich_texts&quot;.&quot;record_type&quot; = ? AND &quot;action_text_rich_texts&quot;.&quot;name&quot; = ? LIMIT ?  [[&quot;record_id&quot;, 20], [&quot;record_type&quot;, &quot;Post&quot;], [&quot;name&quot;, &quot;body&quot;], [&quot;LIMIT&quot;, 1]]\n   app/views/posts/show.html.erb:12\n  ActiveStorage::Blob Load (0.3ms)  SELECT &quot;active_storage_blobs&quot;.* FROM &quot;active_storage_blobs&quot; WHERE &quot;active_storage_blobs&quot;.&quot;id&quot; = ? LIMIT ?  [[&quot;id&quot;, 26], [&quot;LIMIT&quot;, 1]]\n   app/views/posts/show.html.erb:12\n  Rendered active_storage/blobs/_blob.html.erb (Duration: 0.9ms | Allocations: 496)\n  Rendered C:/Ruby31-x64/lib/ruby/gems/3.1.0/gems/actiontext-7.0.2.2/app/views/action_text/contents/_content.html.erb within layouts/action_text/contents/_content (Duration: 8.1ms | Allocations: 3912)\n  Rendered posts/show.html.erb within layouts/application (Duration: 17.1ms | Allocations: 6114)\n  Rendered layout layouts/application.html.erb (Duration: 53.0ms | Allocations: 15288)\n\n\n[ActiveJob] [ActiveStorage::AnalyzeJob] [20f7d9f4-4915-4db6-ad45-9214c5df56f0]   TRANSACTION (0.1ms)  begin transaction\n[ActiveJob] [ActiveStorage::AnalyzeJob] [20f7d9f4-4915-4db6-ad45-9214c5df56f0]   ActiveStorage::Blob Update (2.1ms)  UPDATE &quot;active_storage_blobs&quot; SET &quot;metadata&quot; = ? WHERE &quot;active_storage_blobs&quot;.&quot;id&quot; = ?  [[&quot;metadata&quot;, &quot;{\\&quot;identified\\&quot;:true,\\&quot;width\\&quot;:375,\\&quot;height\\&quot;:391,\\&quot;analyzed\\&quot;:true}&quot;], [&quot;id&quot;, 26]]\n[ActiveJob] [ActiveStorage::AnalyzeJob] [20f7d9f4-4915-4db6-ad45-9214c5df56f0]   TRANSACTION (4.6ms)  commit transaction\n[ActiveJob] [ActiveStorage::AnalyzeJob] [20f7d9f4-4915-4db6-ad45-9214c5df56f0] Performed ActiveStorage::AnalyzeJob (Job ID: 20f7d9f4-4915-4db6-ad45-9214c5df56f0) from Async(default) in 578.03ms\"><pre class=\"notranslate\"><code class=\"notranslate\">Started GET \"/posts/new\" for 127.0.0.1 at 2022-03-20 15:32:43 +0530\nProcessing by PostsController#new as HTML\n  Rendering layout layouts/application.html.erb\n  Rendering posts/new.html.erb within layouts/application\n  Rendered posts/new.html.erb within layouts/application (Duration: 90.2ms | Allocations: 12092)\n  Rendered components/_navbar.html.erb (Duration: 0.1ms | Allocations: 53)\n  Rendered layout layouts/application.html.erb (Duration: 110.0ms | Allocations: 17229)\nCompleted 200 OK in 116ms (Views: 111.6ms | ActiveRecord: 0.0ms | Allocations: 17669)\n\n\nStarted POST \"/rails/active_storage/direct_uploads\" for 127.0.0.1 at 2022-03-20 15:32:49 +0530\nProcessing by ActiveStorage::DirectUploadsController#create as JSON\n  Parameters: {\"blob\"=&gt;{\"filename\"=&gt;\"Untitled.png\", \"content_type\"=&gt;\"image/png\", \"byte_size\"=&gt;67712, \"checksum\"=&gt;\"JSkbfD1/qYR3jiMSQ4StXw==\"}, \"direct_upload\"=&gt;{\"blob\"=&gt;{\"filename\"=&gt;\"Untitled.png\", \"content_type\"=&gt;\"image/png\", \"byte_size\"=&gt;67712, \"checksum\"=&gt;\"JSkbfD1/qYR3jiMSQ4StXw==\"}}}\n  TRANSACTION (0.1ms)  begin transaction\n  ActiveStorage::Blob Create (1.8ms)  INSERT INTO \"active_storage_blobs\" (\"key\", \"filename\", \"content_type\", \"metadata\", \"service_name\", \"byte_size\", \"checksum\", \"created_at\") VALUES (?, ?, \n?, ?, ?, ?, ?, ?)  [[\"key\", \"yg3tcj8az8wejmz1hc0baej8cb6l\"], [\"filename\", \"Untitled.png\"], [\"content_type\", \"image/png\"], [\"metadata\", nil], [\"service_name\", \"local\"], [\"byte_size\", 67712], \n[\"checksum\", \"JSkbfD1/qYR3jiMSQ4StXw==\"], [\"created_at\", \"2022-03-20 10:02:49.678370\"]]        \n  TRANSACTION (4.8ms)  commit transaction\n  Disk Storage (0.9ms) Generated URL for file at key: yg3tcj8az8wejmz1hc0baej8cb6l (http://localhost:3000/rails/active_storage/disk/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdDam9JYTJWNVNTSWhlV2N6ZEdOcU9HRjZPSGRsYW0xNk1XaGpNR0poWldvNFkySTJiQVk2QmtWVU9oRmpiMjUwWlc1MFgzUjVjR1ZKSWc1cGJXRm5aUzl3Ym1jR093WlVPaE5qYjI1MFpXNTBYMnhsYm1kMGFHa0RnQWdCT2cxamFHVmphM04xYlVraUhVcFRhMkptUkRFdmNWbFNNMnBwVFZOUk5GTjBXSGM5UFFZN0JsUTZFWE5sY25acFkyVmZibUZ0WlRvS2JHOWpZV3c9IiwiZXhwIjoiMjAyMi0wMy0yMFQxMDowNzo0OS42OTRaIiwicHVyIjoiYmxvYl90b2tlbiJ9fQ==--dc343ddf348a3fa46f8d8b59c26e68893ed5ae00)       \nCompleted 200 OK in 27ms (Views: 0.6ms | ActiveRecord: 6.7ms | Allocations: 4744)\n\n\nStarted PUT \"/rails/active_storage/disk/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdDam9JYTJWNVNTSWhlV2N6ZEdOcU9HRjZPSGRsYW0xNk1XaGpNR0poWldvNFkySTJiQVk2QmtWVU9oRmpiMjUwWlc1MFgzUjVjR1ZKSWc1cGJXRm5aUzl3Ym1jR093WlVPaE5qYjI1MFpXNTBYMnhsYm1kMGFHa0RnQWdCT2cxamFHVmphM04xYlVraUhVcFRhMkptUkRFdmNWbFNNMnBwVFZOUk5GTjBXSGM5UFFZN0JsUTZFWE5sY25acFkyVmZibUZ0WlRvS2JHOWpZV3c9IiwiZXhwIjoiMjAyMi0wMy0yMFQxMDowNzo0OS42OTRaIiwicHVyIjoiYmxvYl90b2tlbiJ9fQ==--dc343ddf348a3fa46f8d8b59c26e68893ed5ae00\" for 127.0.0.1 at 2022-03-20 15:32:49 +0530\nProcessing by ActiveStorage::DiskController#update as */*\n  Parameters: {\"encoded_token\"=&gt;\"[FILTERED]\"}\n  Disk Storage (5.0ms) Uploaded file to key: yg3tcj8az8wejmz1hc0baej8cb6l (checksum: JSkbfD1/qYR3jiMSQ4StXw==)\nCompleted 204 No Content in 13ms (ActiveRecord: 0.0ms | Allocations: 497)\n\n\nStarted GET \"/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBIdz09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--50e4c4426007be24eaa37994d19f26672b7c16aa/Untitled.png\" for 127.0.0.1 at 2022-03-20 15:32:49 +0530\nProcessing by ActiveStorage::Blobs::RedirectController#show as PNG\n  Parameters: {\"signed_id\"=&gt;\"eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBIdz09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--50e4c4426007be24eaa37994d19f26672b7c16aa\", \"filename\"=&gt;\"Untitled\"}\n   (0.1ms)  SELECT sqlite_version(*)\n  ActiveStorage::Blob Load (0.3ms)  SELECT \"active_storage_blobs\".* FROM \"active_storage_blobs\" WHERE \"active_storage_blobs\".\"id\" = ? LIMIT ?  [[\"id\", 26], [\"LIMIT\", 1]]\n  Disk Storage (1.1ms) Generated URL for file at key: yg3tcj8az8wejmz1hc0baej8cb6l (http://localhost:3000/rails/active_storage/disk/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdDVG9JYTJWNVNTSWhlV2N6ZEdOcU9HRjZPSGRsYW0xNk1XaGpNR0poWldvNFkySTJiQVk2QmtWVU9oQmthWE53YjNOcGRHbHZia2tpUTJsdWJHbHVaVHNnWm1sc1pXNWhiV1U5SWxWdWRHbDBiR1ZrTG5CdVp5STdJR1pwYkdWdVlXMWxLajFWVkVZdE9DY25WVzUwYVhSc1pXUXVjRzVuQmpzR1ZEb1JZMjl1ZEdWdWRGOTBlWEJsU1NJT2FXMWhaMlV2Y0c1bkJqc0dWRG9SYzJWeWRtbGpaVjl1WVcxbE9ncHNiMk5oYkE9PSIsImV4cCI6IjIwMjItMDMtMjBUMTA6MDc6NDkuOTg1WiIsInB1ciI6ImJsb2Jfa2V5In19--3335eeeb5946484b14537c654c35e2c04294fddf/Untitled.png)\nRedirected to http://localhost:3000/rails/active_storage/disk/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdDVG9JYTJWNVNTSWhlV2N6ZEdOcU9HRjZPSGRsYW0xNk1XaGpNR0poWldvNFkySTJiQVk2QmtWVU9oQmthWE53YjNOcGRHbHZia2tpUTJsdWJHbHVaVHNnWm1sc1pXNWhiV1U5SWxWdWRHbDBiR1ZrTG5CdVp5STdJR1pwYkdWdVlXMWxLajFWVkVZdE9DY25WVzUwYVhSc1pXUXVjRzVuQmpzR1ZEb1JZMjl1ZEdWdWRGOTBlWEJsU1NJT2FXMWhaMlV2Y0c1bkJqc0dWRG9SYzJWeWRtbGpaVjl1WVcxbE9ncHNiMk5oYkE9PSIsImV4cCI6IjIwMjItMDMtMjBUMTA6MDc6NDkuOTg1WiIsInB1ciI6ImJsb2Jfa2V5In19--3335eeeb5946484b14537c654c35e2c04294fddf/Untitled.png\nCompleted 302 Found in 15ms (ActiveRecord: 0.9ms | Allocations: 1939)\n\n\nStarted GET \"/rails/active_storage/disk/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdDVG9JYTJWNVNTSWhlV2N6ZEdOcU9HRjZPSGRsYW0xNk1XaGpNR0poWldvNFkySTJiQVk2QmtWVU9oQmthWE53YjNOcGRHbHZia2tpUTJsdWJHbHVaVHNnWm1sc1pXNWhiV1U5SWxWdWRHbDBiR1ZrTG5CdVp5STdJR1pwYkdWdVlXMWxLajFWVkVZdE9DY25WVzUwYVhSc1pXUXVjRzVuQmpzR1ZEb1JZMjl1ZEdWdWRGOTBlWEJsU1NJT2FXMWhaMlV2Y0c1bkJqc0dWRG9SYzJWeWRtbGpaVjl1WVcxbE9ncHNiMk5oYkE9PSIsImV4cCI6IjIwMjItMDMtMjBUMTA6MDc6NDkuOTg1WiIsInB1ciI6ImJsb2Jfa2V5In19--3335eeeb5946484b14537c654c35e2c04294fddf/Untitled.png\" for 127.0.0.1 at 2022-03-20 15:32:50 +0530\nProcessing by ActiveStorage::DiskController#show as PNG\n  Parameters: {\"encoded_key\"=&gt;\"[FILTERED]\", \"filename\"=&gt;\"Untitled\"}\nCompleted 200 OK in 4ms (ActiveRecord: 0.0ms | Allocations: 198)\n\n\nStarted POST \"/posts\" for 127.0.0.1 at 2022-03-20 15:33:05 +0530\nProcessing by PostsController#create as TURBO_STREAM\n  Parameters: {\"authenticity_token\"=&gt;\"[FILTERED]\", \"post\"=&gt;{\"title\"=&gt;\"asdfaljdsf\", \"body\"=&gt;\"&lt;div&gt;asdfasdfasdf&lt;figure data-trix-attachment=\\\"{&amp;quot;contentType&amp;quot;:&amp;quot;image/png&amp;quot;,&amp;quot;filename&amp;quot;:&amp;quot;Untitled.png&amp;quot;,&amp;quot;filesize&amp;quot;:67712,&amp;quot;height&amp;quot;:391,&amp;quot;sgid&amp;quot;:&amp;quot;BAh7CEkiCGdpZAY6BkVUSSI6Z2lkOi8vZ3V5cy13aG8tY29kZS9BY3RpdmVTdG9yYWdlOjpCbG9iLzI2P2V4cGlyZXNfaW4GOwBUSSIMcHVycG9zZQY7AFRJIg9hdHRhY2hhYmxlBjsAVEkiD2V4cGlyZXNfYXQGOwBUMA==--3f7a9f38b00731822e370a0629ee34084018e38b&amp;quot;,&amp;quot;url&amp;quot;:&amp;quot;http://localhost:3000/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBIdz09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--50e4c4426007be24eaa37994d19f26672b7c16aa/Untitled.png&amp;quot;,&amp;quot;width&amp;quot;:375}\\\" data-trix-content-type=\\\"image/png\\\" data-trix-attributes=\\\"{&amp;quot;presentation&amp;quot;:&amp;quot;gallery&amp;quot;}\\\" class=\\\"attachment attachment--preview attachment--png\\\"&gt;&lt;img src=\\\"http://localhost:3000/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBIdz09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--50e4c4426007be24eaa37994d19f26672b7c16aa/Untitled.png\\\" width=\\\"375\\\" height=\\\"391\\\"&gt;&lt;figcaption class=\\\"attachment__caption\\\"&gt;&lt;span class=\\\"attachment__name\\\"&gt;Untitled.png&lt;/span&gt; &lt;span class=\\\"attachment__size\\\"&gt;66.13 KB&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;\"}, \"commit\"=&gt;\"Create Post\"}\n   (0.1ms)  SELECT sqlite_version(*)\n   app/controllers/posts_controller.rb:15:in `create'\n  TRANSACTION (0.0ms)  begin transaction\n   app/controllers/posts_controller.rb:16:in `create'\n  ActiveStorage::Blob Load (0.3ms)  SELECT \"active_storage_blobs\".* FROM \"active_storage_blobs\" WHERE \"active_storage_blobs\".\"id\" = ? LIMIT ?  [[\"id\", 26], [\"LIMIT\", 1]]\n   app/controllers/posts_controller.rb:16:in `create'\n  CACHE ActiveStorage::Blob Load (0.0ms)  SELECT \"active_storage_blobs\".* FROM \"active_storage_blobs\" WHERE \"active_storage_blobs\".\"id\" = ? LIMIT ?  [[\"id\", 26], [\"LIMIT\", 1]]\n   app/controllers/posts_controller.rb:16:in `create'\n  CACHE ActiveStorage::Blob Load (0.0ms)  SELECT \"active_storage_blobs\".* FROM \"active_storage_blobs\" WHERE \"active_storage_blobs\".\"id\" = ? LIMIT ?  [[\"id\", 26], [\"LIMIT\", 1]]\n   app/controllers/posts_controller.rb:16:in `create'\n  CACHE ActiveStorage::Blob Load (0.0ms)  SELECT \"active_storage_blobs\".* FROM \"active_storage_blobs\" WHERE \"active_storage_blobs\".\"id\" = ? LIMIT ?  [[\"id\", 26], [\"LIMIT\", 1]]\n   app/models/post.rb:8:in `body_length'\n  Post Create (1.7ms)  INSERT INTO \"posts\" (\"title\", \"created_at\", \"updated_at\") VALUES (?, ?, \n?)  [[\"title\", \"asdfaljdsf\"], [\"created_at\", \"2022-03-20 10:03:05.969215\"], [\"updated_at\", \"2022-03-20 10:03:05.969215\"]]\n   app/controllers/posts_controller.rb:16:in `create'\n  ActiveStorage::Blob Load (0.1ms)  SELECT \"active_storage_blobs\".* FROM \"active_storage_blobs\" WHERE \"active_storage_blobs\".\"id\" = ? LIMIT ?  [[\"id\", 26], [\"LIMIT\", 1]]\n   app/controllers/posts_controller.rb:16:in `create'\n  ActionText::RichText Create (0.5ms)  INSERT INTO \"action_text_rich_texts\" (\"name\", \"body\", \"record_type\", \"record_id\", \"created_at\", \"updated_at\") VALUES (?, ?, ?, ?, ?, ?)  [[\"name\", \"body\"], [\"body\", \"&lt;div&gt;asdfasdfasdf&lt;action-text-attachment sgid=\\\"BAh7CEkiCGdpZAY6BkVUSSI6Z2lkOi8vZ3V5cy13aG8tY29kZS9BY3RpdmVTdG9yYWdlOjpCbG9iLzI2P2V4cGlyZXNfaW4GOwBUSSIMcHVycG9zZQY7AFRJIg9hdHRhY2hhYmxlBjsAVEkiD2V4cGlyZXNfYXQGOwBUMA==--3f7a9f38b00731822e370a0629ee34084018e38b\\\" content-type=\\\"image/png\\\" url=\\\"http://localhost:3000/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBIdz09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--50e4c4426007be24eaa37994d19f26672b7c16aa/Untitled.png\\\" filename=\\\"Untitled.png\\\" filesize=\\\"67712\\\" width=\\\"375\\\" height=\\\"391\\\" presentation=\\\"gallery\\\"&gt;&lt;/action-text-attachment&gt;&lt;/div&gt;\"], [\"record_type\", \"Post\"], [\"record_id\", 20], [\"created_at\", \"2022-03-20 10:03:06.009179\"], [\"updated_at\", \"2022-03-20 10:03:06.009179\"]]\n   app/controllers/posts_controller.rb:16:in `create'\n  ActiveStorage::Blob Load (0.1ms)  SELECT \"active_storage_blobs\".* FROM \"active_storage_blobs\" WHERE \"active_storage_blobs\".\"id\" = ? LIMIT ?  [[\"id\", 26], [\"LIMIT\", 1]]\n   app/controllers/posts_controller.rb:16:in `create'\n  ActiveStorage::Blob Update (0.3ms)  UPDATE \"active_storage_blobs\" SET \"metadata\" = ? WHERE \"active_storage_blobs\".\"id\" = ?  [[\"metadata\", \"{\\\"identified\\\":true}\"], [\"id\", 26]]\n   app/controllers/posts_controller.rb:16:in `create'\n  ActiveStorage::Attachment Create (0.5ms)  INSERT INTO \"active_storage_attachments\" (\"name\", \"record_type\", \"record_id\", \"blob_id\", \"created_at\") VALUES (?, ?, ?, ?, ?)  [[\"name\", \"embeds\"], [\"record_type\", \"ActionText::RichText\"], [\"record_id\", 20], [\"blob_id\", 26], [\"created_at\", \"2022-03-20 10:03:06.032143\"]]\n   app/controllers/posts_controller.rb:16:in `create'\n  Post Update (0.1ms)  UPDATE \"posts\" SET \"updated_at\" = ? WHERE \"posts\".\"id\" = ?  [[\"updated_at\", \"2022-03-20 10:03:06.037194\"], [\"id\", 20]]\n   app/controllers/posts_controller.rb:16:in `create'\n  ActionText::RichText Update (0.1ms)  UPDATE \"action_text_rich_texts\" SET \"updated_at\" = ? WHERE \"action_text_rich_texts\".\"id\" = ?  [[\"updated_at\", \"2022-03-20 10:03:06.036584\"], [\"id\", 20]]\n   app/controllers/posts_controller.rb:16:in `create'\n  TRANSACTION (5.8ms)  commit transaction\n   app/controllers/posts_controller.rb:16:in `create'\n[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: 20f7d9f4-4915-4db6-ad45-9214c5df56f0) to Async(default) with arguments: #&lt;GlobalID:0x0000019f6a5745f8 @uri=#&lt;URI::GID gid://guys-who-code/ActiveStorage::Blob/26&gt;&gt;\nRedirected to http://localhost:3000/posts/20\nCompleted 302 Found in 140ms (ActiveRecord: 10.4ms | Allocations: 39718)\n\n\nStarted GET \"/posts/20\" for 127.0.0.1 at 2022-03-20 15:33:06 +0530\n[ActiveJob] [ActiveStorage::AnalyzeJob] [20f7d9f4-4915-4db6-ad45-9214c5df56f0]   ActiveStorage::Blob Load (0.2ms)  SELECT \"active_storage_blobs\".* FROM \"active_storage_blobs\" WHERE \"active_storage_blobs\".\"id\" = ? LIMIT ?  [[\"id\", 26], [\"LIMIT\", 1]]\n[ActiveJob] [ActiveStorage::AnalyzeJob] [20f7d9f4-4915-4db6-ad45-9214c5df56f0] Performing ActiveStorage::AnalyzeJob (Job ID: 20f7d9f4-4915-4db6-ad45-9214c5df56f0) from Async(default) enqueued at 2022-03-20T10:03:06Z with arguments: #&lt;GlobalID:0x0000019f6a5b8c08 @uri=#&lt;URI::GID gid://guys-who-code/ActiveStorage::Blob/26&gt;&gt;\n[ActiveJob] [ActiveStorage::AnalyzeJob] [20f7d9f4-4915-4db6-ad45-9214c5df56f0]   Disk Storage (4.1ms) Downloaded file from key: yg3tcj8az8wejmz1hc0baej8cb6l\nProcessing by PostsController#show as TURBO_STREAM\n  Parameters: {\"id\"=&gt;\"20\"}\n  Post Load (0.5ms)  SELECT \"posts\".* FROM \"posts\" WHERE \"posts\".\"id\" = ? LIMIT ?  [[\"id\", 20], [\"LIMIT\", 1]]\n   app/controllers/posts_controller.rb:3:in `show'\n  Rendering layout layouts/application.html.erb\n  Rendering posts/show.html.erb within layouts/application\n  ActionText::RichText Load (0.5ms)  SELECT \"action_text_rich_texts\".* FROM \"action_text_rich_texts\" WHERE \"action_text_rich_texts\".\"record_id\" = ? AND \"action_text_rich_texts\".\"record_type\" = ? AND \"action_text_rich_texts\".\"name\" = ? LIMIT ?  [[\"record_id\", 20], [\"record_type\", \"Post\"], [\"name\", \"body\"], [\"LIMIT\", 1]]\n   app/views/posts/show.html.erb:12\n  ActiveStorage::Blob Load (0.3ms)  SELECT \"active_storage_blobs\".* FROM \"active_storage_blobs\" WHERE \"active_storage_blobs\".\"id\" = ? LIMIT ?  [[\"id\", 26], [\"LIMIT\", 1]]\n   app/views/posts/show.html.erb:12\n  Rendered active_storage/blobs/_blob.html.erb (Duration: 0.9ms | Allocations: 496)\n  Rendered C:/Ruby31-x64/lib/ruby/gems/3.1.0/gems/actiontext-7.0.2.2/app/views/action_text/contents/_content.html.erb within layouts/action_text/contents/_content (Duration: 8.1ms | Allocations: 3912)\n  Rendered posts/show.html.erb within layouts/application (Duration: 17.1ms | Allocations: 6114)\n  Rendered layout layouts/application.html.erb (Duration: 53.0ms | Allocations: 15288)\n\n\n[ActiveJob] [ActiveStorage::AnalyzeJob] [20f7d9f4-4915-4db6-ad45-9214c5df56f0]   TRANSACTION (0.1ms)  begin transaction\n[ActiveJob] [ActiveStorage::AnalyzeJob] [20f7d9f4-4915-4db6-ad45-9214c5df56f0]   ActiveStorage::Blob Update (2.1ms)  UPDATE \"active_storage_blobs\" SET \"metadata\" = ? WHERE \"active_storage_blobs\".\"id\" = ?  [[\"metadata\", \"{\\\"identified\\\":true,\\\"width\\\":375,\\\"height\\\":391,\\\"analyzed\\\":true}\"], [\"id\", 26]]\n[ActiveJob] [ActiveStorage::AnalyzeJob] [20f7d9f4-4915-4db6-ad45-9214c5df56f0]   TRANSACTION (4.6ms)  commit transaction\n[ActiveJob] [ActiveStorage::AnalyzeJob] [20f7d9f4-4915-4db6-ad45-9214c5df56f0] Performed ActiveStorage::AnalyzeJob (Job ID: 20f7d9f4-4915-4db6-ad45-9214c5df56f0) from Async(default) in 578.03ms\n</code></pre></div>",
            "url": "https://github.com/rails/rails/issues/44729",
            "title": "Rails quits after creating a rich text entry with an image in the database.",
            "date_modified": "2022-06-29T00:02:04.000Z",
            "date_published": "2022-03-20T10:15:50.000Z",
            "author": {
                "name": "shettytejas",
                "url": "https://github.com/shettytejas"
            }
        }
    ]
}