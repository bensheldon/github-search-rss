{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails: Issues containing 'ActiveJob Job'",
    "home_page_url": "https://github.com/search?q=ActiveJob+Job+repo%3Arails%2Frails+is%3Aissue&type=Issues",
    "feed_url": "https://bensheldon.github.io/github-search-rss/rails-activejob.json",
    "description": "rails/rails: Issues containing 'ActiveJob Job' on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">By the time an <code class=\"notranslate\">ActiveJob::Base#perform</code> method is invoked, Active Record instances are already deserialized and reified through GlobalID integration.</p>\n<p dir=\"auto\">Unfortunately, since end-users don't have a means of configuring that loading process, it's common for Active Job executions to raise be at conflict with the application's Active Record strict loading configuration. That can result in errors like:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ActiveRecord::StrictLoadingViolationError: `Article` is marked for strict_loading. The Tag association named `:tags` cannot be lazily loaded.\"><pre class=\"notranslate\"><code class=\"notranslate\">ActiveRecord::StrictLoadingViolationError: `Article` is marked for strict_loading. The Tag association named `:tags` cannot be lazily loaded.\n</code></pre></div>\n<p dir=\"auto\">Fortunately, calls to <code class=\"notranslate\">GlobalID::Locator.locate</code> support an optional <code class=\"notranslate\">includes:</code> keyword argument that's incorporated into the Active Record query to fetch the record.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit introduces a rudimentary interface to provide <code class=\"notranslate\">ActiveJob::Base</code> descendants with a means of eager-loading associations to comply with strict loading.</p>\n<p dir=\"auto\">While it certainly isn't the public interface to ship, this change supports something in the realm of the following example:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Article &lt; ApplicationRecord\n  self.strict_loading_by_default = true\n\n  has_and_belongs_to_many :tags\nend\n\nclass Tag &lt; ApplicationRecord\n  has_and_belongs_to_many :articles\nend\n\nclass PublishJob &lt; ApplicationJob\n  def perform(article)\n    article.tags.each { |tag| ... }\n  end\n\n  private\n    def options_for_global_id(model_class)\n      if model_class == Article\n        { includes: [:tags] }\n      else\n        super\n      end\n    end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Article</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">strict_loading_by_default</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">true</span>\n\n  <span class=\"pl-en\">has_and_belongs_to_many</span> <span class=\"pl-pds\">:tags</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Tag</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">has_and_belongs_to_many</span> <span class=\"pl-pds\">:articles</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">PublishJob</span> &lt; <span class=\"pl-v\">ApplicationJob</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">article</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">article</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">tags</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">tag</span>| ... <span class=\"pl-kos\">}</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">private</span>\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">options_for_global_id</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">model_class</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-k\">if</span> <span class=\"pl-s1\">model_class</span> == <span class=\"pl-v\">Article</span>\n        <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">includes</span>: <span class=\"pl-kos\">[</span><span class=\"pl-pds\">:tags</span><span class=\"pl-kos\">]</span> <span class=\"pl-kos\">}</span>\n      <span class=\"pl-k\">else</span>\n        <span class=\"pl-smi\">super</span>\n      <span class=\"pl-k\">end</span>\n    <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The interface proposed in the current diff is awkward and not particularly well-named. It aims to demonstrate the necessary layers of abstraction that need to be breached in order for a Job to specify how to load records of a given model class. I'm hoping to gather feedback and guidance to shape the developer-facing public interface to configure how <code class=\"notranslate\">GlobalID::Locator.locate</code> is invoked. <strong>All feedback is welcomed</strong>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50341",
            "title": "Help Active Job comply with Strict Loading",
            "date_modified": "2023-12-13T15:49:45.000Z",
            "date_published": "2023-12-13T00:02:07.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/139634?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Resque workers can be killed.</p>\n<p dir=\"auto\">If they are killed with SIGKILL, the error handling in ActiveJob doesn't kick in, because it's not raised as an exception within the job code.</p>\n<p dir=\"auto\">The failures <em>can</em> be detected in Resque because other workers call <code class=\"notranslate\">prune_dead_workers</code> and trigger <code class=\"notranslate\">on_failure_XXX</code> hooks on the job class, which can be handled, but ActiveJob currently misses these exceptions and cannot trigger retry logic.</p>\n<h3 dir=\"auto\">Steps to reproduce</h3>\n\n<ol dir=\"auto\">\n<li>Create an ActiveJob instance</li>\n<li>Add <code class=\"notranslate\">rescue_from(Resque::DirtyExit) { retry_job } </code></li>\n<li>Enqueue in resque, and kill it mid-job with SIGKILL</li>\n<li>Wait for the worker to be pruned</li>\n<li>The error will be visible in the resque failure queue, but the retry will never happen.</li>\n</ol>\n\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# frozen_string_literal: true\n\nrequire &quot;bundler/inline&quot;\n\n# this requires redis-server to be in PATH\n\ngemfile(true) do\n  source &quot;https://rubygems.org&quot;\n\n  git_source(:github) { |repo| &quot;https://github.com/#{repo}.git&quot; }\n\n  gem &quot;rails&quot;, github: &quot;rails/rails&quot;, branch: &quot;main&quot;\n  # gem &quot;rails&quot;, github: &quot;geoffyoungs/rails&quot;, branch: &quot;resque-dirty-exit-active-job&quot;\n  gem 'redis'\n  gem 'resque'\nend\n\nrequire &quot;active_support&quot;\nrequire &quot;active_support/core_ext/object/blank&quot;\nrequire &quot;active_job&quot;\nrequire &quot;resque&quot;\nrequire &quot;minitest/autorun&quot;\n\nENV['QUEUE'] = 'std'\nENV['FORK_PER_JOB'] = 'false'\nREDIS_PORT = 8765\nREDIS_DB = 'resque_dirty_exit_active_job.rdb'+$$.to_s\nActiveJob::Base.queue_adapter = :resque\n\nclass BugTest &lt; Minitest::Test\n  class Job &lt; ActiveJob::Base\n    def self.status=(value)\n      Resque.redis.set('job_status', value)\n    end\n\n    def self.status\n      Resque.redis.get('job_status')\n    end\n\n    queue_as ENV['QUEUE']\n\n    rescue_from(Resque::DirtyExit) do |exception|\n      Job.status = 'retry'\n      retry_job\n    end\n\n    def perform\n      sleep 2\n      Job.status = 'done'\n    end\n  end\n\n  def setup\n    spawn_redis\n    connect_to_redis\n    clear_redis\n    FileUtils.rm_f(REDIS_DB)\n  end\n\n  def teardown\n    kill_redis\n    FileUtils.rm_f(REDIS_DB)\n  end\n\n  def test_whether_job_is_retried_after_dirty_exit\n    Job.status = 'start'\n\n    Job.perform_later\n\n    assert Job.status.eql?('start')\n\n    work_for(1)\n\n    wait_for_workers_to_be_pruned\n\n    assert Job.status.eql?('retry')\n\n    work_for(3)\n\n    assert Job.status.eql?('done')\n  end\n\n  private\n\n  def work_for(time=0.5)\n    pid = fork {\n      connect_to_redis\n      worker = Resque::Worker.new\n      worker.prepare\n      worker.heartbeat\n      worker.work(1)\n      exit!\n    }\n    sleep(time)\n    kill('KILL', pid)\n  end\n\n  def spawn_redis\n    @redis ||= spawn(['redis-server', '--port', REDIS_PORT.to_s, '--dbfilename', REDIS_DB].join(' '), out: File.open('/dev/null', 'w'))\n  end\n\n  def clear_redis\n    Resque::Failure.clear\n    Resque.remove_queue('std')\n    Job.status = ''\n  end\n\n  def kill_redis\n    kill('INT', @redis)\n    @redis = nil\n  end\n\n  def kill(signal, pid)\n    Process.kill(signal, pid)\n    Process.waitpid(pid)\n  end\n\n  def connect_to_redis\n    Resque.redis = Redis.new(port: REDIS_PORT)\n  end\n\n  def wait_for_workers_to_be_pruned\n    while (workers = Resque::Worker.all).any?\n      sleep(0.1)\n      workers.first.prune_dead_workers\n    end\n  end\nend\n\"><pre class=\"notranslate\"><span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/inline\"</span>\n\n<span class=\"pl-c\"># this requires redis-server to be in PATH</span>\n\n<span class=\"pl-en\">gemfile</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">source</span> <span class=\"pl-s\">\"https://rubygems.org\"</span>\n\n  <span class=\"pl-en\">git_source</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:github</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">repo</span>| <span class=\"pl-s\">\"https://github.com/<span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">repo</span><span class=\"pl-kos\">}</span></span>.git\"</span> <span class=\"pl-kos\">}</span>\n\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"rails\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">github</span>: <span class=\"pl-s\">\"rails/rails\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">branch</span>: <span class=\"pl-s\">\"main\"</span>\n  <span class=\"pl-c\"># gem \"rails\", github: \"geoffyoungs/rails\", branch: \"resque-dirty-exit-active-job\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">'redis'</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">'resque'</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support/core_ext/object/blank\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_job\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"resque\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"minitest/autorun\"</span>\n\n<span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">'QUEUE'</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'std'</span>\n<span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">'FORK_PER_JOB'</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'false'</span>\n<span class=\"pl-c1\">REDIS_PORT</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">8765</span>\n<span class=\"pl-c1\">REDIS_DB</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'resque_dirty_exit_active_job.rdb'</span>+$$<span class=\"pl-kos\">.</span><span class=\"pl-en\">to_s</span>\n<span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">:resque</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">BugTest</span> &lt; <span class=\"pl-v\">Minitest</span>::<span class=\"pl-v\">Test</span>\n  <span class=\"pl-k\">class</span> <span class=\"pl-v\">Job</span> &lt; <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Base</span>\n    <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">status</span><span class=\"pl-c1\">=</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-v\">Resque</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">redis</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">set</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'job_status'</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-k\">end</span>\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">status</span>\n      <span class=\"pl-v\">Resque</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">redis</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">get</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'job_status'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-k\">end</span>\n\n    <span class=\"pl-en\">queue_as</span> <span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">'QUEUE'</span><span class=\"pl-kos\">]</span>\n\n    <span class=\"pl-en\">rescue_from</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Resque</span>::<span class=\"pl-v\">DirtyExit</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">exception</span>|\n      <span class=\"pl-v\">Job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">status</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'retry'</span>\n      <span class=\"pl-en\">retry_job</span>\n    <span class=\"pl-k\">end</span>\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span>\n      <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">2</span>\n      <span class=\"pl-v\">Job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">status</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'done'</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">setup</span>\n    <span class=\"pl-en\">spawn_redis</span>\n    <span class=\"pl-en\">connect_to_redis</span>\n    <span class=\"pl-en\">clear_redis</span>\n    <span class=\"pl-v\">FileUtils</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rm_f</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">REDIS_DB</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">teardown</span>\n    <span class=\"pl-en\">kill_redis</span>\n    <span class=\"pl-v\">FileUtils</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rm_f</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">REDIS_DB</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_whether_job_is_retried_after_dirty_exit</span>\n    <span class=\"pl-v\">Job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">status</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'start'</span>\n\n    <span class=\"pl-v\">Job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">perform_later</span>\n\n    <span class=\"pl-en\">assert</span> <span class=\"pl-v\">Job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">status</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">eql?</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'start'</span><span class=\"pl-kos\">)</span>\n\n    <span class=\"pl-en\">work_for</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span>\n\n    <span class=\"pl-en\">wait_for_workers_to_be_pruned</span>\n\n    <span class=\"pl-en\">assert</span> <span class=\"pl-v\">Job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">status</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">eql?</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'retry'</span><span class=\"pl-kos\">)</span>\n\n    <span class=\"pl-en\">work_for</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">3</span><span class=\"pl-kos\">)</span>\n\n    <span class=\"pl-en\">assert</span> <span class=\"pl-v\">Job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">status</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">eql?</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'done'</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">private</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">work_for</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">time</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">0.5</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">pid</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">fork</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-en\">connect_to_redis</span>\n      <span class=\"pl-s1\">worker</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Resque</span>::<span class=\"pl-v\">Worker</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n      <span class=\"pl-s1\">worker</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">prepare</span>\n      <span class=\"pl-s1\">worker</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">heartbeat</span>\n      <span class=\"pl-s1\">worker</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">work</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-en\">exit!</span>\n    <span class=\"pl-kos\">}</span>\n    <span class=\"pl-en\">sleep</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">time</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-en\">kill</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'KILL'</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">pid</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">spawn_redis</span>\n    <span class=\"pl-c1\">@redis</span> ||= <span class=\"pl-en\">spawn</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">'redis-server'</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'--port'</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">REDIS_PORT</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_s</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'--dbfilename'</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">REDIS_DB</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">join</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">' '</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">out</span>: <span class=\"pl-v\">File</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">open</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'/dev/null'</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'w'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">clear_redis</span>\n    <span class=\"pl-v\">Resque</span>::<span class=\"pl-v\">Failure</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">clear</span>\n    <span class=\"pl-v\">Resque</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">remove_queue</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'std'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-v\">Job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">status</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">''</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">kill_redis</span>\n    <span class=\"pl-en\">kill</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'INT'</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">@redis</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-c1\">@redis</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">nil</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">kill</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">signal</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">pid</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-v\">Process</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">kill</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">signal</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">pid</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-v\">Process</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">waitpid</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">pid</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">connect_to_redis</span>\n    <span class=\"pl-v\">Resque</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">redis</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Redis</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">port</span>: <span class=\"pl-c1\">REDIS_PORT</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">wait_for_workers_to_be_pruned</span>\n    <span class=\"pl-k\">while</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">workers</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Resque</span>::<span class=\"pl-v\">Worker</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">all</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">any?</span>\n      <span class=\"pl-en\">sleep</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">0.1</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-s1\">workers</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">prune_dead_workers</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Expected behavior</h3>\n\n<p dir=\"auto\">It should be possible to handle the exception in the ActiveJob class.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n\n<p dir=\"auto\">It's not possible to handle the exception in ActiveJob without additional resque behaviour added to the JobWrapper class.</p>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: 7.0.0-7.2.0pre (at least)</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: Any</p>",
            "url": "https://github.com/rails/rails/issues/49734",
            "title": "Killed Resque jobs cannot be retried using ActiveJob",
            "date_modified": "2023-10-30T12:53:05.000Z",
            "date_published": "2023-10-21T19:25:48.000Z",
            "author": {
                "name": "geoffyoungs",
                "url": "https://github.com/geoffyoungs"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>",
            "url": "https://github.com/rails/rails/pull/49854",
            "title": "Document ActiveJob::Base#logger and #log_arguments",
            "date_modified": "2023-11-11T00:45:48.000Z",
            "date_published": "2023-10-30T20:11:35.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/4672858?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Summary</h3>\n<p dir=\"auto\">At Shopify, we have been using different flavours of concurrency within <code class=\"notranslate\">ActiveJob</code> for several years.<br>\nThis year we have consolidated all of this functionality into one API method called <code class=\"notranslate\">concurrency</code>.<br>\nAfter validating that this works for the scale of Shopify we decided to port the API upstream.</p>\n<p dir=\"auto\">There have been others attempt to add locking to <code class=\"notranslate\">ActiveJob</code> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"354337924\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/33728\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/33728/hovercard\" href=\"https://github.com/rails/rails/pull/33728\">#33728</a></p>\n<p dir=\"auto\">While that functionality has nothing wrong, we have identified that locking is not enough as a concurrency primitive.</p>\n<p dir=\"auto\">At Shopify, we allow developers to specify multiple concurrency options for there jobs:</p>\n<p dir=\"auto\">In all examples below, <code class=\"notranslate\">keys</code> is the array of keys that will help build a unique concurrency key from the job arguments.</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">EndToEnd</code> where a job holds a concurrency ticket from the moment gets enqueue until the job is performed. When any jobs that try to enter the queue, we check if the concurrent limit is reached, and if it is, we drop the job.<br>\n<code class=\"notranslate\">concurrency(limit: 1, keys: ['checkout_id'])</code></li>\n</ul>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class PaymentProcessingJob &lt; ActiveJob\n  # We only allow one job to be in the queue and processing at all times.\n  # If a job tries to enter the queue while another job with the same checkout_id\n  # is in the queue or performing, we drop the new job.\n\n  # Do not want to charge the same checkout twice :)\n  concurrency(limit: 1, keys: ['checkout_id'])\n\n  def perform(params)\n    # Logic\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">PaymentProcessingJob</span> &lt; <span class=\"pl-v\">ActiveJob</span>\n  <span class=\"pl-c\"># We only allow one job to be in the queue and processing at all times.</span>\n  <span class=\"pl-c\"># If a job tries to enter the queue while another job with the same checkout_id</span>\n  <span class=\"pl-c\"># is in the queue or performing, we drop the new job.</span>\n\n  <span class=\"pl-c\"># Do not want to charge the same checkout twice :)</span>\n  <span class=\"pl-en\">concurrency</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">limit</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">keys</span>: <span class=\"pl-kos\">[</span><span class=\"pl-s\">'checkout_id'</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">params</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-c\"># Logic</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\"><code class=\"notranslate\">EnqueueLimit</code> where a job holds a concurrency ticket from the moment gets enqueue until the jobs get dequeued. When any jobs that try to enter the queue, we check if the concurrent limit is reached and if it is, we drop the job.<br>\n<code class=\"notranslate\">concurrency(limit: { enqueue: 1 }, keys: ['checkout_id'])</code></p>\n</li>\n<li>\n<p dir=\"auto\"><code class=\"notranslate\">PerformLimit</code> where a job holds a concurrency ticket from the moment gets dequeued until the jobs get performed. At the time of the dequeue, we check if the concurrency limit is reached and if so we put that job back into the Delayed queue<br>\n<code class=\"notranslate\">concurrency(limit: { performed: 1 }, keys: ['checkout_id'])</code></p>\n</li>\n</ul>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class UpdateThemeSettingsReferencesJob &lt; ActiveJob\n  # We only allow one job to perform at any moment. \n  # This is often used as a form of throttling for expensive operations.\n  # When a job from the head of the queue tries to start performing while another job \n  # with the same key is already performing, we re-enqueue the new job with a delay.\n  concurrency(\n    limit: { perform: 1 },\n    keys: ['shop_id', 'model', 'model_id']\n  )\n\n  def perform(params)\n    # Logic \n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">UpdateThemeSettingsReferencesJob</span> &lt; <span class=\"pl-v\">ActiveJob</span>\n  <span class=\"pl-c\"># We only allow one job to perform at any moment. </span>\n  <span class=\"pl-c\"># This is often used as a form of throttling for expensive operations.</span>\n  <span class=\"pl-c\"># When a job from the head of the queue tries to start performing while another job </span>\n  <span class=\"pl-c\"># with the same key is already performing, we re-enqueue the new job with a delay.</span>\n  <span class=\"pl-en\">concurrency</span><span class=\"pl-kos\">(</span>\n    <span class=\"pl-pds\">limit</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">perform</span>: <span class=\"pl-c1\">1</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span>\n    <span class=\"pl-pds\">keys</span>: <span class=\"pl-kos\">[</span><span class=\"pl-s\">'shop_id'</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'model'</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'model_id'</span><span class=\"pl-kos\">]</span>\n  <span class=\"pl-kos\">)</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">params</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-c\"># Logic </span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">BoundedStages</code> is the combination of <code class=\"notranslate\">EnqueueLimit</code> and <code class=\"notranslate\">PerformLimit</code><br>\n<code class=\"notranslate\">concurrency(limit: { enqueue: 1, perform:1  }, keys: ['checkout_id'])</code></li>\n</ul>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class ExpensiveIdempotentSyncJob &lt; ActiveJob\n  # This job syncs the data of this shop with an external service.\n  # Since it is expensive, we want only one sync running at a time for each shop.\n  # We need to enqueue this job whenever something changes that requires syncing.\n  # However, if there is already an ExpensiveSyncJob in the queue, that job will sync all the changes made\n  # before it starts running, so there is no need to enqueue duplicates.\n  concurrency(limit: { enqueue: 1, perform: 1 }, keys: ['shop_id'])\n\n  def perform(params)\n    # Logic \n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">ExpensiveIdempotentSyncJob</span> &lt; <span class=\"pl-v\">ActiveJob</span>\n  <span class=\"pl-c\"># This job syncs the data of this shop with an external service.</span>\n  <span class=\"pl-c\"># Since it is expensive, we want only one sync running at a time for each shop.</span>\n  <span class=\"pl-c\"># We need to enqueue this job whenever something changes that requires syncing.</span>\n  <span class=\"pl-c\"># However, if there is already an ExpensiveSyncJob in the queue, that job will sync all the changes made</span>\n  <span class=\"pl-c\"># before it starts running, so there is no need to enqueue duplicates.</span>\n  <span class=\"pl-en\">concurrency</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">limit</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">enqueue</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">perform</span>: <span class=\"pl-c1\">1</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">keys</span>: <span class=\"pl-kos\">[</span><span class=\"pl-s\">'shop_id'</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">params</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-c\"># Logic </span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\"><strong><code class=\"notranslate\">ActiveJob</code> only care about the concurrency at the <code class=\"notranslate\">enqueue</code> (EndToEnd and EnqueueLimit) steps for the <code class=\"notranslate\">perform</code> cases (PerformLimit and BoundedStages) is up to the job adapters to implement it internally. So the adapters can decide to add the functionality or not ðŸ˜„</strong></p>\n<h3 dir=\"auto\">Other Information</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">timeout</code> option allows specifying for how long a job can hold a concurrency ticket.</p>\n<p dir=\"auto\">At Shopify, we allow other API options like <code class=\"notranslate\">perform_delay</code> which configures the delay in which the job is placed back in the delayed queue when the <code class=\"notranslate\">PerformLimit</code> is reached.</p>\n<p dir=\"auto\">Here is an example of the API in use in one of our jobs:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"concurrency(limit: { perform: 8, perform_delay: 300 }, keys: ['task_name'])\"><pre class=\"notranslate\"><code class=\"notranslate\">concurrency(limit: { perform: 8, perform_delay: 300 }, keys: ['task_name'])\n</code></pre></div>",
            "url": "https://github.com/rails/rails/pull/40337",
            "title": "Add concurrency to ActiveJob",
            "date_modified": "2023-05-22T11:21:46.000Z",
            "date_published": "2020-10-05T18:27:44.000Z",
            "author": {
                "name": "GustavoCaso",
                "url": "https://github.com/GustavoCaso"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/509837?u=697e4a265d5359363a5d57a24b07f9a79cb0b08a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Currently if you set <code class=\"notranslate\">config.active_job.queue_adapter = (anything)</code> in <code class=\"notranslate\">config/application.rb</code> or <code class=\"notranslate\">config/environments/test.rb</code>, this config will be respected by some test cases but not others.</p>\n<p dir=\"auto\">Specifically, in <code class=\"notranslate\">ActionDispatch::IntegrationTest</code>, <code class=\"notranslate\">ActionMailer::TestCase</code>, and <code class=\"notranslate\">ActiveJob::TestCase</code>, the test adapter will still be <code class=\"notranslate\">TestAdapter</code>, while in other test cases it will be <code class=\"notranslate\">InlineAdapter</code>.</p>\n<p dir=\"auto\">I think you'd expect that if you set the test adapter for an environment, that test adapter would be available everywhere in that environment. For example, you might want to use the Delayed Job test adapter in your test environment so that you can have your test code more closely match production. The feedback on <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"496901128\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/37270\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/37270/hovercard\" href=\"https://github.com/rails/rails/issues/37270\">#37270</a> echoes this, but the workaround suggested there of disabling the test adapter on specific klasses is not reliable.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">The logic to determine which queue adapter a job uses is quite confusing.</p>\n<p dir=\"auto\">Here is how it works on <code class=\"notranslate\">main</code> currently:</p>\n<ol dir=\"auto\">\n<li>If running in a test, and the test class includes <code class=\"notranslate\">ActiveJob::TestHelper</code> and overrides <code class=\"notranslate\">queue_adapter_for_test</code>, then the <code class=\"notranslate\">queue_adapter_for_test</code> adapter is used.</li>\n<li>Otherwise, if running in a test, and the test class includes <code class=\"notranslate\">ActiveJob::TestHelper</code>, then the <code class=\"notranslate\">:test</code> adapter is used.</li>\n<li>Otherwise, if <code class=\"notranslate\">self.queue_adapter</code> is set on the job class, that adapter is used.</li>\n<li>Otherwise, if <code class=\"notranslate\">self.queue_adapter</code> is set on the job's superclass (eg. <code class=\"notranslate\">ApplicationJob</code>), that adapter is used.</li>\n<li>Fall back to <code class=\"notranslate\">Rails.application.config.active_job.queue_adapter</code> as configured by the user.</li>\n<li>If not configured by the user, <code class=\"notranslate\">Rails.application.config.active_job.queue_adapter</code> defaults to <code class=\"notranslate\">:async</code>.</li>\n<li>Fall back to <code class=\"notranslate\">:async</code> if no Rails config set (eg. using Active Job as a standalone).</li>\n</ol>\n<p dir=\"auto\">As noted above, only some of the built in test classes include <code class=\"notranslate\">ActiveJob::TestHelper</code>. Also, setting a queue adapter on a specific job class is rare (typically you would not want different jobs to be performed by different backends). So in practice, in development/production, option 5 is used. And in test, options 2 and 5 are used, depending on the type of test.</p>\n<p dir=\"auto\">This PR changes the logic to work as follows:</p>\n<ol dir=\"auto\">\n<li>If <code class=\"notranslate\">self.queue_adapter</code> is set on the job class, that adapter is used.</li>\n<li>Otherwise, if <code class=\"notranslate\">self.queue_adapter</code> is set on the job's superclass (eg. <code class=\"notranslate\">ApplicationJob</code>), that adapter is used.</li>\n<li>If running in a test, and the test class includes <code class=\"notranslate\">ActiveJob::TestHelper</code> and overrides <code class=\"notranslate\">queue_adapter_for_test</code>, then the <code class=\"notranslate\">queue_adapter_for_test</code> adapter is used.</li>\n<li>Fall back to <code class=\"notranslate\">Rails.application.config.active_job.queue_adapter</code> as configured by the user.</li>\n<li>If not configured by the user, <code class=\"notranslate\">Rails.application.config.active_job.queue_adapter</code> defaults to <code class=\"notranslate\">:test</code> if <code class=\"notranslate\">Rails.env.test?</code>, otherwise it defaults to <code class=\"notranslate\">:async</code>.</li>\n<li>If running in a test, and the test class includes <code class=\"notranslate\">ActiveJob::TestHelper</code>, and no other adapter has been set (eg. using Active Job as a standalone), then use <code class=\"notranslate\">:test</code>.</li>\n<li>Otherwise, fall back to <code class=\"notranslate\">:async</code>.</li>\n</ol>\n<p dir=\"auto\">The key changes are:</p>\n<ul dir=\"auto\">\n<li>Now, if you set a <code class=\"notranslate\">queue_adapter</code> on a job class, that will always be respected.</li>\n<li>The <code class=\"notranslate\">queue_adapter_for_test</code> override still works, but it no longer takes priority over a queue adapter set on a specific job class. Since I think both of these techniques are rare, and the impact of this change only exists in a test environment, I think it is a relatively safe change.</li>\n<li>The default queue adapter in Rails config is now env-dependent. (It's <code class=\"notranslate\">:test</code> in the <code class=\"notranslate\">test</code> environment, and <code class=\"notranslate\">:async</code> in all others.)</li>\n</ul>\n<p dir=\"auto\">The default rails environment templates suggest <a href=\"https://github.com/rails/rails/blob/f46d3452ae30c46d3e213c687decbbca0cee9119/railties/lib/rails/generators/rails/app/templates/config/environments/production.rb.tt#L79C12-L79C12\">setting a specific queue adapter only in production</a>. For users who do that, there will be no changes to behaviour with this PR.</p>\n<p dir=\"auto\">For users who are more granular, by setting per-job queue adapters, things should continue to work as expected with this PR.</p>\n<p dir=\"auto\"><strong>The real change is for users who set a default queue adapter across all environments (as in this issue: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"496901128\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/37270\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/37270/hovercard\" href=\"https://github.com/rails/rails/issues/37270\">#37270</a>). For them, this PR solves the issue where some tests use the desired queue adapter, and other tests don't.</strong></p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #37270.\">Fixes</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"496901128\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/37270\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/37270/hovercard\" href=\"https://github.com/rails/rails/issues/37270\">#37270</a></p>\n<p dir=\"auto\">ref: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1584425335\" data-permission-text=\"Title is private\" data-url=\"https://github.com/bensheldon/good_job/issues/846\" data-hovercard-type=\"issue\" data-hovercard-url=\"/bensheldon/good_job/issues/846/hovercard\" href=\"https://github.com/bensheldon/good_job/issues/846\">bensheldon/good_job#846</a><br>\nref: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"174675110\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/26360\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/26360/hovercard\" href=\"https://github.com/rails/rails/issues/26360\">#26360</a> - this PR changes the behavior here, which I think was overzealous.</p>\n<p dir=\"auto\">I extracted out some other PRs to fix internal issues while working on this: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1784479707\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48623\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48623/hovercard\" href=\"https://github.com/rails/rails/pull/48623\">#48623</a>, <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1784505846\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48626\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48626/hovercard\" href=\"https://github.com/rails/rails/pull/48626\">#48626</a>. I also extracted <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1778604419\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48599\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48599/hovercard\" href=\"https://github.com/rails/rails/pull/48599\">#48599</a> out as a non-controversial fix prior to this PR.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48585",
            "title": "Active Job: Correctly use the desired test adapter in tests",
            "date_modified": "2023-12-01T03:19:41.000Z",
            "date_published": "2023-06-27T01:01:04.000Z",
            "author": {
                "name": "ghiculescu",
                "url": "https://github.com/ghiculescu"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/99586?u=b4abd791d83e768c72cb832147b4a210caecf47d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Steps to reproduce</h3>\n<p dir=\"auto\">Run a job with retry attempt 1. The won't be retried.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class FooJob &lt; ApplicationJob\n  class FooError &lt; StandardError; end\n\n  retry_on FooError, attempts: 1\n\n  def perform\n    raise FooError\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">FooJob</span> &lt; <span class=\"pl-v\">ApplicationJob</span>\n  <span class=\"pl-k\">class</span> <span class=\"pl-v\">FooError</span> &lt; <span class=\"pl-v\">StandardError</span><span class=\"pl-kos\">;</span> <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-en\">retry_on</span> <span class=\"pl-v\">FooError</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">attempts</span>: <span class=\"pl-c1\">1</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span>\n    <span class=\"pl-en\">raise</span> <span class=\"pl-v\">FooError</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">ActiveJob should retry at most the number of times specified by the attempts option.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\"><code class=\"notranslate\">attempts: 0</code>: runs once, no retry<br>\n<code class=\"notranslate\">attempts: 1</code>: runs once, no retry<br>\n<code class=\"notranslate\">attempts: 2</code>: runs once, one retry<br>\n<code class=\"notranslate\">attempts: 3</code>: runs once, two retries</p>\n<p dir=\"auto\">The behavior is not consistent. We can either change the behavior to be consistent (won't happen?) or at least document it very clearly.</p>\n<p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"358130415\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/33816\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/33816/hovercard\" href=\"https://github.com/rails/rails/issues/33816\">#33816</a> also pointed out the problem.</p>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: Rails 7.0.4</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: ruby 3.1.1p18 (2022-02-18 revision 53f5fc4236) [x86_64-linux]</p>",
            "url": "https://github.com/rails/rails/issues/46419",
            "title": "ActiveJob's retry behavior is not consistent",
            "date_modified": "2023-07-25T22:51:14.000Z",
            "date_published": "2022-11-04T10:37:42.000Z",
            "author": {
                "name": "shouichi",
                "url": "https://github.com/shouichi"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/139634?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49734.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1955634814\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49734\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49734/hovercard\" href=\"https://github.com/rails/rails/issues/49734\">#49734</a></p>\n\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This allows Resque::DirtyExit exceptions to be handled in the same way as other exceptions in ActiveJobs.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This adds an <code class=\"notranslate\">on_failure</code> hook to the Resque JobWrapper class so that when a job is detected as having been killed (via prune_dead_workers) standard ActiveJob retry logic can be used to determine what to do next.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">Because the Resque::DirtyExit exception is generated in the thread that sees that another worker has died (ie. the pruning thread) it's not visible to existing exception handling code in ActiveJob - it requires resque specific code to detect that this has happened and trigger the exception handler.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li>[?] Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49735",
            "title": "Catch and handle Resque::DirtyExit exceptions in ActiveJob",
            "date_modified": "2023-11-01T10:12:15.000Z",
            "date_published": "2023-10-21T19:31:07.000Z",
            "author": {
                "name": "geoffyoungs",
                "url": "https://github.com/geoffyoungs"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/79303?u=99e3bc7887879138e88a4538ca623b0a3d7538cb&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Summary</h3>\n<p dir=\"auto\">Like many folks, I set this in my <code class=\"notranslate\">config/environments/test.rb</code> file:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"config.active_job.queue_adapter = :inline  \"><pre class=\"notranslate\"><span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">:inline</span>  </pre></div>\n<p dir=\"auto\">The reason I do this is to have easy-to-test, deterministic behavior of any potentially async delayed jobs triggered by the application. Under Rails 5, all of my tests (children of <code class=\"notranslate\">ActiveSupport::TestCase</code> and <code class=\"notranslate\">ActionDispatch::SystemTestCase</code> alike) would respect this queue adapter. However, under Rails 6, any built-in Rails test case that includes <code class=\"notranslate\">ActiveJob::TestHelper</code> will also override this setting for all descendants of <code class=\"notranslate\">ActiveJob::Base</code> (<a href=\"https://github.com/rails/rails/blob/master/activejob/lib/active_job/test_helper.rb#L39-L41\">relevant source</a>).</p>\n<p dir=\"auto\">The net effect of this is that my <code class=\"notranslate\">perform_later</code> and <code class=\"notranslate\">deliver_later</code> calls to jobs aren't being fired synchronously (or, in fact, at all) during my system tests, which is leading to test failures upon upgrading to Rails 6.</p>\n<h3 dir=\"auto\">Steps to reproduce</h3>\n<p dir=\"auto\">Here are two tests that demonstrates the problem:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"require &quot;test_helper&quot;\n\nclass JobTest &lt; ActiveSupport::TestCase\n  class SomeJob &lt; ActiveJob::Base\n    cattr_accessor :job_ran\n\n    def perform\n      @@job_ran = true\n    end\n  end\n\n  def test_some_job\n    assert_equal :inline, Rails.application.config.active_job.queue_adapter\n    assert_equal ActiveJob::QueueAdapters::InlineAdapter, SomeJob.queue_adapter.class\n\n    SomeJob.perform_later\n\n    assert_equal true, SomeJob.job_ran\n  end\nend\n\nclass JobSystemTest &lt; ActionDispatch::SystemTestCase\n  class OtherJob &lt; ActiveJob::Base\n    cattr_accessor :job_ran\n\n    def perform\n      @@job_ran = true\n    end\n  end\n\n  def test_other_job\n    assert_equal :inline, Rails.application.config.active_job.queue_adapter\n    assert_equal ActiveJob::QueueAdapters::InlineAdapter, OtherJob.queue_adapter.class\n\n    OtherJob.perform_later\n\n    assert_equal true, OtherJob.job_ran\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">require</span> <span class=\"pl-s\">\"test_helper\"</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">JobTest</span> &lt; <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">TestCase</span>\n  <span class=\"pl-k\">class</span> <span class=\"pl-v\">SomeJob</span> &lt; <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Base</span>\n    <span class=\"pl-en\">cattr_accessor</span> <span class=\"pl-pds\">:job_ran</span>\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span>\n      <span class=\"pl-c1\">@@job_ran</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">true</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_some_job</span>\n    <span class=\"pl-en\">assert_equal</span> <span class=\"pl-pds\">:inline</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span>\n    <span class=\"pl-en\">assert_equal</span> <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">QueueAdapters</span>::<span class=\"pl-v\">InlineAdapter</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">SomeJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">class</span>\n\n    <span class=\"pl-v\">SomeJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">perform_later</span>\n\n    <span class=\"pl-en\">assert_equal</span> <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">SomeJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">job_ran</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">JobSystemTest</span> &lt; <span class=\"pl-v\">ActionDispatch</span>::<span class=\"pl-v\">SystemTestCase</span>\n  <span class=\"pl-k\">class</span> <span class=\"pl-v\">OtherJob</span> &lt; <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Base</span>\n    <span class=\"pl-en\">cattr_accessor</span> <span class=\"pl-pds\">:job_ran</span>\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span>\n      <span class=\"pl-c1\">@@job_ran</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">true</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_other_job</span>\n    <span class=\"pl-en\">assert_equal</span> <span class=\"pl-pds\">:inline</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span>\n    <span class=\"pl-en\">assert_equal</span> <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">QueueAdapters</span>::<span class=\"pl-v\">InlineAdapter</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">OtherJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">class</span>\n\n    <span class=\"pl-v\">OtherJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">perform_later</span>\n\n    <span class=\"pl-en\">assert_equal</span> <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">OtherJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">job_ran</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">I would expect the behavior to have remained as it did under Rails 5, where the <code class=\"notranslate\">active_job.queue_adapter</code> setting would be respected for all of Rails' test types.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\">The first test, which descends from <code class=\"notranslate\">ActiveSupport::TestCase</code> will pass and behave as it did under Rails 5. However, the second test, descending from from <code class=\"notranslate\">ActionDispatch::SystemTestCase</code> will now fail under Rails 6, because <code class=\"notranslate\">OtherJob</code>'s <code class=\"notranslate\">queue_adapter</code> will have been reset by <code class=\"notranslate\">ActiveJob::TestHelper</code> to be an instance of <code class=\"notranslate\">TestAdapter</code></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"JobSystemTest#test_other_job [/Users/justin/code/testdouble/present/test/lib/job_test.rb:33]:\n--- expected\n+++ actual\n@@ -1 +1 @@\n-ActiveJob::QueueAdapters::InlineAdapter\n+ActiveJob::QueueAdapters::TestAdapter\"><pre class=\"notranslate\"><code class=\"notranslate\">JobSystemTest#test_other_job [/Users/justin/code/testdouble/present/test/lib/job_test.rb:33]:\n--- expected\n+++ actual\n@@ -1 +1 @@\n-ActiveJob::QueueAdapters::InlineAdapter\n+ActiveJob::QueueAdapters::TestAdapter\n</code></pre></div>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: 6.0.0 as well as <a href=\"https://github.com/rails/rails/tree/2bc6a948a2f46f8cf2d44506af1be235691c84b5\">6-0-stable</a>, as of today.</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: ruby 2.6.3p62 (2019-04-16 revision 67580) [x86_64-darwin18]</p>",
            "url": "https://github.com/rails/rails/issues/37270",
            "title": "Rails 6 inconsistently overrides ActiveJob queue_adapter setting with TestAdapter",
            "date_modified": "2023-06-27T01:01:16.000Z",
            "date_published": "2019-09-23T05:29:13.000Z",
            "author": {
                "name": "searls",
                "url": "https://github.com/searls"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/94129?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">On latest main, tests for an application of mine reliably stall locally and in CI. Sometimes warnings like the following are printed:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"WARNING:  there is already a transaction in progress\nmessage type 0x43 arrived from server while idle\nmessage type 0x5a arrived from server while idle\"><pre class=\"notranslate\"><code class=\"notranslate\">WARNING:  there is already a transaction in progress\nmessage type 0x43 arrived from server while idle\nmessage type 0x5a arrived from server while idle\n</code></pre></div>\n<p dir=\"auto\">Environment:</p>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">The app uses a single Postgres DB and ARâ€™s Postgres adapter.</p>\n</li>\n<li>\n<p dir=\"auto\">It uses RSpec and FactoryBot, not Minitest or AR fixtures.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"rspec-core (3.12.0)\n  rspec-support (~&gt; 3.12.0)\nrspec-expectations (3.12.0)\n  diff-lcs (&gt;= 1.2.0, &lt; 2.0)\n  rspec-support (~&gt; 3.12.0)\nrspec-mocks (3.12.0)\n  diff-lcs (&gt;= 1.2.0, &lt; 2.0)\n  rspec-support (~&gt; 3.12.0)\nrspec-rails (6.0.1)\n  actionpack (&gt;= 6.1)\n  activesupport (&gt;= 6.1)\n  railties (&gt;= 6.1)\n  rspec-core (~&gt; 3.11)\n  rspec-expectations (~&gt; 3.11)\n  rspec-mocks (~&gt; 3.11)\n  rspec-support (~&gt; 3.11)\nrspec-support (3.12.0)\"><pre class=\"notranslate\"><code class=\"notranslate\">rspec-core (3.12.0)\n  rspec-support (~&gt; 3.12.0)\nrspec-expectations (3.12.0)\n  diff-lcs (&gt;= 1.2.0, &lt; 2.0)\n  rspec-support (~&gt; 3.12.0)\nrspec-mocks (3.12.0)\n  diff-lcs (&gt;= 1.2.0, &lt; 2.0)\n  rspec-support (~&gt; 3.12.0)\nrspec-rails (6.0.1)\n  actionpack (&gt;= 6.1)\n  activesupport (&gt;= 6.1)\n  railties (&gt;= 6.1)\n  rspec-core (~&gt; 3.11)\n  rspec-expectations (~&gt; 3.11)\n  rspec-mocks (~&gt; 3.11)\n  rspec-support (~&gt; 3.11)\nrspec-support (3.12.0)\n</code></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Itâ€™s on Ruby 3.1.3.</p>\n</li>\n</ul>\n<p dir=\"auto\">A <code class=\"notranslate\">git bisect</code> pointed to <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/1a2ca1920c62abdd08c809df1fa98fe0acf14bc3/hovercard\" href=\"https://github.com/rails/rails/commit/1a2ca1920c62abdd08c809df1fa98fe0acf14bc3\"><tt>1a2ca19</tt></a> (cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a>). That change does seem relevant, but I havenâ€™t been able to reproduce the issue in a minimal app yet. Iâ€™ve tried with both Minitest and RSpec.</p>\n<p dir=\"auto\">The tests usually stall in around the same place with the same seed, but not <em>exactly</em> the same place. And I looked at two stalled runs with different seeds that didnâ€™t run any common tests before their stalls.</p>\n<p dir=\"auto\">This has been difficult to pin down so far but I will keep looking.</p>",
            "url": "https://github.com/rails/rails/issues/46797",
            "title": "Active Job async adapter may use connections without a lease",
            "date_modified": "2023-10-27T03:40:46.000Z",
            "date_published": "2022-12-23T04:15:25.000Z",
            "author": {
                "name": "georgeclaghorn",
                "url": "https://github.com/georgeclaghorn"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/107635?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I've been stuck on a failing test about a job that was supposed to be rescued from exceptions, and after an embarrassing amount of time I came to realise that using <code class=\"notranslate\">perform</code> shortcuts all of the ActiveJob niceties.</p>\n<p dir=\"auto\">This Pull Request has been created because I don't want other people to confuse the <code class=\"notranslate\">perform</code>, <code class=\"notranslate\">perform_now</code> or <code class=\"notranslate\">perform_later</code> altogether and waste valuable time trying to understand why the first one doesn't behave like the two others.</p>\n<p dir=\"auto\">Feel free to challenge the wording as you please âœŒï¸</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the ActiveJob guide.</p>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49301",
            "title": "[ci skip] clarify the benefits of using ActiveJob's execution wrappers",
            "date_modified": "2023-09-23T12:55:07.000Z",
            "date_published": "2023-09-16T10:36:45.000Z",
            "author": {
                "name": "freesteph",
                "url": "https://github.com/freesteph"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2741?u=387c085565dc648f11d835558ad1b6d524ddc91d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This is a common source of job errors:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Project &lt; ApplicationRecord\n  after_create -&gt; { NotifyProjectParticipants.perform_later self }\nend\n\nclass NotifyProjectParticipants &lt; ApplicationJob\n  def perform(project)\n    # This will explode with a ActiveJob::DeserializationError,\n    #  if the job runs before the INSERT transaction for the new project completes.\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Project</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">after_create</span> <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-v\">NotifyProjectParticipants</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">perform_later</span> <span class=\"pl-smi\">self</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">NotifyProjectParticipants</span> &lt; <span class=\"pl-v\">ApplicationJob</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">project</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-c\"># This will explode with a ActiveJob::DeserializationError,</span>\n    <span class=\"pl-c\">#  if the job runs before the INSERT transaction for the new project completes.</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">It's insidious too. Because it'll often work in development, then fail in production, when your job queue is really fast, and your database might be bogged down.</p>\n<p dir=\"auto\">The proper way is of course:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Project &lt; ApplicationRecord\n  after_create_commit -&gt; { NotifyProjectParticipants.perform_later self }\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Project</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">after_create_commit</span> <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-v\">NotifyProjectParticipants</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">perform_later</span> <span class=\"pl-smi\">self</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">But that's easy to forget. So I suggest that we create a new default that disallow jobs from being scheduled within transactions. You should be able to turn that off, but it would be a better default, since it would catch this class for errors for more people before they deploy to production.</p>",
            "url": "https://github.com/rails/rails/issues/26045",
            "title": "Prevent jobs from being scheduled within transactions",
            "date_modified": "2023-10-09T10:09:18.000Z",
            "date_published": "2016-08-03T17:21:16.000Z",
            "author": {
                "name": "dhh",
                "url": "https://github.com/dhh"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/14981592?u=11406fb0121b15a93b3305388377a57b4d9c96f9&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Steps to reproduce</h3>\n<p dir=\"auto\">I have a test case like this</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# frozen_string_literal: true\n\nrequire &quot;bundler/inline&quot;\n\ngemfile(true) do\n  source &quot;https://rubygems.org&quot;\n\n  git_source(:github) { |repo| &quot;https://github.com/#{repo}.git&quot; }\n\n  gem &quot;rails&quot;, github: &quot;rails/rails&quot;, branch: &quot;main&quot;\nend\n\nrequire &quot;active_support/railtie&quot;\nrequire &quot;active_job/railtie&quot;\nrequire &quot;minitest/autorun&quot;\n\nclass TestApp &lt; Rails::Application\n  config.load_defaults 7.1\n\n  config.active_job.queue_adapter = :inline\n  config.eager_load = false\nend\n\nRails.application.initialize!\n\nclass Current &lt; ActiveSupport::CurrentAttributes\n  attribute :user\nend\n\nclass DummyJob &lt; ActiveJob::Base\n  def perform\n  end\nend\n\nclass CurrentAttributeTest &lt; ActiveSupport::TestCase\n  test &quot;CurrentAttributes&quot; do\n    Current.user = &quot;test&quot;\n    DummyJob.perform_later\n\n    assert_equal(&quot;test&quot;, Current.user, &quot;CurrentAttributes reset&quot;)\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/inline\"</span>\n\n<span class=\"pl-en\">gemfile</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">source</span> <span class=\"pl-s\">\"https://rubygems.org\"</span>\n\n  <span class=\"pl-en\">git_source</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:github</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">repo</span>| <span class=\"pl-s\">\"https://github.com/<span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">repo</span><span class=\"pl-kos\">}</span></span>.git\"</span> <span class=\"pl-kos\">}</span>\n\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"rails\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">github</span>: <span class=\"pl-s\">\"rails/rails\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">branch</span>: <span class=\"pl-s\">\"main\"</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support/railtie\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_job/railtie\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"minitest/autorun\"</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">TestApp</span> &lt; <span class=\"pl-v\">Rails</span>::<span class=\"pl-v\">Application</span>\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">load_defaults</span> <span class=\"pl-c1\">7.1</span>\n\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">:inline</span>\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">eager_load</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">false</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">initialize!</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Current</span> &lt; <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">CurrentAttributes</span>\n  <span class=\"pl-en\">attribute</span> <span class=\"pl-pds\">:user</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">DummyJob</span> &lt; <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">CurrentAttributeTest</span> &lt; <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">TestCase</span>\n  <span class=\"pl-en\">test</span> <span class=\"pl-s\">\"CurrentAttributes\"</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-v\">Current</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"test\"</span>\n    <span class=\"pl-v\">DummyJob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">perform_later</span>\n\n    <span class=\"pl-en\">assert_equal</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"test\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Current</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">user</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"CurrentAttributes reset\"</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Using the inline queue adapter the second assertion failed. <del>I tried making a self-contained test script but couldn't manage, the attributes only seem to be reset when I run it in a full-blown rails app. I have created a sample app here <a href=\"https://github.com/Earlopain/rails-current-attributes\">https://github.com/Earlopain/rails-current-attributes</a>, you can just run rake test there.</del></p>\n<p dir=\"auto\">I found issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"510406777\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/37526\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/37526/hovercard\" href=\"https://github.com/rails/rails/issues/37526\">#37526</a> and pr <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"512749160\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/37568\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/37568/hovercard\" href=\"https://github.com/rails/rails/pull/37568\">#37568</a> which seem to be about the same thing and it looks like they were closed as fixed/completed. Don't know what to make of that, just wanted to document.</p>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">CurrentAttributes are preserved.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\">CurrentAttributes are cleared.</p>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: main</p>\n<p dir=\"auto\"><strong>Ruby version</strong>: 3.2.2</p>",
            "url": "https://github.com/rails/rails/issues/49227",
            "title": "`CurrentAttribute`s are cleared when a job gets executed inline in tests",
            "date_modified": "2023-10-12T02:57:55.000Z",
            "date_published": "2023-09-11T21:28:34.000Z",
            "author": {
                "name": "Earlopain",
                "url": "https://github.com/Earlopain"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/212648?u=26fba345a54b891629623ec9549fc0c54a2c2950&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because I needed <code class=\"notranslate\">retry_on attempts:</code> to use more complex logic than an Integer.</p>\n<p dir=\"auto\">In my specific case I was creating a concern for Jobs that would use <code class=\"notranslate\">retry_on</code> to allow jobs to quietly fail and retry. The concern was going to use a method to allow attempts to be customized in individual jobs.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    included do\n      retry_on(QuietRetryError, wait: :exponentially_longer, attempts: quiet_retry_attempts) do\n        # ...\n      end\n    end\"><pre class=\"notranslate\"><code class=\"notranslate\">    included do\n      retry_on(QuietRetryError, wait: :exponentially_longer, attempts: quiet_retry_attempts) do\n        # ...\n      end\n    end\n</code></pre></div>\n<p dir=\"auto\">However this ran into a state where the method needed to be defined and run when the concern was included instead of being available later in the job. It would be very fragile to have to define the method before including the concern. This lead to me to looking at if attempts accepted anything besides an integer. It did not but I saw there was already a pattern in place for wait to accept a Proc. I thought if that pattern was repeated for attempts than it would allow more flexibility for configuring attempts.</p>\n<p dir=\"auto\">My original thought was to have the Proc for attempts return a number similar to what the Proc for wait does. However, on thinking about it I decided that still did not leave much flexibility because attempts would still be determined by a number. Instead I switched it to return true/false so if the next attempt occurred could be determined by whatever logic was implemented in the Proc.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes ActiveJob retry_on attempts so it will accept a Proc.</p>\n<p dir=\"auto\">ActiveJob retry_on allowed the wait option to be set as a Proc that calculates the wait but did not give the same option for attempts. attempts could be set to only a number of times to attempt or unlimited. However, jobs sometimes need different logic than number of executions to determine if they should try again.</p>\n<p dir=\"auto\">This PR adds support for setting attempts to a Proc that returns either true or false. On true the retry will occur.</p>\n<p dir=\"auto\">As a an example:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"retry_on ProcRetryError, attempts: -&gt;(executions) { executions &lt; 2 }\"><pre class=\"notranslate\"><code class=\"notranslate\">retry_on ProcRetryError, attempts: -&gt;(executions) { executions &lt; 2 }\n</code></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> There are no typos in commit messages and comments.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Feature branch is up-to-date with <code class=\"notranslate\">main</code> (if not - rebase it).</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Pull request only contains one commit for bug fixes and small features. If it's a larger feature, multiple commits are permitted but must be descriptive.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> PR is not in a draft state.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CI is passing.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/46245",
            "title": "Add Proc as a type for ActiveJob retry_on attempts",
            "date_modified": "2022-10-18T21:34:58.000Z",
            "date_published": "2022-10-14T14:32:44.000Z",
            "author": {
                "name": "rosew",
                "url": "https://github.com/rosew"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Active Support expects a <code class=\"notranslate\">File</code> instance, or at the very least an open <code class=\"notranslate\">IO</code> instance.<br>\nUnfortunately, a <code class=\"notranslate\">URL</code> is neither, but can be transformed into one.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit introduces the <code class=\"notranslate\">ActiveStorage::AttachRemoteFileJob</code> to download the remote file referenced by the <code class=\"notranslate\">URL</code>.</p>\n<p dir=\"auto\">When saving a record with attachments, support assignment to <code class=\"notranslate\">#{name}_url</code> and <code class=\"notranslate\">#{name}_urls</code> (for <code class=\"notranslate\">has_one_attached</code> and <code class=\"notranslate\">has_many_attached</code>, respectively), then download those for their underlying attachments.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"url = &quot;http://example.com/racecar.jpg&quot;\nrecord = User.new(...)\n\nassert_enqueued_with job: ActiveStorage::AttachRemoteFileJob, args: [record, :avatar, url] do\n  record.update! avatar_url: url\nend\n\n # some time later\n\nrecord.avatar.attached? #=&gt; true\"><pre class=\"notranslate\"><span class=\"pl-s1\">url</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"http://example.com/racecar.jpg\"</span>\n<span class=\"pl-s1\">record</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span>...<span class=\"pl-kos\">)</span>\n\n<span class=\"pl-en\">assert_enqueued_with</span> <span class=\"pl-pds\">job</span>: <span class=\"pl-v\">ActiveStorage</span>::<span class=\"pl-v\">AttachRemoteFileJob</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">args</span>: <span class=\"pl-kos\">[</span><span class=\"pl-s1\">record</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:avatar</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">url</span><span class=\"pl-kos\">]</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-s1\">record</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">update!</span> <span class=\"pl-pds\">avatar_url</span>: <span class=\"pl-s1\">url</span>\n<span class=\"pl-k\">end</span>\n\n <span class=\"pl-c\"># some time later</span>\n\n<span class=\"pl-s1\">record</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">avatar</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">attached?</span> <span class=\"pl-c\">#=&gt; true</span></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/46801",
            "title": "Introduce ActiveStorage::AttachRemoteFileJob",
            "date_modified": "2023-09-22T15:23:13.000Z",
            "date_published": "2022-12-23T15:04:17.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/75187597?u=68c0f410b8ee3255a103943b21427b556f9a5a21&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">ActiveJob produces a large amount of log noise, because errors that are emitted from ActiveJob don't have the standard Rails BacktraceCleaner applied. This is especially apparent when using Sorbet for Ruby types, since each application method call is wrapped by multiple Sorbet typechecking functions. My application's activejob error backtraces would typically log 4 non-relevant Sorbet function calls for each application function call. My workaround has been to monkey-patch Rails in our application. However, it seems to make sense to simply bring this behavior into ActiveJob as the default, as the backtrace cleaner is a pretty standard piece of Rails machinery that is used for most other backtraces in Rails.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">When ActiveJob encounters an error performing a job, rather than printing the full unfiltered (and noisy) exception backtrace, print the cleaned backtrace using Rails's BacktraceCleaner.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CI is passing.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/46555",
            "title": "Small PR: Apply Rails backtrace cleaner to ActiveJob backtrace printout",
            "date_modified": "2022-12-11T11:33:55.000Z",
            "date_published": "2022-11-23T00:45:44.000Z",
            "author": {
                "name": "warrenbhw",
                "url": "https://github.com/warrenbhw"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/951433?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Steps to reproduce</h3>\n<p dir=\"auto\">We have a project with a multi-database (2 databases) configuration.<br>\nWhen executing the test suite like follows the tests hang after some time.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"PARALLEL_WORKERS=1 bin/rails test\"><pre class=\"notranslate\"><span class=\"pl-c1\">PARALLEL_WORKERS</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">1</span> <span class=\"pl-en\">bin</span>/<span class=\"pl-en\">rails</span> <span class=\"pl-en\">test</span></pre></div>\n<p dir=\"auto\">As you can see in the sigdump all threads get stuck in <code class=\"notranslate\">load_interlock_aware_monitor.rb:17:in 'enter' </code><br>\nI am currently trying to create an example project to reproduce this issue but maybe this info is enough for now to make some conclusions.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Sigdump at 2023-06-14 10:11:32 +0200 process 90089 (bin/rails)\n  Thread #&lt;Thread:0x00000001023db0f0 run&gt; status=run priority=0\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:52:in `backtrace'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:52:in `dump_backtrace'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:34:in `block in dump_all_thread_backtrace'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:33:in `each'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:33:in `dump_all_thread_backtrace'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:16:in `block in dump'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:136:in `open'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:136:in `_open_dump_path'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:14:in `dump'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:7:in `block in setup'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `block in mon_enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/share_lock.rb:187:in `yield_shares'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/dependencies/interlock.rb:41:in `permit_concurrent_loads'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `mon_enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:22:in `block in synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `handle_interrupt'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/query_cache.rb:91:in `clear_query_cache'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_handling.rb:343:in `block in clear_on_handler'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_handling.rb:342:in `each'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_handling.rb:342:in `clear_on_handler'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_handling.rb:272:in `clear_query_caches_for_current_thread'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/query_cache.rb:21:in `insert'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/persistence.rb:496:in `_insert_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/persistence.rb:1096:in `_create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/counter_cache.rb:166:in `_create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/locking/optimistic.rb:79:in `_create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/attribute_methods/dirty.rb:222:in `_create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/callbacks.rb:459:in `block in _create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:107:in `run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:929:in `_run_create_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/callbacks.rb:459:in `_create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/timestamp.rb:108:in `_create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/bullet-7.0.7/lib/bullet/active_record70.rb:6:in `_create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/persistence.rb:1067:in `create_or_update'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/callbacks.rb:455:in `block in create_or_update'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:118:in `block in run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/autosave_association.rb:370:in `around_save_collection_association'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:127:in `block in run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:138:in `run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:929:in `_run_save_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/callbacks.rb:455:in `create_or_update'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/timestamp.rb:126:in `create_or_update'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/persistence.rb:648:in `save!'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/validations.rb:53:in `save!'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/transactions.rb:302:in `block in save!'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/transactions.rb:354:in `block in with_transaction_returning_status'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/transaction.rb:319:in `block in within_new_transaction'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:25:in `handle_interrupt'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:25:in `block in synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `handle_interrupt'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/transaction.rb:317:in `within_new_transaction'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/database_statements.rb:316:in `transaction'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/transactions.rb:350:in `with_transaction_returning_status'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/transactions.rb:302:in `save!'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/suppressor.rb:54:in `save!'\n      /Users/krebbl/Projects/ProCarement/care-center/app/models/medical_report.rb:121:in `save_report_as_document'\n      /Users/krebbl/Projects/ProCarement/care-center/test/models/medical_report_test.rb:167:in `block (3 levels) in &lt;class:MedicalReportTest&gt;'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/testing/assertions.rb:34:in `assert_nothing_raised'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/testing/assertions.rb:250:in `_assert_nothing_raised_or_warn'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/testing/assertions.rb:102:in `assert_difference'\n      /Users/krebbl/Projects/ProCarement/care-center/test/models/medical_report_test.rb:165:in `block (2 levels) in &lt;class:MedicalReportTest&gt;'\n      /Users/krebbl/Projects/ProCarement/care-center/test/models/medical_report_test.rb:172:in `instance_exec'\n      /Users/krebbl/Projects/ProCarement/care-center/test/models/medical_report_test.rb:172:in `block in create_test_from_should_hash'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/test.rb:102:in `block (3 levels) in run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/test.rb:199:in `capture_exceptions'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/test.rb:97:in `block (2 levels) in run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:296:in `time_it'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/test.rb:96:in `block in run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:391:in `on_signal'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/test.rb:247:in `with_info_handler'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/test.rb:95:in `run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-reporters-1.4.3/lib/minitest/reporters.rb:48:in `run_with_hooks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:1051:in `run_one_method'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:365:in `run_one_method'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:352:in `block (2 levels) in run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:351:in `each'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:351:in `block in run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:391:in `on_signal'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:378:in `with_info_handler'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:350:in `run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/railties-7.0.5/lib/rails/test_unit/line_filtering.rb:10:in `run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:182:in `block in __run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:182:in `map'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:182:in `__run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:159:in `run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:83:in `block in autorun'\n  Thread #&lt;Thread:0x0000000109047888 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/connection_pool/reaper.rb:40 sleep&gt; status=sleep priority=0\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/connection_pool/reaper.rb:46:in `sleep'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/connection_pool/reaper.rb:46:in `block in spawn_thread'\n  Thread #&lt;Thread:0x0000000109443018@Timeout stdlib thread /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/timeout-0.3.2/lib/timeout.rb:101 sleep&gt; status=sleep priority=0\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/timeout-0.3.2/lib/timeout.rb:113:in `sleep'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/timeout-0.3.2/lib/timeout.rb:113:in `wait'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/timeout-0.3.2/lib/timeout.rb:113:in `block (2 levels) in create_timeout_thread'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/timeout-0.3.2/lib/timeout.rb:111:in `synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/timeout-0.3.2/lib/timeout.rb:111:in `block in create_timeout_thread'\n  Thread #&lt;Thread:0x000000010c94b918 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010c94b800 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010c94b710 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010c94b620 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010c94b530 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010c94b440 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010c94b350 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010c94b260 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010ce4f180@worker-1 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:332 sleep_forever&gt; status=sleep priority=0\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `block in mon_enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/share_lock.rb:187:in `yield_shares'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/dependencies/interlock.rb:41:in `permit_concurrent_loads'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `mon_enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:22:in `block in synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `handle_interrupt'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/query_cache.rb:128:in `cache_sql'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/query_cache.rb:107:in `select_all'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/querying.rb:54:in `_query_by_sql'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:942:in `block in exec_main_query'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:962:in `skip_query_cache_if_necessary'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:928:in `exec_main_query'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:914:in `block in exec_queries'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:962:in `skip_query_cache_if_necessary'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:908:in `exec_queries'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:695:in `load'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:250:in `records'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/bullet-7.0.7/lib/bullet/active_record70.rb:46:in `records'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:520:in `find_take'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:98:in `take'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:473:in `find_one'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:457:in `find_with_ids'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:69:in `find'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/querying.rb:22:in `find'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/core.rb:271:in `find'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:129:in `locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:154:in `block in locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:164:in `block in unscoped'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:881:in `_scoping'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:428:in `scoping'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/scoping/default.rb:43:in `unscoped'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:164:in `unscoped'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:154:in `locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:16:in `locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:148:in `deserialize_global_id'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:132:in `deserialize_argument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:43:in `block in deserialize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:43:in `map'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:43:in `deserialize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/core.rb:190:in `deserialize_arguments'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/core.rb:180:in `deserialize_arguments_if_needed'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/execution.rb:44:in `perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:14:in `block in perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:25:in `block in instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/notifications.rb:206:in `block in instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/notifications/instrumenter.rb:24:in `instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/notifications.rb:206:in `instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:35:in `instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:14:in `perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/logging.rb:18:in `block in perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/tagged_logging.rb:99:in `block in tagged'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/tagged_logging.rb:37:in `tagged'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/tagged_logging.rb:99:in `tagged'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/logging.rb:25:in `tag_logger'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/logging.rb:18:in `perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/execution.rb:24:in `block in execute'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:118:in `block in run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/railtie.rb:54:in `block (4 levels) in &lt;class:Railtie&gt;'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/execution_wrapper.rb:92:in `wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/reloader.rb:72:in `block in wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/execution_wrapper.rb:92:in `wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/reloader.rb:71:in `wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/railtie.rb:53:in `block (3 levels) in &lt;class:Railtie&gt;'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:127:in `instance_exec'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:127:in `block in run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:138:in `run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/execution.rb:22:in `execute'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/queue_adapters/async_adapter.rb:70:in `perform'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:352:in `run_task'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:343:in `block (3 levels) in create_worker'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:334:in `loop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:334:in `block (2 levels) in create_worker'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:333:in `catch'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:333:in `block in create_worker'\n  Thread #&lt;Thread:0x000000010d989d20@worker-2 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:332 sleep_forever&gt; status=sleep priority=0\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `block in mon_enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/share_lock.rb:187:in `yield_shares'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/dependencies/interlock.rb:41:in `permit_concurrent_loads'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `mon_enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:22:in `block in synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `handle_interrupt'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/query_cache.rb:128:in `cache_sql'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/query_cache.rb:107:in `select_all'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/querying.rb:54:in `_query_by_sql'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:942:in `block in exec_main_query'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:962:in `skip_query_cache_if_necessary'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:928:in `exec_main_query'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:914:in `block in exec_queries'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:962:in `skip_query_cache_if_necessary'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:908:in `exec_queries'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:695:in `load'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:250:in `records'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/bullet-7.0.7/lib/bullet/active_record70.rb:46:in `records'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:520:in `find_take'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:98:in `take'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:473:in `find_one'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:457:in `find_with_ids'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:69:in `find'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/querying.rb:22:in `find'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/core.rb:271:in `find'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:129:in `locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:154:in `block in locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:164:in `block in unscoped'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:881:in `_scoping'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:428:in `scoping'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/scoping/default.rb:43:in `unscoped'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:164:in `unscoped'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:154:in `locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:16:in `locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:148:in `deserialize_global_id'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:132:in `deserialize_argument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:43:in `block in deserialize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:43:in `map'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:43:in `deserialize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/core.rb:190:in `deserialize_arguments'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/core.rb:180:in `deserialize_arguments_if_needed'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/execution.rb:44:in `perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:14:in `block in perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:25:in `block in instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/notifications.rb:206:in `block in instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/notifications/instrumenter.rb:24:in `instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/notifications.rb:206:in `instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:35:in `instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:14:in `perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/logging.rb:18:in `block in perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/tagged_logging.rb:99:in `block in tagged'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/tagged_logging.rb:37:in `tagged'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/tagged_logging.rb:99:in `tagged'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/logging.rb:25:in `tag_logger'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/logging.rb:18:in `perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/execution.rb:24:in `block in execute'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:118:in `block in run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/railtie.rb:54:in `block (4 levels) in &lt;class:Railtie&gt;'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/execution_wrapper.rb:92:in `wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/reloader.rb:72:in `block in wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/execution_wrapper.rb:92:in `wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/reloader.rb:71:in `wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/railtie.rb:53:in `block (3 levels) in &lt;class:Railtie&gt;'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:127:in `instance_exec'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:127:in `block in run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:138:in `run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/execution.rb:22:in `execute'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/queue_adapters/async_adapter.rb:70:in `perform'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:352:in `run_task'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:343:in `block (3 levels) in create_worker'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:334:in `loop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:334:in `block (2 levels) in create_worker'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:333:in `catch'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:333:in `block in create_worker'\n\"><pre class=\"notranslate\"><code class=\"notranslate\">Sigdump at 2023-06-14 10:11:32 +0200 process 90089 (bin/rails)\n  Thread #&lt;Thread:0x00000001023db0f0 run&gt; status=run priority=0\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:52:in `backtrace'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:52:in `dump_backtrace'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:34:in `block in dump_all_thread_backtrace'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:33:in `each'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:33:in `dump_all_thread_backtrace'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:16:in `block in dump'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:136:in `open'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:136:in `_open_dump_path'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:14:in `dump'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/sigdump-0.2.4/lib/sigdump.rb:7:in `block in setup'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `block in mon_enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/share_lock.rb:187:in `yield_shares'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/dependencies/interlock.rb:41:in `permit_concurrent_loads'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `mon_enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:22:in `block in synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `handle_interrupt'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/query_cache.rb:91:in `clear_query_cache'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_handling.rb:343:in `block in clear_on_handler'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_handling.rb:342:in `each'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_handling.rb:342:in `clear_on_handler'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_handling.rb:272:in `clear_query_caches_for_current_thread'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/query_cache.rb:21:in `insert'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/persistence.rb:496:in `_insert_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/persistence.rb:1096:in `_create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/counter_cache.rb:166:in `_create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/locking/optimistic.rb:79:in `_create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/attribute_methods/dirty.rb:222:in `_create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/callbacks.rb:459:in `block in _create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:107:in `run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:929:in `_run_create_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/callbacks.rb:459:in `_create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/timestamp.rb:108:in `_create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/bullet-7.0.7/lib/bullet/active_record70.rb:6:in `_create_record'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/persistence.rb:1067:in `create_or_update'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/callbacks.rb:455:in `block in create_or_update'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:118:in `block in run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/autosave_association.rb:370:in `around_save_collection_association'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:127:in `block in run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:138:in `run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:929:in `_run_save_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/callbacks.rb:455:in `create_or_update'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/timestamp.rb:126:in `create_or_update'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/persistence.rb:648:in `save!'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/validations.rb:53:in `save!'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/transactions.rb:302:in `block in save!'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/transactions.rb:354:in `block in with_transaction_returning_status'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/transaction.rb:319:in `block in within_new_transaction'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:25:in `handle_interrupt'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:25:in `block in synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `handle_interrupt'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/transaction.rb:317:in `within_new_transaction'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/database_statements.rb:316:in `transaction'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/transactions.rb:350:in `with_transaction_returning_status'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/transactions.rb:302:in `save!'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/suppressor.rb:54:in `save!'\n      /Users/krebbl/Projects/ProCarement/care-center/app/models/medical_report.rb:121:in `save_report_as_document'\n      /Users/krebbl/Projects/ProCarement/care-center/test/models/medical_report_test.rb:167:in `block (3 levels) in &lt;class:MedicalReportTest&gt;'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/testing/assertions.rb:34:in `assert_nothing_raised'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/testing/assertions.rb:250:in `_assert_nothing_raised_or_warn'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/testing/assertions.rb:102:in `assert_difference'\n      /Users/krebbl/Projects/ProCarement/care-center/test/models/medical_report_test.rb:165:in `block (2 levels) in &lt;class:MedicalReportTest&gt;'\n      /Users/krebbl/Projects/ProCarement/care-center/test/models/medical_report_test.rb:172:in `instance_exec'\n      /Users/krebbl/Projects/ProCarement/care-center/test/models/medical_report_test.rb:172:in `block in create_test_from_should_hash'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/test.rb:102:in `block (3 levels) in run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/test.rb:199:in `capture_exceptions'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/test.rb:97:in `block (2 levels) in run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:296:in `time_it'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/test.rb:96:in `block in run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:391:in `on_signal'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/test.rb:247:in `with_info_handler'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/test.rb:95:in `run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-reporters-1.4.3/lib/minitest/reporters.rb:48:in `run_with_hooks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:1051:in `run_one_method'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:365:in `run_one_method'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:352:in `block (2 levels) in run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:351:in `each'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:351:in `block in run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:391:in `on_signal'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:378:in `with_info_handler'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:350:in `run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/railties-7.0.5/lib/rails/test_unit/line_filtering.rb:10:in `run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:182:in `block in __run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:182:in `map'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:182:in `__run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:159:in `run'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest.rb:83:in `block in autorun'\n  Thread #&lt;Thread:0x0000000109047888 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/connection_pool/reaper.rb:40 sleep&gt; status=sleep priority=0\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/connection_pool/reaper.rb:46:in `sleep'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/connection_pool/reaper.rb:46:in `block in spawn_thread'\n  Thread #&lt;Thread:0x0000000109443018@Timeout stdlib thread /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/timeout-0.3.2/lib/timeout.rb:101 sleep&gt; status=sleep priority=0\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/timeout-0.3.2/lib/timeout.rb:113:in `sleep'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/timeout-0.3.2/lib/timeout.rb:113:in `wait'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/timeout-0.3.2/lib/timeout.rb:113:in `block (2 levels) in create_timeout_thread'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/timeout-0.3.2/lib/timeout.rb:111:in `synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/timeout-0.3.2/lib/timeout.rb:111:in `block in create_timeout_thread'\n  Thread #&lt;Thread:0x000000010c94b918 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010c94b800 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010c94b710 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010c94b620 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010c94b530 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010c94b440 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010c94b350 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010c94b260 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:28 sleep_forever&gt; status=sleep priority=0\n      &lt;internal:thread_sync&gt;:18:in `pop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/minitest-5.18.0/lib/minitest/parallel.rb:30:in `block (2 levels) in start'\n  Thread #&lt;Thread:0x000000010ce4f180@worker-1 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:332 sleep_forever&gt; status=sleep priority=0\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `block in mon_enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/share_lock.rb:187:in `yield_shares'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/dependencies/interlock.rb:41:in `permit_concurrent_loads'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `mon_enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:22:in `block in synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `handle_interrupt'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/query_cache.rb:128:in `cache_sql'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/query_cache.rb:107:in `select_all'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/querying.rb:54:in `_query_by_sql'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:942:in `block in exec_main_query'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:962:in `skip_query_cache_if_necessary'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:928:in `exec_main_query'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:914:in `block in exec_queries'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:962:in `skip_query_cache_if_necessary'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:908:in `exec_queries'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:695:in `load'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:250:in `records'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/bullet-7.0.7/lib/bullet/active_record70.rb:46:in `records'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:520:in `find_take'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:98:in `take'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:473:in `find_one'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:457:in `find_with_ids'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:69:in `find'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/querying.rb:22:in `find'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/core.rb:271:in `find'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:129:in `locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:154:in `block in locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:164:in `block in unscoped'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:881:in `_scoping'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:428:in `scoping'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/scoping/default.rb:43:in `unscoped'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:164:in `unscoped'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:154:in `locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:16:in `locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:148:in `deserialize_global_id'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:132:in `deserialize_argument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:43:in `block in deserialize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:43:in `map'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:43:in `deserialize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/core.rb:190:in `deserialize_arguments'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/core.rb:180:in `deserialize_arguments_if_needed'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/execution.rb:44:in `perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:14:in `block in perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:25:in `block in instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/notifications.rb:206:in `block in instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/notifications/instrumenter.rb:24:in `instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/notifications.rb:206:in `instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:35:in `instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:14:in `perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/logging.rb:18:in `block in perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/tagged_logging.rb:99:in `block in tagged'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/tagged_logging.rb:37:in `tagged'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/tagged_logging.rb:99:in `tagged'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/logging.rb:25:in `tag_logger'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/logging.rb:18:in `perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/execution.rb:24:in `block in execute'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:118:in `block in run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/railtie.rb:54:in `block (4 levels) in &lt;class:Railtie&gt;'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/execution_wrapper.rb:92:in `wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/reloader.rb:72:in `block in wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/execution_wrapper.rb:92:in `wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/reloader.rb:71:in `wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/railtie.rb:53:in `block (3 levels) in &lt;class:Railtie&gt;'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:127:in `instance_exec'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:127:in `block in run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:138:in `run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/execution.rb:22:in `execute'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/queue_adapters/async_adapter.rb:70:in `perform'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:352:in `run_task'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:343:in `block (3 levels) in create_worker'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:334:in `loop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:334:in `block (2 levels) in create_worker'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:333:in `catch'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:333:in `block in create_worker'\n  Thread #&lt;Thread:0x000000010d989d20@worker-2 /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:332 sleep_forever&gt; status=sleep priority=0\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `block in mon_enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/share_lock.rb:187:in `yield_shares'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/dependencies/interlock.rb:41:in `permit_concurrent_loads'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:17:in `mon_enter'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:22:in `block in synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `handle_interrupt'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/concurrency/load_interlock_aware_monitor.rb:21:in `synchronize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/query_cache.rb:128:in `cache_sql'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/connection_adapters/abstract/query_cache.rb:107:in `select_all'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/querying.rb:54:in `_query_by_sql'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:942:in `block in exec_main_query'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:962:in `skip_query_cache_if_necessary'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:928:in `exec_main_query'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:914:in `block in exec_queries'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:962:in `skip_query_cache_if_necessary'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:908:in `exec_queries'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:695:in `load'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:250:in `records'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/bullet-7.0.7/lib/bullet/active_record70.rb:46:in `records'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:520:in `find_take'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:98:in `take'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:473:in `find_one'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:457:in `find_with_ids'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation/finder_methods.rb:69:in `find'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/querying.rb:22:in `find'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/core.rb:271:in `find'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:129:in `locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:154:in `block in locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:164:in `block in unscoped'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:881:in `_scoping'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/relation.rb:428:in `scoping'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activerecord-7.0.5/lib/active_record/scoping/default.rb:43:in `unscoped'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:164:in `unscoped'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:154:in `locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/globalid-1.1.0/lib/global_id/locator.rb:16:in `locate'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:148:in `deserialize_global_id'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:132:in `deserialize_argument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:43:in `block in deserialize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:43:in `map'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/arguments.rb:43:in `deserialize'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/core.rb:190:in `deserialize_arguments'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/core.rb:180:in `deserialize_arguments_if_needed'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/execution.rb:44:in `perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:14:in `block in perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:25:in `block in instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/notifications.rb:206:in `block in instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/notifications/instrumenter.rb:24:in `instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/notifications.rb:206:in `instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:35:in `instrument'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/instrumentation.rb:14:in `perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/logging.rb:18:in `block in perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/tagged_logging.rb:99:in `block in tagged'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/tagged_logging.rb:37:in `tagged'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/tagged_logging.rb:99:in `tagged'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/logging.rb:25:in `tag_logger'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/logging.rb:18:in `perform_now'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/execution.rb:24:in `block in execute'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:118:in `block in run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/railtie.rb:54:in `block (4 levels) in &lt;class:Railtie&gt;'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/execution_wrapper.rb:92:in `wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/reloader.rb:72:in `block in wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/execution_wrapper.rb:92:in `wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/reloader.rb:71:in `wrap'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/railtie.rb:53:in `block (3 levels) in &lt;class:Railtie&gt;'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:127:in `instance_exec'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:127:in `block in run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activesupport-7.0.5/lib/active_support/callbacks.rb:138:in `run_callbacks'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/execution.rb:22:in `execute'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/activejob-7.0.5/lib/active_job/queue_adapters/async_adapter.rb:70:in `perform'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:352:in `run_task'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:343:in `block (3 levels) in create_worker'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:334:in `loop'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:334:in `block (2 levels) in create_worker'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:333:in `catch'\n      /Users/krebbl/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/concurrent-ruby-1.2.2/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb:333:in `block in create_worker'\n\n</code></pre></div>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">The tests should just run through</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\">The tests get stuck after some while</p>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>: 7.0.5<br>\n<strong>Ruby version</strong>: 3.2.0</p>",
            "url": "https://github.com/rails/rails/issues/48468",
            "title": "Test suite hangs after upgrading from 6.1 to 7.0",
            "date_modified": "2023-12-15T13:33:39.000Z",
            "date_published": "2023-06-14T08:26:54.000Z",
            "author": {
                "name": "krebbl",
                "url": "https://github.com/krebbl"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2722?u=6d0f42b79b269396a7895eb8014a024397fc9c38&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Steps to reproduce</h3>\n\n\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"require 'active_job'\nrequire 'active_job/arguments'\nrequire 'active_support/all'\n\nTime.zone = 'Europe/London' #=&gt; &quot;Europe/London&quot;\ntime = Time.zone.parse('2023-12-01T14:30:00Z') #=&gt; Fri, 01 Dec 2023 14:30:00.000000000 GMT +00:00\nserialized_time = ActiveJob::Serializers::TimeWithZoneSerializer.serialize(time) #=&gt; {&quot;_aj_serialized&quot;=&gt;&quot;ActiveJob::Serializers::TimeWithZoneSerializer&quot;, &quot;value&quot;=&gt;&quot;2023-12-01T14:30:00.000000000+00:00&quot;}\ngmt_deserialized_time = ActiveJob::Serializers::TimeWithZoneSerializer.deserialize(serialized_time) #=&gt; Fri, 01 Dec 2023 14:30:00.000000000 GMT +00:00\nTime.zone = 'America/Los_Angeles' #=&gt; &quot;America/Los_Angeles&quot;\npst_deserialized_time = ActiveJob::Serializers::TimeWithZoneSerializer.deserialize(serialized_time) #=&gt; Fri, 01 Dec 2023 06:30:00.000000000 PST -08:00\nTime.zone = nil #=&gt; nil\nutc_deserialized_time = ActiveJob::Serializers::TimeWithZoneSerializer.deserialize(serialized_time) #=&gt; 2023-12-01 14:30:00 +0000\"><pre class=\"notranslate\"><span class=\"pl-en\">require</span> <span class=\"pl-s\">'active_job'</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">'active_job/arguments'</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">'active_support/all'</span>\n\n<span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">zone</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'Europe/London'</span> <span class=\"pl-c\">#=&gt; \"Europe/London\"</span>\n<span class=\"pl-s1\">time</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">zone</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">parse</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'2023-12-01T14:30:00Z'</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\">#=&gt; Fri, 01 Dec 2023 14:30:00.000000000 GMT +00:00</span>\n<span class=\"pl-s1\">serialized_time</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Serializers</span>::<span class=\"pl-v\">TimeWithZoneSerializer</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">serialize</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">time</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\">#=&gt; {\"_aj_serialized\"=&gt;\"ActiveJob::Serializers::TimeWithZoneSerializer\", \"value\"=&gt;\"2023-12-01T14:30:00.000000000+00:00\"}</span>\n<span class=\"pl-s1\">gmt_deserialized_time</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Serializers</span>::<span class=\"pl-v\">TimeWithZoneSerializer</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">deserialize</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">serialized_time</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\">#=&gt; Fri, 01 Dec 2023 14:30:00.000000000 GMT +00:00</span>\n<span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">zone</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'America/Los_Angeles'</span> <span class=\"pl-c\">#=&gt; \"America/Los_Angeles\"</span>\n<span class=\"pl-s1\">pst_deserialized_time</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Serializers</span>::<span class=\"pl-v\">TimeWithZoneSerializer</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">deserialize</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">serialized_time</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\">#=&gt; Fri, 01 Dec 2023 06:30:00.000000000 PST -08:00</span>\n<span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">zone</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">nil</span> <span class=\"pl-c\">#=&gt; nil</span>\n<span class=\"pl-s1\">utc_deserialized_time</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Serializers</span>::<span class=\"pl-v\">TimeWithZoneSerializer</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">deserialize</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">serialized_time</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\">#=&gt; 2023-12-01 14:30:00 +0000</span></pre></div>\n<h3 dir=\"auto\">Expected behavior</h3>\n\n<p dir=\"auto\">Since <code class=\"notranslate\">ActiveSupport::TimeWithZone</code> stores information about the time zone I expect that this information should be preserved when serializing time. Changing the <code class=\"notranslate\">Time.zone</code> should not affect objects serialized with a different time zone.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n\n<p dir=\"auto\">Deserialization of a serialized <code class=\"notranslate\">TimeWithZone</code> uses always the current <code class=\"notranslate\">Time.zone</code> and not the one that was used to create a <code class=\"notranslate\">TimeWithZone</code> object instance.</p>\n<h3 dir=\"auto\">System configuration</h3>\n<p dir=\"auto\"><strong>Rails version</strong>:<br>\n6.1.7.1 but the behaviour is the same in 7.x</p>\n<p dir=\"auto\"><strong>Ruby version</strong>:<br>\n3.1.3p185</p>",
            "url": "https://github.com/rails/rails/issues/50230",
            "title": "ActiveJob::Serializers::TimeWithZoneSerializer does not preserve the timezone",
            "date_modified": "2023-12-02T15:05:47.000Z",
            "date_published": "2023-12-01T16:04:04.000Z",
            "author": {
                "name": "jakubkosinski",
                "url": "https://github.com/jakubkosinski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">When executing <code class=\"notranslate\">bin/test</code> locally on <code class=\"notranslate\">main</code>, the following error is raised:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Run options: --seed 24472\n\n.......[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: f2998ceb-b80b-428e-8a9b-50c659b84a36) to Test(default) with arguments: #&lt;GlobalID:0x0000000110030438 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n.[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: 23beadd0-3ae1-4a20-9d09-8c271a54546c) to Test(default) with arguments: #&lt;GlobalID:0x0000000112a52928 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n.[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: 1bb5caf7-fda2-4d6d-8d76-74ce4de62599) to Test(default) with arguments: #&lt;GlobalID:0x0000000112a37f38 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n..............[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: cde515b0-98ad-4abd-9e1e-37ae91f00f3e) to Test(default) with arguments: #&lt;GlobalID:0x00000001131768d0 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n.[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: 2fa629c2-b865-4c0f-8d9c-e90d032bb2b4) to Test(default) with arguments: #&lt;GlobalID:0x00000001131f9410 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n.[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: a919f297-1633-4337-8889-843ce1284f15) to Test(default) with arguments: #&lt;GlobalID:0x00000001103b3100 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n.......[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: eed283fd-f78b-4cbd-8afe-9cb637e1def8) to Test(default) with arguments: #&lt;GlobalID:0x0000000112a9e940 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n[ActiveJob] Enqueued BroadcastJob (Job ID: 967d6cd7-8d48-4cd4-9344-5b8522cfdef5) to Test(default) with arguments: &quot;/var/folders/4q/q308vb3s12x2rzrgppdsz0540000gn/T/d20231203-60132-178n3r/broadcast.html&quot;, #&lt;GlobalID:0x0000000112a99878 @uri=#&lt;URI::GID gid://dummy/Message/926854805&gt;&gt;\n[ActiveJob] [ActiveStorage::AnalyzeJob] [eed283fd-f78b-4cbd-8afe-9cb637e1def8] Performing ActiveStorage::AnalyzeJob (Job ID: eed283fd-f78b-4cbd-8afe-9cb637e1def8) from Test(default) enqueued at 2023-12-03T17:15:25.508670000Z with arguments: #&lt;GlobalID:0x0000000112a92bb8 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n[ActiveJob] [ActiveStorage::AnalyzeJob] [eed283fd-f78b-4cbd-8afe-9cb637e1def8] Performed ActiveStorage::AnalyzeJob (Job ID: eed283fd-f78b-4cbd-8afe-9cb637e1def8) from Test(default) in 105.62ms\n[ActiveJob] [BroadcastJob] [967d6cd7-8d48-4cd4-9344-5b8522cfdef5] Performing BroadcastJob (Job ID: 967d6cd7-8d48-4cd4-9344-5b8522cfdef5) from Test(default) enqueued at 2023-12-03T17:15:25.509141000Z with arguments: &quot;/var/folders/4q/q308vb3s12x2rzrgppdsz0540000gn/T/d20231203-60132-178n3r/broadcast.html&quot;, #&lt;GlobalID:0x0000000112f364d0 @uri=#&lt;URI::GID gid://dummy/Message/926854805&gt;&gt;\n[ActiveJob] [BroadcastJob] [967d6cd7-8d48-4cd4-9344-5b8522cfdef5] Performed BroadcastJob (Job ID: 967d6cd7-8d48-4cd4-9344-5b8522cfdef5) from Test(default) in 2.65ms\n..............................................................yarn run v1.22.19\n$ rollup --config rollup.config.js\nDone in 0.53s.\nF\n\nFailure:\nJavascriptPackageTest#test_compiled_code_is_in_sync_with_source_code [REDACTED/rails/rails/actiontext/test/javascript_package_test.rb:14]:\n--- expected\n+++ actual\n@@ -502,7 +502,7 @@\n     }\n   }\n   class BlobRecord {\n-    constructor(file, checksum, url, customHeaders = {}) {\n+    constructor(file, checksum, url) {\n       this.file = file;\n       this.attributes = {\n         filename: file.name,\n@@ -516,9 +516,6 @@\n       this.xhr.setRequestHeader(\\&quot;Content-Type\\&quot;, \\&quot;application/json\\&quot;);\n       this.xhr.setRequestHeader(\\&quot;Accept\\&quot;, \\&quot;application/json\\&quot;);\n       this.xhr.setRequestHeader(\\&quot;X-Requested-With\\&quot;, \\&quot;XMLHttpRequest\\&quot;);\n-      Object.keys(customHeaders).forEach((headerKey =&gt; {\n-        this.xhr.setRequestHeader(headerKey, customHeaders[headerKey]);\n-      }));\n       const csrfToken = getMetaValue(\\&quot;csrf-token\\&quot;);\n       if (csrfToken != undefined) {\n         this.xhr.setRequestHeader(\\&quot;X-CSRF-Token\\&quot;, csrfToken);\n@@ -598,12 +595,11 @@\n   }\n   let id = 0;\n   class DirectUpload {\n-    constructor(file, url, delegate, customHeaders = {}) {\n+    constructor(file, url, delegate) {\n       this.id = ++id;\n       this.file = file;\n       this.url = url;\n       this.delegate = delegate;\n-      this.customHeaders = customHeaders;\n     }\n     create(callback) {\n       FileChecksum.create(this.file, ((error, checksum) =&gt; {\n@@ -611,7 +607,7 @@\n           callback(error);\n           return;\n         }\n-        const blob = new BlobRecord(this.file, checksum, this.url, this.customHeaders);\n+        const blob = new BlobRecord(this.file, checksum, this.url);\n         notify(this.delegate, \\&quot;directUploadWillCreateBlobWithXHR\\&quot;, blob.xhr);\n         blob.create((error =&gt; {\n           if (error) {\n@@ -1370,7 +1366,7 @@\n }\n\n class BlobRecord {\n-  constructor(file, checksum, url, customHeaders = {}) {\n+  constructor(file, checksum, url) {\n     this.file = file;\n     this.attributes = {\n       filename: file.name,\n@@ -1384,9 +1380,6 @@\n     this.xhr.setRequestHeader(\\&quot;Content-Type\\&quot;, \\&quot;application/json\\&quot;);\n     this.xhr.setRequestHeader(\\&quot;Accept\\&quot;, \\&quot;application/json\\&quot;);\n     this.xhr.setRequestHeader(\\&quot;X-Requested-With\\&quot;, \\&quot;XMLHttpRequest\\&quot;);\n-    Object.keys(customHeaders).forEach((headerKey =&gt; {\n-      this.xhr.setRequestHeader(headerKey, customHeaders[headerKey]);\n-    }));\n     const csrfToken = getMetaValue(\\&quot;csrf-token\\&quot;);\n     if (csrfToken != undefined) {\n       this.xhr.setRequestHeader(\\&quot;X-CSRF-Token\\&quot;, csrfToken);\n@@ -1469,12 +1462,11 @@\n let id = 0;\n\n class DirectUpload {\n-  constructor(file, url, delegate, customHeaders = {}) {\n+  constructor(file, url, delegate) {\n     this.id = ++id;\n     this.file = file;\n     this.url = url;\n     this.delegate = delegate;\n-    this.customHeaders = customHeaders;\n   }\n   create(callback) {\n     FileChecksum.create(this.file, ((error, checksum) =&gt; {\n@@ -1482,7 +1474,7 @@\n         callback(error);\n         return;\n       }\n-      const blob = new BlobRecord(this.file, checksum, this.url, this.customHeaders);\n+      const blob = new BlobRecord(this.file, checksum, this.url);\n       notify(this.delegate, \\&quot;directUploadWillCreateBlobWithXHR\\&quot;, blob.xhr);\n       blob.create((error =&gt; {\n         if (error) {\n\nbin/test test/javascript_package_test.rb:6\n\nFinished in 1.496971s, 63.4615 runs/s, 140.2833 assertions/s.\n95 runs, 210 assertions, 1 failures, 0 errors, 0 skips\"><pre class=\"notranslate\"><code class=\"notranslate\">Run options: --seed 24472\n\n.......[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: f2998ceb-b80b-428e-8a9b-50c659b84a36) to Test(default) with arguments: #&lt;GlobalID:0x0000000110030438 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n.[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: 23beadd0-3ae1-4a20-9d09-8c271a54546c) to Test(default) with arguments: #&lt;GlobalID:0x0000000112a52928 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n.[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: 1bb5caf7-fda2-4d6d-8d76-74ce4de62599) to Test(default) with arguments: #&lt;GlobalID:0x0000000112a37f38 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n..............[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: cde515b0-98ad-4abd-9e1e-37ae91f00f3e) to Test(default) with arguments: #&lt;GlobalID:0x00000001131768d0 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n.[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: 2fa629c2-b865-4c0f-8d9c-e90d032bb2b4) to Test(default) with arguments: #&lt;GlobalID:0x00000001131f9410 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n.[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: a919f297-1633-4337-8889-843ce1284f15) to Test(default) with arguments: #&lt;GlobalID:0x00000001103b3100 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n.......[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: eed283fd-f78b-4cbd-8afe-9cb637e1def8) to Test(default) with arguments: #&lt;GlobalID:0x0000000112a9e940 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n[ActiveJob] Enqueued BroadcastJob (Job ID: 967d6cd7-8d48-4cd4-9344-5b8522cfdef5) to Test(default) with arguments: \"/var/folders/4q/q308vb3s12x2rzrgppdsz0540000gn/T/d20231203-60132-178n3r/broadcast.html\", #&lt;GlobalID:0x0000000112a99878 @uri=#&lt;URI::GID gid://dummy/Message/926854805&gt;&gt;\n[ActiveJob] [ActiveStorage::AnalyzeJob] [eed283fd-f78b-4cbd-8afe-9cb637e1def8] Performing ActiveStorage::AnalyzeJob (Job ID: eed283fd-f78b-4cbd-8afe-9cb637e1def8) from Test(default) enqueued at 2023-12-03T17:15:25.508670000Z with arguments: #&lt;GlobalID:0x0000000112a92bb8 @uri=#&lt;URI::GID gid://dummy/ActiveStorage::Blob/1&gt;&gt;\n[ActiveJob] [ActiveStorage::AnalyzeJob] [eed283fd-f78b-4cbd-8afe-9cb637e1def8] Performed ActiveStorage::AnalyzeJob (Job ID: eed283fd-f78b-4cbd-8afe-9cb637e1def8) from Test(default) in 105.62ms\n[ActiveJob] [BroadcastJob] [967d6cd7-8d48-4cd4-9344-5b8522cfdef5] Performing BroadcastJob (Job ID: 967d6cd7-8d48-4cd4-9344-5b8522cfdef5) from Test(default) enqueued at 2023-12-03T17:15:25.509141000Z with arguments: \"/var/folders/4q/q308vb3s12x2rzrgppdsz0540000gn/T/d20231203-60132-178n3r/broadcast.html\", #&lt;GlobalID:0x0000000112f364d0 @uri=#&lt;URI::GID gid://dummy/Message/926854805&gt;&gt;\n[ActiveJob] [BroadcastJob] [967d6cd7-8d48-4cd4-9344-5b8522cfdef5] Performed BroadcastJob (Job ID: 967d6cd7-8d48-4cd4-9344-5b8522cfdef5) from Test(default) in 2.65ms\n..............................................................yarn run v1.22.19\n$ rollup --config rollup.config.js\nDone in 0.53s.\nF\n\nFailure:\nJavascriptPackageTest#test_compiled_code_is_in_sync_with_source_code [REDACTED/rails/rails/actiontext/test/javascript_package_test.rb:14]:\n--- expected\n+++ actual\n@@ -502,7 +502,7 @@\n     }\n   }\n   class BlobRecord {\n-    constructor(file, checksum, url, customHeaders = {}) {\n+    constructor(file, checksum, url) {\n       this.file = file;\n       this.attributes = {\n         filename: file.name,\n@@ -516,9 +516,6 @@\n       this.xhr.setRequestHeader(\\\"Content-Type\\\", \\\"application/json\\\");\n       this.xhr.setRequestHeader(\\\"Accept\\\", \\\"application/json\\\");\n       this.xhr.setRequestHeader(\\\"X-Requested-With\\\", \\\"XMLHttpRequest\\\");\n-      Object.keys(customHeaders).forEach((headerKey =&gt; {\n-        this.xhr.setRequestHeader(headerKey, customHeaders[headerKey]);\n-      }));\n       const csrfToken = getMetaValue(\\\"csrf-token\\\");\n       if (csrfToken != undefined) {\n         this.xhr.setRequestHeader(\\\"X-CSRF-Token\\\", csrfToken);\n@@ -598,12 +595,11 @@\n   }\n   let id = 0;\n   class DirectUpload {\n-    constructor(file, url, delegate, customHeaders = {}) {\n+    constructor(file, url, delegate) {\n       this.id = ++id;\n       this.file = file;\n       this.url = url;\n       this.delegate = delegate;\n-      this.customHeaders = customHeaders;\n     }\n     create(callback) {\n       FileChecksum.create(this.file, ((error, checksum) =&gt; {\n@@ -611,7 +607,7 @@\n           callback(error);\n           return;\n         }\n-        const blob = new BlobRecord(this.file, checksum, this.url, this.customHeaders);\n+        const blob = new BlobRecord(this.file, checksum, this.url);\n         notify(this.delegate, \\\"directUploadWillCreateBlobWithXHR\\\", blob.xhr);\n         blob.create((error =&gt; {\n           if (error) {\n@@ -1370,7 +1366,7 @@\n }\n\n class BlobRecord {\n-  constructor(file, checksum, url, customHeaders = {}) {\n+  constructor(file, checksum, url) {\n     this.file = file;\n     this.attributes = {\n       filename: file.name,\n@@ -1384,9 +1380,6 @@\n     this.xhr.setRequestHeader(\\\"Content-Type\\\", \\\"application/json\\\");\n     this.xhr.setRequestHeader(\\\"Accept\\\", \\\"application/json\\\");\n     this.xhr.setRequestHeader(\\\"X-Requested-With\\\", \\\"XMLHttpRequest\\\");\n-    Object.keys(customHeaders).forEach((headerKey =&gt; {\n-      this.xhr.setRequestHeader(headerKey, customHeaders[headerKey]);\n-    }));\n     const csrfToken = getMetaValue(\\\"csrf-token\\\");\n     if (csrfToken != undefined) {\n       this.xhr.setRequestHeader(\\\"X-CSRF-Token\\\", csrfToken);\n@@ -1469,12 +1462,11 @@\n let id = 0;\n\n class DirectUpload {\n-  constructor(file, url, delegate, customHeaders = {}) {\n+  constructor(file, url, delegate) {\n     this.id = ++id;\n     this.file = file;\n     this.url = url;\n     this.delegate = delegate;\n-    this.customHeaders = customHeaders;\n   }\n   create(callback) {\n     FileChecksum.create(this.file, ((error, checksum) =&gt; {\n@@ -1482,7 +1474,7 @@\n         callback(error);\n         return;\n       }\n-      const blob = new BlobRecord(this.file, checksum, this.url, this.customHeaders);\n+      const blob = new BlobRecord(this.file, checksum, this.url);\n       notify(this.delegate, \\\"directUploadWillCreateBlobWithXHR\\\", blob.xhr);\n       blob.create((error =&gt; {\n         if (error) {\n\nbin/test test/javascript_package_test.rb:6\n\nFinished in 1.496971s, 63.4615 runs/s, 140.2833 assertions/s.\n95 runs, 210 assertions, 1 failures, 0 errors, 0 skips\n</code></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit aims to synchronize the JavaScript source defined in <code class=\"notranslate\">app/javascript</code> with the compiled output defined in <code class=\"notranslate\">app/assets/javascripts</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50254",
            "title": "Action Text Source-to-Compiled code drift",
            "date_modified": "2023-12-03T17:21:50.000Z",
            "date_published": "2023-12-03T17:18:33.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/771968?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">In <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1286607479\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45476\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/45476/hovercard\" href=\"https://github.com/rails/rails/pull/45476\">#45476</a>, <code class=\"notranslate\">ActiveRecord::Base.destroy_association_async_job</code> was made to accept a string which would be lazily constantized, to avoid loading <code class=\"notranslate\">ActiveJob::Base</code> too soon.  However, due to the way <code class=\"notranslate\">class_attribute</code> values are written, <em>each subclass</em> calling <code class=\"notranslate\">destroy_association_async_job</code> will <a href=\"https://github.com/rails/rails/pull/45476/files#diff-4411c7993e3f8ccfd8e09f44a81f10dfac3ea7dbd44cabd60b369040a00be324R28\">allocate a <code class=\"notranslate\">_destroy_association_async_job</code> singleton method</a> regardless of whether the subclass assigns a custom job value.</p>\n<p dir=\"auto\">Additionally, <code class=\"notranslate\">class_attribute</code> requires using a dummy attribute name so that the post-processing reader method is not overwritten when the attribute is set.  This is particularly <a href=\"https://github.com/rails/rails/pull/45476/files#diff-4411c7993e3f8ccfd8e09f44a81f10dfac3ea7dbd44cabd60b369040a00be324R35-R36\">cumbersome</a> when instance accessors are involved.</p>\n<p dir=\"auto\">This PR re-implements <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1286607479\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45476\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/45476/hovercard\" href=\"https://github.com/rails/rails/pull/45476\">#45476</a> by adding support for a transform block to <code class=\"notranslate\">class_attribute</code>.  A transform block is applied to an attribute value when that value is first read, and the result is memoized as the actual value of the attribute.  Thus, using a transform block, <code class=\"notranslate\">destroy_association_async_job</code> can lazily constantize and memoize the result, without allocating additional singleton methods, and without juggling attribute names.</p>\n<p dir=\"auto\">The PR also applies the same technique to <code class=\"notranslate\">ActionMailer::Base.delivery_job</code>.  <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #45486.\">Closes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1287965823\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45486\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/45486/hovercard\" href=\"https://github.com/rails/rails/pull/45486\">#45486</a>.</p>\n<p dir=\"auto\">I wrote about a few of the alternatives I considered in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1305305580\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45603\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/45603/hovercard\" href=\"https://github.com/rails/rails/pull/45603\">#45603</a>.  <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #45603.\">Closes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1305305580\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45603\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/45603/hovercard\" href=\"https://github.com/rails/rails/pull/45603\">#45603</a>.</p>",
            "url": "https://github.com/rails/rails/pull/45622",
            "title": "Use `class_attribute` transform block for job config",
            "date_modified": "2022-07-28T06:53:09.000Z",
            "date_published": "2022-07-18T20:56:53.000Z",
            "author": {
                "name": "jonathanhefner",
                "url": "https://github.com/jonathanhefner"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8219340?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Summary</h3>\n\n<p dir=\"auto\">ActiveJob serializes <code class=\"notranslate\">Symbol</code> <code class=\"notranslate\">Hash</code> keys by stringifying them, and storing an array of keys to be symbolized on deserialization as <code class=\"notranslate\">_aj_symbol_keys</code>. This means that if a <code class=\"notranslate\">Hash</code> has both <code class=\"notranslate\">Symbol</code> and <code class=\"notranslate\">String</code> keys with the same contents, they will collide.</p>\n<p dir=\"auto\">Specifically, the resulting hash ends up containing only a pair consisting of:</p>\n<ul dir=\"auto\">\n<li>the symbol key</li>\n<li>the last value</li>\n</ul>\n<p dir=\"auto\">This PR adds a check for this and logs a deprecation warning. It also introduces a setting to <code class=\"notranslate\">raise</code> instead of logging the warning, with the intention of making this behavior the default in Rails 7.2/8.0.</p>\n<h3 dir=\"auto\">Other Information</h3>\n\n\n<p dir=\"auto\">I have left a number of placeholders for the time being, because I wanted to get initial review and confirm we want to do this, before investing the time to write the docs, deprecation message, changelog, etc.</p>\n<hr>\n<p dir=\"auto\">cc. <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/Mangara/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/Mangara\">@Mangara</a>, who mentioned this in Slack</p>",
            "url": "https://github.com/rails/rails/pull/45676",
            "title": "Detect colliding keys in Active Job Hash serialization",
            "date_modified": "2022-07-28T07:38:01.000Z",
            "date_published": "2022-07-28T07:37:57.000Z",
            "author": {
                "name": "sambostock",
                "url": "https://github.com/sambostock"
            }
        }
    ]
}